(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{10:function(t,e,r){"use strict";r.d(e,"b",function(){return T}),r.d(e,"c",function(){return A}),r.d(e,"d",function(){return I}),r.d(e,"a",function(){return V});var i=r(1),n=r(7),s=r(5),a=r(41),o=r(27),u=r(0),h=r(25),c=r(3),l=r(24),d=r(32),f=r(23),p=r(56),g=r(53),m=r(14),v=r(16),y=r(66),b=r(37),_=r(4),x=r(2),M=r(9),T=function(){return function(t,e){this.distance=t,this.mesh=e}}(),A=function(){return function(){}}(),D=function(){return function(){this.visibleInstances={},this.renderIdForInstances=new Array,this.batchCache=new I,this.instancesBufferSize=2048}}(),I=function(){return function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array}}(),V=function(t){function e(r,i,n,s,u,h){void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=null),void 0===h&&(h=!0);var c=t.call(this,r,i)||this;if(c.delayLoadState=_.a.DELAYLOADSTATE_NONE,c.instances=new Array,c._LODLevels=new Array,c._instanceDataStorage=new D,c._originalBuilderSideOrientation=e.DEFAULTSIDE,c.overrideMaterialSideOrientation=null,c._areNormalsFrozen=!1,c._source=null,c._isMesh=!0,i=c.getScene(),s){if(s._geometry&&s._geometry.applyToMesh(c),a.a.DeepCopy(s,c,["name","material","skeleton","instances","parent","uniqueId","source","metadata","hasLODLevels","geometry","isBlocked","areNormalsFrozen","onBeforeDrawObservable","onBeforeRenderObservable","onAfterRenderObservable","onBeforeDraw","onAfterWorldMatrixUpdateObservable","onCollideObservable","onCollisionPositionChangeObservable","onRebuildObservable","onDisposeObservable"],["_poseMatrix"]),c._source=s,i.useClonedMeshhMap&&(s.meshMap||(s.meshMap={}),s.meshMap[c.uniqueId]=c),c._originalBuilderSideOrientation=s._originalBuilderSideOrientation,c._creationDataStorage=s._creationDataStorage,c._source._ranges){var l=c._source._ranges;for(var r in l)l.hasOwnProperty(r)&&l[r]&&c.createAnimationRange(r,l[r].from,l[r].to)}var d;if(s.metadata&&s.metadata.clone?c.metadata=s.metadata.clone():c.metadata=s.metadata,o.a&&o.a.HasTags(s)&&o.a.AddTagsTo(c,o.a.GetTags(s,!0)),c.parent=s.parent,c.setPivotMatrix(s.getPivotMatrix()),c.id=r+"."+s.id,c.material=s.material,!u)for(var f=s.getDescendants(!0),p=0;p<f.length;p++){var g=f[p];g.clone&&g.clone(r+"."+g.name,c)}var m=c.getScene().getPhysicsEngine();if(h&&m){var v=m.getImpostorForPhysicsObject(s);v&&(c.physicsImpostor=v.clone(c))}for(d=0;d<i.particleSystems.length;d++){var y=i.particleSystems[d];y.emitter===s&&y.clone(y.name,c)}c.refreshBoundingInfo(),c.computeWorldMatrix(!0)}return null!==n&&(c.parent=n),c}return i.d(e,t),Object.defineProperty(e.prototype,"onBeforeRenderObservable",{get:function(){return this._onBeforeRenderObservable||(this._onBeforeRenderObservable=new n.c),this._onBeforeRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRenderObservable",{get:function(){return this._onAfterRenderObservable||(this._onAfterRenderObservable=new n.c),this._onAfterRenderObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeDrawObservable",{get:function(){return this._onBeforeDrawObservable||(this._onBeforeDrawObservable=new n.c),this._onBeforeDrawObservable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeDraw",{set:function(t){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"morphTargetManager",{get:function(){return this._morphTargetManager},set:function(t){this._morphTargetManager!==t&&(this._morphTargetManager=t,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(t){this._unIndexed!==t&&(this._unIndexed=t,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"Mesh"},e.prototype.toString=function(e){var r=t.prototype.toString.call(this,e);if(r+=", n vertices: "+this.getTotalVertices(),r+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var i=0;i<this.animations.length;i++)r+=", animation[0]: "+this.animations[i].toString(e);if(e)if(this._geometry){var n=this.getIndices(),s=this.getVerticesData(c.b.PositionKind);s&&n&&(r+=", flat shading: "+(s.length/3===n.length?"YES":"NO"))}else r+=", flat shading: UNKNOWN";return r},e.prototype._unBindEffect=function(){t.prototype._unBindEffect.call(this);for(var e=0,r=this.instances;e<r.length;e++){r[e]._unBindEffect()}},Object.defineProperty(e.prototype,"hasLODLevels",{get:function(){return this._LODLevels.length>0},enumerable:!0,configurable:!0}),e.prototype.getLODLevels=function(){return this._LODLevels},e.prototype._sortLODLevels=function(){this._LODLevels.sort(function(t,e){return t.distance<e.distance?1:t.distance>e.distance?-1:0})},e.prototype.addLODLevel=function(t,e){if(e&&e._masterMesh)return M.a.Warn("You cannot use a mesh as LOD level twice"),this;var r=new T(t,e);return this._LODLevels.push(r),e&&(e._masterMesh=this),this._sortLODLevels(),this},e.prototype.getLODLevelAtDistance=function(t){for(var e=0;e<this._LODLevels.length;e++){var r=this._LODLevels[e];if(r.distance===t)return r.mesh}return null},e.prototype.removeLODLevel=function(t){for(var e=0;e<this._LODLevels.length;e++)this._LODLevels[e].mesh===t&&(this._LODLevels.splice(e,1),t&&(t._masterMesh=null));return this._sortLODLevels(),this},e.prototype.getLOD=function(t,e){if(!this._LODLevels||0===this._LODLevels.length)return this;var r;e?r=e:r=this.getBoundingInfo().boundingSphere;var i=r.centerWorld.subtract(t.globalPosition).length();if(this._LODLevels[this._LODLevels.length-1].distance>i)return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this._LODLevels[this._LODLevels.length-1].mesh),this;for(var n=0;n<this._LODLevels.length;n++){var s=this._LODLevels[n];if(s.distance<i)return s.mesh&&(s.mesh._preActivate(),s.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(i,this,s.mesh),s.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this),this},Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),e.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},e.prototype.getVerticesData=function(t,e,r){return this._geometry?this._geometry.getVerticesData(t,e,r):null},e.prototype.getVertexBuffer=function(t){return this._geometry?this._geometry.getVertexBuffer(t):null},e.prototype.isVerticesDataPresent=function(t){return this._geometry?this._geometry.isVerticesDataPresent(t):!!this._delayInfo&&-1!==this._delayInfo.indexOf(t)},e.prototype.isVertexBufferUpdatable=function(t){return this._geometry?this._geometry.isVertexBufferUpdatable(t):!!this._delayInfo&&-1!==this._delayInfo.indexOf(t)},e.prototype.getVerticesDataKinds=function(){if(!this._geometry){var t=new Array;return this._delayInfo&&this._delayInfo.forEach(function(e){t.push(e)}),t}return this._geometry.getVerticesDataKinds()},e.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},e.prototype.getIndices=function(t,e){return this._geometry?this._geometry.getIndices(t,e):[]},Object.defineProperty(e.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),e.prototype.isReady=function(e,r){if(void 0===e&&(e=!1),void 0===r&&(r=!1),this.delayLoadState===_.a.DELAYLOADSTATE_LOADING)return!1;if(!t.prototype.isReady.call(this,e))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!e)return!0;var i=this.getEngine(),n=this.getScene(),s=r||i.getCaps().instancedArrays&&this.instances.length>0;this.computeWorldMatrix();var a=this.material||n.defaultMaterial;if(a)if(a._storeEffectOnSubMeshes)for(var o=0,u=this.subMeshes;o<u.length;o++){var h=(g=u[o]).getMaterial();if(h)if(h._storeEffectOnSubMeshes){if(!h.isReadyForSubMesh(this,g,s))return!1}else if(!h.isReady(this,s))return!1}else if(!a.isReady(this,s))return!1;for(var c=0,l=this._lightSources;c<l.length;c++){var d=l[c].getShadowGenerator();if(d)for(var f=0,p=this.subMeshes;f<p.length;f++){var g=p[f];if(!d.isReady(g,s))return!1}}for(var m=0,v=this._LODLevels;m<v.length;m++){var y=v[m];if(y.mesh&&!y.mesh.isReady(s))return!1}return!0},Object.defineProperty(e.prototype,"areNormalsFrozen",{get:function(){return this._areNormalsFrozen},enumerable:!0,configurable:!0}),e.prototype.freezeNormals=function(){return this._areNormalsFrozen=!0,this},e.prototype.unfreezeNormals=function(){return this._areNormalsFrozen=!1,this},Object.defineProperty(e.prototype,"overridenInstanceCount",{set:function(t){this._instanceDataStorage.overridenInstanceCount=t},enumerable:!0,configurable:!0}),e.prototype._preActivate=function(){var t=this.getScene().getRenderId();return this._preActivateId===t?this:(this._preActivateId=t,this._instanceDataStorage.visibleInstances=null,this)},e.prototype._preActivateForIntermediateRendering=function(t){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=t),this},e.prototype._registerInstanceForRenderId=function(t,e){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:e,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[e]||(this._instanceDataStorage.visibleInstances[e]=new Array),this._instanceDataStorage.visibleInstances[e].push(t),this},e.prototype.refreshBoundingInfo=function(t){if(void 0===t&&(t=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var e=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(t),e),this},e.prototype._createGlobalSubMesh=function(t){var e=this.getTotalVertices();if(!e||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var r=this.getIndices();if(!r)return null;var i=r.length,n=!1;if(t)n=!0;else for(var s=0,a=this.subMeshes;s<a.length;s++){var o=a[s];if(o.indexStart+o.indexCount>=i){n=!0;break}if(o.verticesStart+o.verticesCount>=e){n=!0;break}}if(!n)return this.subMeshes[0]}return this.releaseSubMeshes(),new p.b(0,0,e,0,this.getTotalIndices(),this)},e.prototype.subdivide=function(t){if(!(t<1)){for(var e=this.getTotalIndices(),r=e/t|0,i=0;r%3!=0;)r++;this.releaseSubMeshes();for(var n=0;n<t&&!(i>=e);n++)p.b.CreateFromIndices(0,i,Math.min(r,e-i),this),i+=r;this.synchronizeInstances()}},e.prototype.setVerticesData=function(t,e,r,i){if(void 0===r&&(r=!1),this._geometry)this._geometry.setVerticesData(t,e,r,i);else{var n=new l.a;n.set(e,t);var s=this.getScene();new d.d(d.d.RandomId(),s,n,r,this)}return this},e.prototype.markVerticesDataAsUpdatable=function(t,e){void 0===e&&(e=!0);var r=this.getVertexBuffer(t);r&&r.isUpdatable()!==e&&this.setVerticesData(t,this.getVerticesData(t),e)},e.prototype.setVerticesBuffer=function(t){return this._geometry||(this._geometry=d.d.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(t),this},e.prototype.updateVerticesData=function(t,e,r,i){return this._geometry?(i?(this.makeGeometryUnique(),this.updateVerticesData(t,e,r,!1)):this._geometry.updateVerticesData(t,e,r),this):this},e.prototype.updateMeshPositions=function(t,e){void 0===e&&(e=!0);var r=this.getVerticesData(c.b.PositionKind);if(!r)return this;if(t(r),this.updateVerticesData(c.b.PositionKind,r,!1,!1),e){var i=this.getIndices(),n=this.getVerticesData(c.b.NormalKind);if(!n)return this;l.a.ComputeNormals(r,i,n),this.updateVerticesData(c.b.NormalKind,n,!1,!1)}return this},e.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var t=this._geometry,e=this._geometry.copy(d.d.RandomId());return t.releaseForMesh(this,!0),e.applyToMesh(this),this},e.prototype.setIndices=function(t,e,r){if(void 0===e&&(e=null),void 0===r&&(r=!1),this._geometry)this._geometry.setIndices(t,e,r);else{var i=new l.a;i.indices=t;var n=this.getScene();new d.d(d.d.RandomId(),n,i,r,this)}return this},e.prototype.updateIndices=function(t,e){return this._geometry?(this._geometry.updateIndices(t,e),this):this},e.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},e.prototype._bind=function(t,e,r){if(!this._geometry)return this;var i,n=this.getScene().getEngine();if(this._unIndexed)i=null;else switch(r){case m.a.PointFillMode:i=null;break;case m.a.WireFrameFillMode:i=t._getLinesIndexBuffer(this.getIndices(),n);break;default:case m.a.TriangleFillMode:i=this._unIndexed?null:this._geometry.getIndexBuffer()}return this._geometry._bind(e,i),this},e.prototype._draw=function(t,e,r,i){if(void 0===i&&(i=!1),!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._onBeforeDrawObservable&&this._onBeforeDrawObservable.notifyObservers(this);var n=this.getScene(),s=n.getEngine();if(this._unIndexed||e==m.a.PointFillMode?s.drawArraysType(e,t.verticesStart,t.verticesCount,r):e==m.a.WireFrameFillMode?s.drawElementsType(e,0,t._linesIndexCount,r):s.drawElementsType(e,t.indexStart,t.indexCount,r),n._isAlternateRenderingEnabled&&!i){var a=t.effect||this._effectiveMaterial.getEffect();if(!a||!n.activeCamera)return this;n._switchToAlternateCameraConfiguration(!0),this._effectiveMaterial.bindView(a),this._effectiveMaterial.bindViewProjection(a),s.setViewport(n.activeCamera._alternateCamera.viewport),this._draw(t,e,r,!0),s.setViewport(n.activeCamera.viewport),n._switchToAlternateCameraConfiguration(!1),this._effectiveMaterial.bindView(a),this._effectiveMaterial.bindViewProjection(a)}return this},e.prototype.registerBeforeRender=function(t){return this.onBeforeRenderObservable.add(t),this},e.prototype.unregisterBeforeRender=function(t){return this.onBeforeRenderObservable.removeCallback(t),this},e.prototype.registerAfterRender=function(t){return this.onAfterRenderObservable.add(t),this},e.prototype.unregisterAfterRender=function(t){return this.onAfterRenderObservable.removeCallback(t),this},e.prototype._getInstancesRenderList=function(t){var e=this.getScene(),r=this._instanceDataStorage.batchCache;if(r.mustReturn=!1,r.renderSelf[t]=this.isEnabled()&&this.isVisible,r.visibleInstances[t]=null,this._instanceDataStorage.visibleInstances){var i=this._instanceDataStorage.visibleInstances,n=e.getRenderId(),s=e._isInIntermediateRendering()?i.intermediateDefaultRenderId:i.defaultRenderId;r.visibleInstances[t]=i[n];var a=this._renderId;!r.visibleInstances[t]&&s&&(r.visibleInstances[t]=i[s],n=Math.max(s,n),a=Math.max(i.selfDefaultRenderId,n));var o=r.visibleInstances[t];if(o&&o.length){if(this._instanceDataStorage.renderIdForInstances[t]===n)return r.mustReturn=!0,r;n!==a&&(r.renderSelf[t]=!1)}this._instanceDataStorage.renderIdForInstances[t]=n}return r},e.prototype._renderWithInstances=function(t,e,r,i,n){var s=r.visibleInstances[t._id];if(!s)return this;for(var a=16*(s.length+1)*4,o=this._instanceDataStorage,u=o.instancesBufferSize,h=o.instancesBuffer;o.instancesBufferSize<a;)o.instancesBufferSize*=2;o.instancesData&&u==o.instancesBufferSize||(o.instancesData=new Float32Array(o.instancesBufferSize/4));var l=0,d=0,f=this.getWorldMatrix();if(r.renderSelf[t._id]&&(f.copyToArray(o.instancesData,l),l+=16,d++),s)for(var p=0;p<s.length;p++){s[p].getWorldMatrix().copyToArray(o.instancesData,l),l+=16,d++}return h&&u==o.instancesBufferSize?h.updateDirectly(o.instancesData,0,d):(h&&h.dispose(),h=new c.a(n,o.instancesData,!0,16,!1,!0),o.instancesBuffer=h,this.setVerticesBuffer(h.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(h.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(h.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(h.createVertexBuffer("world3",12,4))),this._bind(t,i,e),this._draw(t,e,d),n.unbindInstanceAttributes(),this},e.prototype._processRendering=function(t,e,r,i,n,s,a){var o=this.getScene().getEngine();if(n)this._renderWithInstances(t,r,i,e,o);else{i.renderSelf[t._id]&&(s&&s(!1,this.getWorldMatrix(),a),this._draw(t,r,this._instanceDataStorage.overridenInstanceCount));var u=i.visibleInstances[t._id];if(u)for(var h=0;h<u.length;h++){var c=u[h].getWorldMatrix();s&&s(!0,c,a),this._draw(t,r)}}return this},e.prototype.render=function(t,e){if(this._checkOcclusionQuery())return this;var r=this.getScene(),i=this._getInstancesRenderList(t._id);if(i.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._onBeforeRenderObservable&&this._onBeforeRenderObservable.notifyObservers(this);var n,s=r.getEngine(),a=s.getCaps().instancedArrays&&null!==i.visibleInstances[t._id]&&void 0!==i.visibleInstances[t._id],o=t.getMaterial();if(!o)return this;if(this._effectiveMaterial=o,this._effectiveMaterial._storeEffectOnSubMeshes){if(!this._effectiveMaterial.isReadyForSubMesh(this,t,a))return this}else if(!this._effectiveMaterial.isReady(this,a))return this;e&&s.setAlphaMode(this._effectiveMaterial.alphaMode);for(var u=0,h=r._beforeRenderingMeshStage;u<h.length;u++){h[u].action(this,t,i)}if(!(n=this._effectiveMaterial._storeEffectOnSubMeshes?t.effect:this._effectiveMaterial.getEffect()))return this;var c=this.skeleton&&this.skeleton.overrideMesh||this,l=this.overrideMaterialSideOrientation;null==l&&(l=this._effectiveMaterial.sideOrientation,c._getWorldMatrixDeterminant()<0&&(l=l===m.a.ClockWiseSideOrientation?m.a.CounterClockWiseSideOrientation:m.a.ClockWiseSideOrientation));var d=this._effectiveMaterial._preBind(n,l);this._effectiveMaterial.forceDepthWrite&&s.setDepthWrite(!0);var f=r.forcePointsCloud?m.a.PointFillMode:r.forceWireframe?m.a.WireFrameFillMode:this._effectiveMaterial.fillMode;a||this._bind(t,n,f);var p=c.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(p,this,t):this._effectiveMaterial.bind(p,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(s.setState(!0,this._effectiveMaterial.zOffset,!1,!d),this._processRendering(t,n,f,i,a,this._onBeforeDraw,this._effectiveMaterial),s.setState(!0,this._effectiveMaterial.zOffset,!1,d)),this._processRendering(t,n,f,i,a,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var g=0,v=r._afterRenderingMeshStage;g<v.length;g++){v[g].action(this,t,i)}return this._onAfterRenderObservable&&this._onAfterRenderObservable.notifyObservers(this),this},e.prototype._onBeforeDraw=function(t,e,r){t&&r&&r.bindOnlyWorldMatrix(e)},e.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(c.b.MatricesWeightsKind)&&(this.isVerticesDataPresent(c.b.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},e.prototype.normalizeSkinFourWeights=function(){for(var t=this.getVerticesData(c.b.MatricesWeightsKind),e=t.length,r=0;r<e;r+=4){var i=t[r]+t[r+1]+t[r+2]+t[r+3];if(0===i)t[r]=1;else{var n=1/i;t[r]*=n,t[r+1]*=n,t[r+2]*=n,t[r+3]*=n}}this.setVerticesData(c.b.MatricesWeightsKind,t)},e.prototype.normalizeSkinWeightsAndExtra=function(){for(var t=this.getVerticesData(c.b.MatricesWeightsExtraKind),e=this.getVerticesData(c.b.MatricesWeightsKind),r=e.length,i=0;i<r;i+=4){var n=e[i]+e[i+1]+e[i+2]+e[i+3];if(0===(n+=t[i]+t[i+1]+t[i+2]+t[i+3]))e[i]=1;else{var s=1/n;e[i]*=s,e[i+1]*=s,e[i+2]*=s,e[i+3]*=s,t[i]*=s,t[i+1]*=s,t[i+2]*=s,t[i+3]*=s}}this.setVerticesData(c.b.MatricesWeightsKind,e),this.setVerticesData(c.b.MatricesWeightsKind,t)},e.prototype.validateSkinning=function(){var t=this.getVerticesData(c.b.MatricesWeightsExtraKind),e=this.getVerticesData(c.b.MatricesWeightsKind);if(null===e||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var r=e.length,i=0,n=0,s=0,a=0,o=null===t?4:8,u=new Array,h=0;h<=o;h++)u[h]=0;for(h=0;h<r;h+=4){for(var l=e[h],d=l,f=0===d?0:1,p=1;p<o;p++){var g=p<4?e[h+p]:t[h+p-4];g>l&&i++,0!==g&&f++,d+=g,l=g}if(u[f]++,f>s&&(s=f),0===d)n++;else{var m=1/d,v=0;for(p=0;p<o;p++)v+=p<4?Math.abs(e[h+p]-e[h+p]*m):Math.abs(t[h+p-4]-t[h+p-4]*m);v>.001&&a++}}var y=this.skeleton.bones.length,b=this.getVerticesData(c.b.MatricesIndicesKind),_=this.getVerticesData(c.b.MatricesIndicesExtraKind),x=0;for(h=0;h<r;h++)for(p=0;p<o;p++){var M=p<4?b[p]:_[p-4];(M>=y||M<0)&&x++}return{skinned:!0,valid:0===n&&0===a&&0===x,report:"Number of Weights = "+r/4+"\nMaximum influences = "+s+"\nMissing Weights = "+n+"\nNot Sorted = "+i+"\nNot Normalized = "+a+"\nWeightCounts = ["+u+"]\nNumber of bones = "+y+"\nBad Bone Indices = "+x}},e.prototype._checkDelayState=function(){var t=this.getScene();return this._geometry?this._geometry.load(t):this.delayLoadState===_.a.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=_.a.DELAYLOADSTATE_LOADING,this._queueLoad(t)),this},e.prototype._queueLoad=function(t){var e=this;t._addPendingData(this);var r=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return s.h.LoadFile(this.delayLoadingFile,function(r){r instanceof ArrayBuffer?e._delayLoadingFunction(r,e):e._delayLoadingFunction(JSON.parse(r),e),e.instances.forEach(function(t){t._syncSubMeshes()}),e.delayLoadState=_.a.DELAYLOADSTATE_LOADED,t._removePendingData(e)},function(){},t.offlineProvider,r),this},e.prototype.isInFrustum=function(e){return this.delayLoadState!==_.a.DELAYLOADSTATE_LOADING&&(!!t.prototype.isInFrustum.call(this,e)&&(this._checkDelayState(),!0))},e.prototype.setMaterialByID=function(t){var e,r=this.getScene().materials;for(e=r.length-1;e>-1;e--)if(r[e].id===t)return this.material=r[e],this;var i=this.getScene().multiMaterials;for(e=i.length-1;e>-1;e--)if(i[e].id===t)return this.material=i[e],this;return this},e.prototype.getAnimatables=function(){var t=new Array;return this.material&&t.push(this.material),this.skeleton&&t.push(this.skeleton),t},e.prototype.bakeTransformIntoVertices=function(t){if(!this.isVerticesDataPresent(c.b.PositionKind))return this;var e=this.subMeshes.splice(0);this._resetPointsArrayCache();var r,i=this.getVerticesData(c.b.PositionKind),n=new Array;for(r=0;r<i.length;r+=3)u.Vector3.TransformCoordinates(u.Vector3.FromArray(i,r),t).toArray(n,r);if(this.setVerticesData(c.b.PositionKind,n,this.getVertexBuffer(c.b.PositionKind).isUpdatable()),this.isVerticesDataPresent(c.b.NormalKind)){for(i=this.getVerticesData(c.b.NormalKind),n=[],r=0;r<i.length;r+=3)u.Vector3.TransformNormal(u.Vector3.FromArray(i,r),t).normalize().toArray(n,r);this.setVerticesData(c.b.NormalKind,n,this.getVertexBuffer(c.b.NormalKind).isUpdatable())}return t.m[0]*t.m[5]*t.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=e,this},e.prototype.bakeCurrentTransformIntoVertices=function(){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=u.Quaternion.Identity()),this._worldMatrix=u.Matrix.Identity(),this},Object.defineProperty(e.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),e.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},e.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},e.prototype.clone=function(t,r,i,n){return void 0===t&&(t=""),void 0===n&&(n=!0),new e(t,this.getScene(),r,this,i,n)},e.prototype.dispose=function(e,r){if(void 0===r&&(r=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0),this._onBeforeDrawObservable&&this._onBeforeDrawObservable.clear(),this._onBeforeRenderObservable&&this._onBeforeRenderObservable.clear(),this._onAfterRenderObservable&&this._onAfterRenderObservable.clear(),this._scene.useClonedMeshhMap){if(this.meshMap)for(var i in this.meshMap){(a=this.meshMap[i])&&(a._source=null,this.meshMap[i]=void 0)}this._source&&this._source.meshMap&&(this._source.meshMap[this.uniqueId]=void 0)}else for(var n=0,s=this.getScene().meshes;n<s.length;n++){var a;(a=s[n])._source&&a._source===this&&(a._source=null)}for(this._source=null,this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();t.prototype.dispose.call(this,e,r)},e.prototype.applyDisplacementMap=function(t,e,r,i,n,a,o){var u=this;void 0===o&&(o=!1);var h=this.getScene();return s.h.LoadImage(t,function(t){var s=document.createElement("canvas"),h=s.getContext("2d"),c=t.width,l=t.height;s.width=c,s.height=l,h.drawImage(t,0,0);var d=h.getImageData(0,0,c,l).data;u.applyDisplacementMapFromBuffer(d,c,l,e,r,n,a,o),i&&i(u)},function(){},h.offlineProvider),this},e.prototype.applyDisplacementMapFromBuffer=function(t,e,r,i,n,s,a,o){if(void 0===o&&(o=!1),!this.isVerticesDataPresent(c.b.PositionKind)||!this.isVerticesDataPresent(c.b.NormalKind)||!this.isVerticesDataPresent(c.b.UVKind))return M.a.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var h=this.getVerticesData(c.b.PositionKind,!0,!0),d=this.getVerticesData(c.b.NormalKind),f=this.getVerticesData(c.b.UVKind),p=u.Vector3.Zero(),g=u.Vector3.Zero(),m=u.Vector2.Zero();s=s||u.Vector2.Zero(),a=a||new u.Vector2(1,1);for(var v=0;v<h.length;v+=3){u.Vector3.FromArrayToRef(h,v,p),u.Vector3.FromArrayToRef(d,v,g),u.Vector2.FromArrayToRef(f,v/3*2,m);var y=4*((Math.abs(m.x*a.x+s.x)*e%e|0)+(Math.abs(m.y*a.y+s.y)*r%r|0)*e),b=.3*(t[y]/255)+.59*(t[y+1]/255)+.11*(t[y+2]/255);g.normalize(),g.scaleInPlace(i+(n-i)*b),(p=p.add(g)).toArray(h,v)}return l.a.ComputeNormals(h,this.getIndices(),d),o?(this.setVerticesData(c.b.PositionKind,h),this.setVerticesData(c.b.NormalKind,d)):(this.updateVerticesData(c.b.PositionKind,h),this.updateVerticesData(c.b.NormalKind,d)),this},e.prototype.convertToFlatShadedMesh=function(){var t,e,r=this.getVerticesDataKinds(),i={},n={},s={},a=!1;for(t=0;t<r.length;t++){e=r[t];var o=this.getVertexBuffer(e);e!==c.b.NormalKind?(i[e]=o,n[e]=i[e].getData(),s[e]=[]):(a=o.isUpdatable(),r.splice(t,1),t--)}var h,l=this.subMeshes.slice(0),d=this.getIndices(),f=this.getTotalIndices();for(h=0;h<f;h++){var g=d[h];for(t=0;t<r.length;t++)for(var m=i[e=r[t]].getStrideSize(),v=0;v<m;v++)s[e].push(n[e][g*m+v])}var y=[],b=s[c.b.PositionKind];for(h=0;h<f;h+=3){d[h]=h,d[h+1]=h+1,d[h+2]=h+2;for(var _=u.Vector3.FromArray(b,3*h),x=u.Vector3.FromArray(b,3*(h+1)),M=u.Vector3.FromArray(b,3*(h+2)),T=_.subtract(x),A=M.subtract(x),D=u.Vector3.Normalize(u.Vector3.Cross(T,A)),I=0;I<3;I++)y.push(D.x),y.push(D.y),y.push(D.z)}for(this.setIndices(d),this.setVerticesData(c.b.NormalKind,y,a),t=0;t<r.length;t++)e=r[t],this.setVerticesData(e,s[e],i[e].isUpdatable());this.releaseSubMeshes();for(var V=0;V<l.length;V++){var w=l[V];p.b.AddToMesh(w.materialIndex,w.indexStart,w.indexCount,w.indexStart,w.indexCount,this)}return this.synchronizeInstances(),this},e.prototype.convertToUnIndexedMesh=function(){var t,e,r=this.getVerticesDataKinds(),i={},n={},s={};for(t=0;t<r.length;t++){e=r[t];var a=this.getVertexBuffer(e);i[e]=a,n[e]=i[e].getData(),s[e]=[]}var o,u=this.subMeshes.slice(0),h=this.getIndices(),c=this.getTotalIndices();for(o=0;o<c;o++){var l=h[o];for(t=0;t<r.length;t++)for(var d=i[e=r[t]].getStrideSize(),f=0;f<d;f++)s[e].push(n[e][l*d+f])}for(o=0;o<c;o+=3)h[o]=o,h[o+1]=o+1,h[o+2]=o+2;for(this.setIndices(h),t=0;t<r.length;t++)e=r[t],this.setVerticesData(e,s[e],i[e].isUpdatable());this.releaseSubMeshes();for(var g=0;g<u.length;g++){var m=u[g];p.b.AddToMesh(m.materialIndex,m.indexStart,m.indexCount,m.indexStart,m.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},e.prototype.flipFaces=function(t){void 0===t&&(t=!1);var e,r,i=l.a.ExtractFromMesh(this);if(t&&this.isVerticesDataPresent(c.b.NormalKind)&&i.normals)for(e=0;e<i.normals.length;e++)i.normals[e]*=-1;if(i.indices)for(e=0;e<i.indices.length;e+=3)r=i.indices[e+1],i.indices[e+1]=i.indices[e+2],i.indices[e+2]=r;return i.applyToMesh(this),this},e.prototype.createInstance=function(t){return e._instancedMeshFactory(t,this)},e.prototype.synchronizeInstances=function(){for(var t=0;t<this.instances.length;t++){this.instances[t]._syncSubMeshes()}return this},e.prototype.optimizeIndices=function(t){var e=this,r=this.getIndices(),i=this.getVerticesData(c.b.PositionKind);if(!i||!r)return this;for(var n=new Array,a=0;a<i.length;a+=3)n.push(u.Vector3.FromArray(i,a));var o=new Array;return s.a.SyncAsyncForLoop(n.length,40,function(t){for(var e=n.length-1-t,r=n[e],i=0;i<e;++i){var s=n[i];if(r.equals(s)){o[e]=i;break}}},function(){for(var i=0;i<r.length;++i)r[i]=o[r[i]]||r[i];var n=e.subMeshes.slice(0);e.setIndices(r),e.subMeshes=n,t&&t(e)}),this},e.prototype.serialize=function(t){t.name=this.name,t.id=this.id,t.type=this.getClassName(),o.a&&o.a.HasTags(this)&&(t.tags=o.a.GetTags(this)),t.position=this.position.asArray(),this.rotationQuaternion?t.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(t.rotation=this.rotation.asArray()),t.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?t.pivotMatrix=this.getPivotMatrix().asArray():t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(!1),t.isVisible=this.isVisible,t.infiniteDistance=this.infiniteDistance,t.pickable=this.isPickable,t.receiveShadows=this.receiveShadows,t.billboardMode=this.billboardMode,t.visibility=this.visibility,t.checkCollisions=this.checkCollisions,t.isBlocker=this.isBlocker,this.parent&&(t.parentId=this.parent.id),t.isUnIndexed=this.isUnIndexed;var e=this._geometry;if(e){var r=e.id;t.geometryId=r,t.subMeshes=[];for(var i=0;i<this.subMeshes.length;i++){var n=this.subMeshes[i];t.subMeshes.push({materialIndex:n.materialIndex,verticesStart:n.verticesStart,verticesCount:n.verticesCount,indexStart:n.indexStart,indexCount:n.indexCount})}}this.material?t.materialId=this.material.id:this.material=null,this.morphTargetManager&&(t.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(t.skeletonId=this.skeleton.id);var s=this.getPhysicsImpostor();s&&(t.physicsMass=s.getParam("mass"),t.physicsFriction=s.getParam("friction"),t.physicsRestitution=s.getParam("mass"),t.physicsImpostor=s.type),this.metadata&&(t.metadata=this.metadata),t.instances=[];for(var a=0;a<this.instances.length;a++){var u=this.instances[a];if(!u.doNotSerialize){var h={name:u.name,id:u.id,position:u.position.asArray(),scaling:u.scaling.asArray()};u.parent&&(h.parentId=u.parent.id),u.rotationQuaternion?h.rotationQuaternion=u.rotationQuaternion.asArray():u.rotation&&(h.rotation=u.rotation.asArray()),t.instances.push(h),x.a.AppendSerializedAnimations(u,h),h.ranges=u.serializeAnimationRanges()}}x.a.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.layerMask=this.layerMask,t.alphaIndex=this.alphaIndex,t.hasVertexAlpha=this.hasVertexAlpha,t.overlayAlpha=this.overlayAlpha,t.overlayColor=this.overlayColor.asArray(),t.renderOverlay=this.renderOverlay,t.applyFog=this.applyFog,this.actionManager&&(t.actions=this.actionManager.serialize(this.name))},e.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var t=this._morphTargetManager;if(t&&t.vertexCount){if(t.vertexCount!==this.getTotalVertices())return M.a.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var e=0;e<t.numInfluencers;e++){var r=t.getActiveTarget(e),i=r.getPositions();if(!i)return void M.a.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(c.b.PositionKind+e,i,!1,3);var n=r.getNormals();n&&this.geometry.setVerticesData(c.b.NormalKind+e,n,!1,3);var s=r.getTangents();s&&this.geometry.setVerticesData(c.b.TangentKind+e,s,!1,3)}}else for(e=0;this.geometry.isVerticesDataPresent(c.b.PositionKind+e);)this.geometry.removeVerticesData(c.b.PositionKind+e),this.geometry.isVerticesDataPresent(c.b.NormalKind+e)&&this.geometry.removeVerticesData(c.b.NormalKind+e),this.geometry.isVerticesDataPresent(c.b.TangentKind+e)&&this.geometry.removeVerticesData(c.b.TangentKind+e),e++}},e.Parse=function(t,r,i){var n;if((n=t.type&&"GroundMesh"===t.type?e._GroundMeshParser(t,r):new e(t.name,r)).id=t.id,o.a&&o.a.AddTagsTo(n,t.tags),n.position=u.Vector3.FromArray(t.position),void 0!==t.metadata&&(n.metadata=t.metadata),t.rotationQuaternion?n.rotationQuaternion=u.Quaternion.FromArray(t.rotationQuaternion):t.rotation&&(n.rotation=u.Vector3.FromArray(t.rotation)),n.scaling=u.Vector3.FromArray(t.scaling),t.localMatrix?n.setPreTransformMatrix(u.Matrix.FromArray(t.localMatrix)):t.pivotMatrix&&n.setPivotMatrix(u.Matrix.FromArray(t.pivotMatrix)),n.setEnabled(t.isEnabled),n.isVisible=t.isVisible,n.infiniteDistance=t.infiniteDistance,n.showBoundingBox=t.showBoundingBox,n.showSubMeshesBoundingBox=t.showSubMeshesBoundingBox,void 0!==t.applyFog&&(n.applyFog=t.applyFog),void 0!==t.pickable&&(n.isPickable=t.pickable),void 0!==t.alphaIndex&&(n.alphaIndex=t.alphaIndex),n.receiveShadows=t.receiveShadows,n.billboardMode=t.billboardMode,void 0!==t.visibility&&(n.visibility=t.visibility),n.checkCollisions=t.checkCollisions,void 0!==t.isBlocker&&(n.isBlocker=t.isBlocker),n._shouldGenerateFlatShading=t.useFlatShading,t.freezeWorldMatrix&&(n._waitingFreezeWorldMatrix=t.freezeWorldMatrix),t.parentId&&(n._waitingParentId=t.parentId),void 0!==t.actions&&(n._waitingActions=t.actions),void 0!==t.overlayAlpha&&(n.overlayAlpha=t.overlayAlpha),void 0!==t.overlayColor&&(n.overlayColor=u.Color3.FromArray(t.overlayColor)),void 0!==t.renderOverlay&&(n.renderOverlay=t.renderOverlay),n.isUnIndexed=!!t.isUnIndexed,n.hasVertexAlpha=t.hasVertexAlpha,t.delayLoadingFile?(n.delayLoadState=_.a.DELAYLOADSTATE_NOTLOADED,n.delayLoadingFile=i+t.delayLoadingFile,n._boundingInfo=new g.a(u.Vector3.FromArray(t.boundingBoxMinimum),u.Vector3.FromArray(t.boundingBoxMaximum)),t._binaryInfo&&(n._binaryInfo=t._binaryInfo),n._delayInfo=[],t.hasUVs&&n._delayInfo.push(c.b.UVKind),t.hasUVs2&&n._delayInfo.push(c.b.UV2Kind),t.hasUVs3&&n._delayInfo.push(c.b.UV3Kind),t.hasUVs4&&n._delayInfo.push(c.b.UV4Kind),t.hasUVs5&&n._delayInfo.push(c.b.UV5Kind),t.hasUVs6&&n._delayInfo.push(c.b.UV6Kind),t.hasColors&&n._delayInfo.push(c.b.ColorKind),t.hasMatricesIndices&&n._delayInfo.push(c.b.MatricesIndicesKind),t.hasMatricesWeights&&n._delayInfo.push(c.b.MatricesWeightsKind),n._delayLoadingFunction=d.d._ImportGeometry,y.a.ForceFullSceneLoadingForIncremental&&n._checkDelayState()):d.d._ImportGeometry(t,n),t.materialId?n.setMaterialByID(t.materialId):n.material=null,t.morphTargetManagerId>-1&&(n.morphTargetManager=r.getMorphTargetManagerById(t.morphTargetManagerId)),t.skeletonId>-1&&(n.skeleton=r.getLastSkeletonByID(t.skeletonId),t.numBoneInfluencers&&(n.numBoneInfluencers=t.numBoneInfluencers)),t.animations){for(var s=0;s<t.animations.length;s++){var a=t.animations[s];n.animations.push(v.a.Parse(a))}h.a.ParseAnimationRanges(n,t,r)}if(t.autoAnimate&&r.beginAnimation(n,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),t.layerMask&&!isNaN(t.layerMask)?n.layerMask=Math.abs(parseInt(t.layerMask)):n.layerMask=268435455,t.physicsImpostor&&(n.physicsImpostor=new b.a(n,t.physicsImpostor,{mass:t.physicsMass,friction:t.physicsFriction,restitution:t.physicsRestitution},r)),t.instances)for(var l=0;l<t.instances.length;l++){var f=t.instances[l],p=n.createInstance(f.name);if(f.id&&(p.id=f.id),o.a&&(f.tags?o.a.AddTagsTo(p,f.tags):o.a.AddTagsTo(p,t.tags)),p.position=u.Vector3.FromArray(f.position),f.parentId&&(p._waitingParentId=f.parentId),f.rotationQuaternion?p.rotationQuaternion=u.Quaternion.FromArray(f.rotationQuaternion):f.rotation&&(p.rotation=u.Vector3.FromArray(f.rotation)),p.scaling=u.Vector3.FromArray(f.scaling),null!=f.checkCollisions&&null!=f.checkCollisions&&(p.checkCollisions=f.checkCollisions),null!=f.pickable&&null!=f.pickable&&(p.isPickable=f.pickable),null!=f.showBoundingBox&&null!=f.showBoundingBox&&(p.showBoundingBox=f.showBoundingBox),null!=f.showSubMeshesBoundingBox&&null!=f.showSubMeshesBoundingBox&&(p.showSubMeshesBoundingBox=f.showSubMeshesBoundingBox),null!=f.alphaIndex&&null!=f.showSubMeshesBoundingBox&&(p.alphaIndex=f.alphaIndex),f.physicsImpostor&&(p.physicsImpostor=new b.a(p,f.physicsImpostor,{mass:f.physicsMass,friction:f.physicsFriction,restitution:f.physicsRestitution},r)),f.animations){for(s=0;s<f.animations.length;s++)a=f.animations[s],p.animations.push(v.a.Parse(a));h.a.ParseAnimationRanges(p,f,r),f.autoAnimate&&r.beginAnimation(p,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1)}}return n},e.CreateRibbon=function(t,e,r,i,n,s,a,o,u){throw"Import MeshBuilder before creating meshes."},e.CreateDisc=function(t,e,r,i,n,s){throw void 0===i&&(i=null),"Import MeshBuilder before creating meshes."},e.CreateBox=function(t,e,r,i,n){throw void 0===r&&(r=null),"Import MeshBuilder before creating meshes."},e.CreateSphere=function(t,e,r,i,n,s){throw"Import MeshBuilder before creating meshes."},e.CreateCylinder=function(t,e,r,i,n,s,a,o,u){throw"Import MeshBuilder before creating meshes."},e.CreateTorus=function(t,e,r,i,n,s,a){throw"Import MeshBuilder before creating meshes."},e.CreateTorusKnot=function(t,e,r,i,n,s,a,o,u,h){throw"Import MeshBuilder before creating meshes."},e.CreateLines=function(t,e,r,i,n){throw void 0===r&&(r=null),void 0===i&&(i=!1),void 0===n&&(n=null),"Import MeshBuilder before creating meshes."},e.CreateDashedLines=function(t,e,r,i,n,s,a,o){throw void 0===s&&(s=null),"Import MeshBuilder before creating meshes."},e.CreatePolygon=function(t,e,r,i,n,s){throw"Import MeshBuilder before creating meshes."},e.ExtrudePolygon=function(t,e,r,i,n,s,a){throw"Import MeshBuilder before creating meshes."},e.ExtrudeShape=function(t,e,r,i,n,s,a,o,u,h){throw void 0===a&&(a=null),"Import MeshBuilder before creating meshes."},e.ExtrudeShapeCustom=function(t,e,r,i,n,s,a,o,u,h,c,l){throw"Import MeshBuilder before creating meshes."},e.CreateLathe=function(t,e,r,i,n,s,a){throw"Import MeshBuilder before creating meshes."},e.CreatePlane=function(t,e,r,i,n){throw"Import MeshBuilder before creating meshes."},e.CreateGround=function(t,e,r,i,n,s){throw"Import MeshBuilder before creating meshes."},e.CreateTiledGround=function(t,e,r,i,n,s,a,o,u){throw"Import MeshBuilder before creating meshes."},e.CreateGroundFromHeightMap=function(t,e,r,i,n,s,a,o,u,h,c){throw"Import MeshBuilder before creating meshes."},e.CreateTube=function(t,e,r,i,n,s,a,o,u,h){throw"Import MeshBuilder before creating meshes."},e.CreatePolyhedron=function(t,e,r){throw"Import MeshBuilder before creating meshes."},e.CreateIcoSphere=function(t,e,r){throw"Import MeshBuilder before creating meshes."},e.CreateDecal=function(t,e,r,i,n,s){throw"Import MeshBuilder before creating meshes."},e.prototype.setPositionsForCPUSkinning=function(){if(!this._sourcePositions){var t=this.getVerticesData(c.b.PositionKind);if(!t)return this._sourcePositions;this._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(c.b.PositionKind)||this.setVerticesData(c.b.PositionKind,t,!0)}return this._sourcePositions},e.prototype.setNormalsForCPUSkinning=function(){if(!this._sourceNormals){var t=this.getVerticesData(c.b.NormalKind);if(!t)return this._sourceNormals;this._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(c.b.NormalKind)||this.setVerticesData(c.b.NormalKind,t,!0)}return this._sourceNormals},e.prototype.applySkeleton=function(t){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(c.b.PositionKind))return this;if(!this.isVerticesDataPresent(c.b.NormalKind))return this;if(!this.isVerticesDataPresent(c.b.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(c.b.MatricesWeightsKind))return this;if(!this._sourcePositions){var e=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=e}this._sourceNormals||this.setNormalsForCPUSkinning();var r=this.getVerticesData(c.b.PositionKind);if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r));var i=this.getVerticesData(c.b.NormalKind);if(!i)return this;i instanceof Float32Array||(i=new Float32Array(i));var n=this.getVerticesData(c.b.MatricesIndicesKind),s=this.getVerticesData(c.b.MatricesWeightsKind);if(!s||!n)return this;for(var a,o=this.numBoneInfluencers>4,h=o?this.getVerticesData(c.b.MatricesIndicesExtraKind):null,l=o?this.getVerticesData(c.b.MatricesWeightsExtraKind):null,d=t.getTransformMatrices(this),f=u.Vector3.Zero(),p=new u.Matrix,g=new u.Matrix,m=0,v=0;v<r.length;v+=3,m+=4){var y;for(a=0;a<4;a++)(y=s[m+a])>0&&(u.Matrix.FromFloat32ArrayToRefScaled(d,Math.floor(16*n[m+a]),y,g),p.addToSelf(g));if(o)for(a=0;a<4;a++)(y=l[m+a])>0&&(u.Matrix.FromFloat32ArrayToRefScaled(d,Math.floor(16*h[m+a]),y,g),p.addToSelf(g));u.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[v],this._sourcePositions[v+1],this._sourcePositions[v+2],p,f),f.toArray(r,v),u.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[v],this._sourceNormals[v+1],this._sourceNormals[v+2],p,f),f.toArray(i,v),p.reset()}return this.updateVerticesData(c.b.PositionKind,r),this.updateVerticesData(c.b.NormalKind,i),this},e.MinMax=function(t){var e=null,r=null;return t.forEach(function(t){var i=t.getBoundingInfo().boundingBox;e&&r?(e.minimizeInPlace(i.minimumWorld),r.maximizeInPlace(i.maximumWorld)):(e=i.minimumWorld,r=i.maximumWorld)}),e&&r?{min:e,max:r}:{min:u.Vector3.Zero(),max:u.Vector3.Zero()}},e.Center=function(t){var r=t instanceof Array?e.MinMax(t):t;return u.Vector3.Center(r.min,r.max)},e.MergeMeshes=function(t,r,i,n,s){var a;if(void 0===r&&(r=!0),!i){var o=0;for(a=0;a<t.length;a++)if(t[a]&&(o+=t[a].getTotalVertices())>65536)return M.a.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}var u,h=null,c=new Array,d=null;for(a=0;a<t.length;a++)if(t[a]){var f=t[a].computeWorldMatrix(!0);(u=l.a.ExtractFromMesh(t[a],!0,!0)).transform(f),h?h.merge(u,i):(h=u,d=t[a]),s&&c.push(t[a].getTotalIndices())}if(d=d,n||(n=new e(d.name+"_merged",d.getScene())),h.applyToMesh(n),n.material=d.material,n.checkCollisions=d.checkCollisions,r)for(a=0;a<t.length;a++)t[a]&&t[a].dispose();if(s){n.releaseSubMeshes(),a=0;for(var g=0;a<c.length;)p.b.CreateFromIndices(0,g,c[a],n),g+=c[a],a++}return n},e.prototype.addInstance=function(t){t._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(t)},e.prototype.removeInstance=function(t){var e=t._indexInSourceMeshInstanceArray;if(-1!=e){if(e!==this.instances.length-1){var r=this.instances[this.instances.length-1];this.instances[e]=r,r._indexInSourceMeshInstanceArray=e}t._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},e.FRONTSIDE=l.a.FRONTSIDE,e.BACKSIDE=l.a.BACKSIDE,e.DOUBLESIDE=l.a.DOUBLESIDE,e.DEFAULTSIDE=l.a.DEFAULTSIDE,e.NO_CAP=0,e.CAP_START=1,e.CAP_END=2,e.CAP_ALL=3,e._instancedMeshFactory=function(t,e){throw"Import InstancedMesh before creating instances."},e._GroundMeshParser=function(t,e){throw"Import GroundMesh before trying to parse it."},e}(f.a)},105:function(t,e,r){"use strict";r.d(e,"a",function(){return m});var i=r(12),n=r(68),s=r(4),a=r(11),o=r(30),u=r(9),h=r(98),c=r(58);function l(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}var d=l("DXT1"),f=l("DXT3"),p=l("DXT5"),g=l("DX10"),m=function(){function t(){}return t.GetDDSInfo=function(t){var e=new Int32Array(t,0,31),r=new Int32Array(t,0,35),i=1;131072&e[2]&&(i=Math.max(1,e[7]));var n=e[21],a=n===g?r[32]:0,o=s.a.TEXTURETYPE_UNSIGNED_INT;switch(n){case 113:o=s.a.TEXTURETYPE_HALF_FLOAT;break;case 116:o=s.a.TEXTURETYPE_FLOAT;break;case g:if(10===a){o=s.a.TEXTURETYPE_HALF_FLOAT;break}}return{width:e[4],height:e[3],mipmapCount:i,isFourCC:4==(4&e[20]),isRGB:64==(64&e[20]),isLuminance:131072==(131072&e[20]),isCube:512==(512&e[28]),isCompressed:n===d||n===f||n===p,dxgiFormat:a,textureType:o}},t._ToHalfFloat=function(e){t._FloatView||(t._FloatView=new Float32Array(1),t._Int32View=new Int32Array(t._FloatView.buffer)),t._FloatView[0]=e;var r=t._Int32View[0],i=r>>16&32768,n=r>>12&2047,s=r>>23&255;return s<103?i:s>142?(i|=31744,i|=(255==s?0:1)&&8388607&r):s<113?i|=((n|=2048)>>114-s)+(n>>113-s&1):(i|=s-112<<10|n>>1,i+=1&n)},t._FromHalfFloat=function(t){var e=(32768&t)>>15,r=(31744&t)>>10,i=1023&t;return 0===r?(e?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):31==r?i?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,r-15)*(1+i/Math.pow(2,10))},t._GetHalfFloatAsFloatRGBAArrayBuffer=function(e,r,i,n,s,a){for(var o=new Float32Array(n),u=new Uint16Array(s,i),h=0,c=0;c<r;c++)for(var l=0;l<e;l++){var d=4*(l+c*e);o[h]=t._FromHalfFloat(u[d]),o[h+1]=t._FromHalfFloat(u[d+1]),o[h+2]=t._FromHalfFloat(u[d+2]),t.StoreLODInAlphaChannel?o[h+3]=a:o[h+3]=t._FromHalfFloat(u[d+3]),h+=4}return o},t._GetHalfFloatRGBAArrayBuffer=function(e,r,i,n,s,a){if(t.StoreLODInAlphaChannel){for(var o=new Uint16Array(n),u=new Uint16Array(s,i),h=0,c=0;c<r;c++)for(var l=0;l<e;l++){var d=4*(l+c*e);o[h]=u[d],o[h+1]=u[d+1],o[h+2]=u[d+2],o[h+3]=t._ToHalfFloat(a),h+=4}return o}return new Uint16Array(s,i,n)},t._GetFloatRGBAArrayBuffer=function(e,r,i,n,s,a){if(t.StoreLODInAlphaChannel){for(var o=new Float32Array(n),u=new Float32Array(s,i),h=0,c=0;c<r;c++)for(var l=0;l<e;l++){var d=4*(l+c*e);o[h]=u[d],o[h+1]=u[d+1],o[h+2]=u[d+2],o[h+3]=a,h+=4}return o}return new Float32Array(s,i,n)},t._GetFloatAsUIntRGBAArrayBuffer=function(e,r,n,s,a,o){for(var u=new Uint8Array(s),h=new Float32Array(a,n),c=0,l=0;l<r;l++)for(var d=0;d<e;d++){var f=4*(d+l*e);u[c]=255*i.a.Clamp(h[f]),u[c+1]=255*i.a.Clamp(h[f+1]),u[c+2]=255*i.a.Clamp(h[f+2]),t.StoreLODInAlphaChannel?u[c+3]=o:u[c+3]=255*i.a.Clamp(h[f+3]),c+=4}return u},t._GetHalfFloatAsUIntRGBAArrayBuffer=function(e,r,n,s,a,o){for(var u=new Uint8Array(s),h=new Uint16Array(a,n),c=0,l=0;l<r;l++)for(var d=0;d<e;d++){var f=4*(d+l*e);u[c]=255*i.a.Clamp(t._FromHalfFloat(h[f])),u[c+1]=255*i.a.Clamp(t._FromHalfFloat(h[f+1])),u[c+2]=255*i.a.Clamp(t._FromHalfFloat(h[f+2])),t.StoreLODInAlphaChannel?u[c+3]=o:u[c+3]=255*i.a.Clamp(t._FromHalfFloat(h[f+3])),c+=4}return u},t._GetRGBAArrayBuffer=function(t,e,r,i,n,s,a,o,u){for(var h=new Uint8Array(i),c=new Uint8Array(n,r),l=0,d=0;d<e;d++)for(var f=0;f<t;f++){var p=4*(f+d*t);h[l]=c[p+s],h[l+1]=c[p+a],h[l+2]=c[p+o],h[l+3]=c[p+u],l+=4}return h},t._ExtractLongWordOrder=function(e){return 0===e||255===e||-16777216===e?0:1+t._ExtractLongWordOrder(e>>8)},t._GetRGBArrayBuffer=function(t,e,r,i,n,s,a,o){for(var u=new Uint8Array(i),h=new Uint8Array(n,r),c=0,l=0;l<e;l++)for(var d=0;d<t;d++){var f=3*(d+l*t);u[c]=h[f+s],u[c+1]=h[f+a],u[c+2]=h[f+o],c+=3}return u},t._GetLuminanceArrayBuffer=function(t,e,r,i,n){for(var s=new Uint8Array(i),a=new Uint8Array(n,r),o=0,u=0;u<e;u++)for(var h=0;h<t;h++){var c=h+u*t;s[o]=a[c],o++}return s},t.UploadDDSLevels=function(e,r,i,n,a,o,c,l){void 0===c&&(c=-1);var m=null;n.sphericalPolynomial&&(m=new Array);var v,y,b,_,x,M,T,A=e.getCaps().s3tc,D=new Int32Array(i,0,31),I=0,V=0,w=1;if(542327876===D[0])if(n.isFourCC||n.isRGB||n.isLuminance)if(!n.isCompressed||A){var E=D[22];_=D[1]+4;var S,C=!1;if(n.isFourCC)switch(v=D[21]){case d:w=8,V=A.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case f:w=16,V=A.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case p:w=16,V=A.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 113:case 116:C=!0;break;case g:_+=20;var P=!1;switch(n.dxgiFormat){case 10:C=!0,P=!0;break;case 88:n.isRGB=!0,n.isFourCC=!1,E=32,P=!0}if(P)break;default:return void console.error("Unsupported FourCC code:",(S=v,String.fromCharCode(255&S,S>>8&255,S>>16&255,S>>24&255)))}var O=t._ExtractLongWordOrder(D[23]),F=t._ExtractLongWordOrder(D[24]),R=t._ExtractLongWordOrder(D[25]),B=t._ExtractLongWordOrder(D[26]);C&&(V=e._getRGBABufferInternalSizedFormat(n.textureType)),M=1,131072&D[2]&&!1!==a&&(M=Math.max(1,D[7]));for(var L=0;L<o;L++){for(y=D[4],b=D[3],T=0;T<M;++T){if(-1===c||c===T){var U=-1===c?T:0;if(!n.isCompressed&&n.isFourCC){r.format=s.a.TEXTUREFORMAT_RGBA,I=y*b*4;var z=null;e._badOS||e._badDesktopOS||!e.getCaps().textureHalfFloat&&!e.getCaps().textureFloat?(128===E?(z=t._GetFloatAsUIntRGBAArrayBuffer(y,b,_,I,i,U),m&&0==U&&m.push(t._GetFloatRGBAArrayBuffer(y,b,_,I,i,U))):64===E&&(z=t._GetHalfFloatAsUIntRGBAArrayBuffer(y,b,_,I,i,U),m&&0==U&&m.push(t._GetHalfFloatAsFloatRGBAArrayBuffer(y,b,_,I,i,U))),r.type=s.a.TEXTURETYPE_UNSIGNED_INT):128===E?(r.type=s.a.TEXTURETYPE_FLOAT,z=t._GetFloatRGBAArrayBuffer(y,b,_,I,i,U),m&&0==U&&m.push(z)):64!==E||e.getCaps().textureHalfFloat?(r.type=s.a.TEXTURETYPE_HALF_FLOAT,z=t._GetHalfFloatRGBAArrayBuffer(y,b,_,I,i,U),m&&0==U&&m.push(t._GetHalfFloatAsFloatRGBAArrayBuffer(y,b,_,I,i,U))):(r.type=s.a.TEXTURETYPE_FLOAT,z=t._GetHalfFloatAsFloatRGBAArrayBuffer(y,b,_,I,i,U),m&&0==U&&m.push(z)),z&&e._uploadDataToTextureDirectly(r,z,L,U)}else if(n.isRGB)r.type=s.a.TEXTURETYPE_UNSIGNED_INT,24===E?(r.format=s.a.TEXTUREFORMAT_RGB,I=y*b*3,x=t._GetRGBArrayBuffer(y,b,_,I,i,O,F,R),e._uploadDataToTextureDirectly(r,x,L,U)):(r.format=s.a.TEXTUREFORMAT_RGBA,I=y*b*4,x=t._GetRGBAArrayBuffer(y,b,_,I,i,O,F,R,B),e._uploadDataToTextureDirectly(r,x,L,U));else if(n.isLuminance){var N=e._getUnpackAlignement(),k=y;I=Math.floor((y+N-1)/N)*N*(b-1)+k,x=t._GetLuminanceArrayBuffer(y,b,_,I,i),r.format=s.a.TEXTUREFORMAT_LUMINANCE,r.type=s.a.TEXTURETYPE_UNSIGNED_INT,e._uploadDataToTextureDirectly(r,x,L,U)}else I=Math.max(4,y)/4*Math.max(4,b)/4*w,x=new Uint8Array(i,_,I),r.type=s.a.TEXTURETYPE_UNSIGNED_INT,e._uploadCompressedDataToTextureDirectly(r,V,y,b,x,L,U)}_+=E?y*b*(E/8):I,y*=.5,b*=.5,y=Math.max(1,y),b=Math.max(1,b)}if(void 0!==l)break}m&&m.length>0?n.sphericalPolynomial=h.a.ConvertCubeMapToSphericalPolynomial({size:D[4],right:m[0],left:m[1],up:m[2],down:m[3],front:m[4],back:m[5],format:s.a.TEXTUREFORMAT_RGBA,type:s.a.TEXTURETYPE_FLOAT,gammaSpace:!1}):n.sphericalPolynomial=void 0}else u.a.Error("Compressed textures are not supported on this platform.");else u.a.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");else u.a.Error("Invalid magic number in DDS header")},t.StoreLODInAlphaChannel=!1,t}();a.Engine.prototype.createPrefilteredCubeTexture=function(t,e,r,s,a,h,l,d,f){var p=this;void 0===a&&(a=null),void 0===h&&(h=null),void 0===d&&(d=null),void 0===f&&(f=!0);return this.createCubeTexture(t,e,null,!1,function(t){if(t){var h=t.texture;if(f?t.info.sphericalPolynomial&&(h._sphericalPolynomial=t.info.sphericalPolynomial):h._sphericalPolynomial=new n.b,h._dataSource=o.a.DATASOURCE_CUBEPREFILTERED,p.getCaps().textureLOD)a&&a(h);else{var l=p._gl,d=t.width;if(d){for(var g=[],v=0;v<3;v++){var y=1-v/2,b=s,_=i.a.Log2(d)*r+s,x=b+(_-b)*y,M=Math.round(Math.min(Math.max(x,0),_)),T=new o.a(p,o.a.DATASOURCE_TEMP);if(T.type=h.type,T.format=h.format,T.width=Math.pow(2,Math.max(i.a.Log2(d)-M,0)),T.height=T.width,T.isCube=!0,p._bindTextureDirectly(l.TEXTURE_CUBE_MAP,T,!0),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),t.isDDS){var A=t.info,D=t.data;p._unpackFlipY(A.isCompressed),m.UploadDDSLevels(p,T,D,A,!0,6,M)}else u.a.Warn("DDS is the only prefiltered cube map supported so far.");p._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null);var I=new c.a(e);I.isCube=!0,I._texture=T,T.isReady=!0,g.push(I)}h._lodTextureHigh=g[2],h._lodTextureMid=g[1],h._lodTextureLow=g[0],a&&a(h)}}}else a&&a(null)},h,l,d,f,r,s)}},112:function(t,e,r){"use strict";r.d(e,"a",function(){return f});var i=r(5),n=r(0),s=r(12),a=r(68),o=r(30),u=r(58),h=r(4),c=r(19),l=r(18),d=r(9),f=(r(285),r(286),function(){function t(){}return t.GetEnvInfo=function(e){for(var r=new DataView(e),i=0,n=0;n<t._MagicBytes.length;n++)if(r.getUint8(i++)!==t._MagicBytes[n])return d.a.Error("Not a babylon environment map"),null;for(var s="",a=0;a=r.getUint8(i++);)s+=String.fromCharCode(a);var o=JSON.parse(s);return o.specular&&(o.specular.specularDataPosition=i,o.specular.lodGenerationScale=o.specular.lodGenerationScale||.8),o},t.CreateEnvTextureAsync=function(e){var r=this,n=e.getInternalTexture();if(!n)return Promise.reject("The cube texture is invalid.");if(!e._prefiltered)return Promise.reject("The cube texture is invalid (not prefiltered).");var a=n.getEngine();if(a&&a.premultipliedAlpha)return Promise.reject("Env texture can only be created when the engine is created with the premultipliedAlpha option set to false.");if(e.textureType===h.a.TEXTURETYPE_UNSIGNED_INT)return Promise.reject("The cube texture should allow HDR (Full Float or Half Float).");var o=a.getRenderingCanvas();if(!o)return Promise.reject("Env texture can only be created when the engine is associated to a canvas.");var u=h.a.TEXTURETYPE_FLOAT;if(!a.getCaps().textureFloatRender&&(u=h.a.TEXTURETYPE_HALF_FLOAT,!a.getCaps().textureHalfFloatRender))return Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.");var d=n.width,f=new c.Scene(a),p={},g=[],m=s.a.Log2(n.width);m=Math.round(m);for(var v=function(t){for(var r=Math.pow(2,m-t),n=function(n){var s=e.readPixels(n,t),c=a.createRawTexture(s,r,r,h.a.TEXTUREFORMAT_RGBA,!1,!1,h.a.TEXTURE_NEAREST_SAMPLINGMODE,null,u),d=new Promise(function(e,s){var u=new l.a("rgbdEncode","rgbdEncode",null,null,1,null,h.a.TEXTURE_NEAREST_SAMPLINGMODE,a,!1,void 0,h.a.TEXTURETYPE_UNSIGNED_INT,void 0,null,!1);u.getEffect().executeWhenCompiled(function(){u.onApply=function(t){t._bindTexture("textureSampler",c)};var s=a.getRenderWidth(),h=a.getRenderHeight();a.setSize(r,r),f.postProcessManager.directRender([u],null),i.h.ToBlob(o,function(r){var i=new FileReader;i.onload=function(r){var i=r.target.result;p[6*t+n]=i,e()},i.readAsArrayBuffer(r)}),a.setSize(s,h)})});g.push(d)},s=0;s<6;s++)n(s)},y=0;y<=m;y++)v(y);return Promise.all(g).then(function(){f.dispose();for(var i={version:1,width:d,irradiance:r._CreateEnvTextureIrradiance(e),specular:{mipmaps:[],lodGenerationScale:e.lodGenerationScale}},n=0,s=0;s<=m;s++)for(var a=0;a<6;a++){var o=p[6*s+a].byteLength;i.specular.mipmaps.push({length:o,position:n}),n+=o}for(var u=JSON.stringify(i),h=new ArrayBuffer(u.length+1),c=new Uint8Array(h),l=(s=0,u.length);s<l;s++)c[s]=u.charCodeAt(s);c[u.length]=0;var g=t._MagicBytes.length+n+h.byteLength,v=new ArrayBuffer(g),y=new Uint8Array(v),b=new DataView(v),_=0;for(s=0;s<t._MagicBytes.length;s++)b.setUint8(_++,t._MagicBytes[s]);y.set(new Uint8Array(h),_),_+=h.byteLength;for(s=0;s<=m;s++)for(a=0;a<6;a++){var x=p[6*s+a];y.set(new Uint8Array(x),_),_+=x.byteLength}return v})},t._CreateEnvTextureIrradiance=function(t){var e=t.sphericalPolynomial;return null==e?null:{x:[e.x.x,e.x.y,e.x.z],y:[e.y.x,e.y.y,e.y.z],z:[e.z.x,e.z.y,e.z.z],xx:[e.xx.x,e.xx.y,e.xx.z],yy:[e.yy.x,e.yy.y,e.yy.z],zz:[e.zz.x,e.zz.y,e.zz.z],yz:[e.yz.x,e.yz.y,e.yz.z],zx:[e.zx.x,e.zx.y,e.zx.z],xy:[e.xy.x,e.xy.y,e.xy.z]}},t.UploadEnvLevelsAsync=function(e,r,i){if(1!==i.version)throw new Error('Unsupported babylon environment map version "'+i.version+'"');var n=i.specular;if(!n)return Promise.resolve();var a=s.a.Log2(i.width);if(a=Math.round(a)+1,n.mipmaps.length!==6*a)throw new Error('Unsupported specular mipmaps number "'+n.mipmaps.length+'"');e._lodGenerationScale=n.lodGenerationScale;for(var o=new Array(a),u=0;u<a;u++){o[u]=new Array(6);for(var h=0;h<6;h++){var c=n.mipmaps[6*u+h];o[u][h]=new Uint8Array(r,n.specularDataPosition+c.position,c.length)}}return t.UploadLevelsAsync(e,o)},t.UploadLevelsAsync=function(t,e){if(!i.h.IsExponentOfTwo(t.width))throw new Error("Texture size must be a power of two");var r=Math.round(s.a.Log2(t.width))+1,n=t.getEngine(),a=!1,c=!1,d=null,f=null,p=null,g=n.getCaps();if(t.format=h.a.TEXTUREFORMAT_RGBA,t.type=h.a.TEXTURETYPE_UNSIGNED_INT,t.generateMipMaps=!0,n.updateTextureSamplingMode(h.a.TEXTURE_TRILINEAR_SAMPLINGMODE,t),g.textureLOD?n.webGLVersion<2?a=!1:g.textureHalfFloatRender&&g.textureHalfFloatLinearFiltering?(a=!0,t.type=h.a.TEXTURETYPE_HALF_FLOAT):g.textureFloatRender&&g.textureFloatLinearFiltering&&(a=!0,t.type=h.a.TEXTURETYPE_FLOAT):(a=!1,c=!0,p={}),a)d=new l.a("rgbdDecode","rgbdDecode",null,null,1,null,h.a.TEXTURE_TRILINEAR_SAMPLINGMODE,n,!1,void 0,t.type,void 0,null,!1),t._isRGBD=!1,t.invertY=!1,f=n.createRenderTargetCubeTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:h.a.TEXTURE_TRILINEAR_SAMPLINGMODE,type:t.type,format:h.a.TEXTUREFORMAT_RGBA});else if(t._isRGBD=!0,t.invertY=!0,c)for(var m=t._lodGenerationScale,v=t._lodGenerationOffset,y=0;y<3;y++){var b=(r-1)*m+v,_=v+(b-v)*(1-y/2),x=Math.round(Math.min(Math.max(_,0),b)),M=new o.a(n,o.a.DATASOURCE_TEMP);M.isCube=!0,M.invertY=!0,M.generateMipMaps=!1,n.updateTextureSamplingMode(h.a.TEXTURE_LINEAR_LINEAR,M);var T=new u.a(null);switch(T.isCube=!0,T._texture=M,p[x]=T,y){case 0:t._lodTextureLow=T;break;case 1:t._lodTextureMid=T;break;case 2:t._lodTextureHigh=T}}var A=[],D=function(r){for(var i=function(i){var s=e[r][i],o=new Blob([s],{type:"image/png"}),u=URL.createObjectURL(o),l=new Image;l.src=u;var g=new Promise(function(e,s){l.onload=function(){if(a){var o=n.createTexture(null,!0,!0,null,h.a.TEXTURE_NEAREST_SAMPLINGMODE,null,function(t){s(t)},l);d.getEffect().executeWhenCompiled(function(){d.onApply=function(t){t._bindTexture("textureSampler",o),t.setFloat2("scale",1,1)},n.scenes[0].postProcessManager.directRender([d],f,!0,i,r),n.restoreDefaultFramebuffer(),o.dispose(),window.URL.revokeObjectURL(u),e()})}else{if(n._uploadImageToTexture(t,l,i,r),c){var g=p[r];g&&n._uploadImageToTexture(g._texture,l,i,0)}e()}},l.onerror=function(t){s(t)}});A.push(g)},s=0;s<6;s++)i(s)};for(y=0;y<e.length;y++)D(y);if(e.length<r){var I=void 0,V=Math.pow(2,r-1-e.length),w=V*V*4;switch(t.type){case h.a.TEXTURETYPE_UNSIGNED_INT:I=new Uint8Array(w);break;case h.a.TEXTURETYPE_HALF_FLOAT:I=new Uint16Array(w);break;case h.a.TEXTURETYPE_FLOAT:I=new Float32Array(w)}for(y=e.length;y<r;y++)for(var E=0;E<6;E++)n._uploadArrayBufferViewToTexture(t,I,E,y)}return Promise.all(A).then(function(){f&&(n._releaseFramebufferObjects(f),f._swapAndDie(t)),d&&d.dispose(),c&&(t._lodTextureHigh&&t._lodTextureHigh._texture&&(t._lodTextureHigh._texture.isReady=!0),t._lodTextureMid&&t._lodTextureMid._texture&&(t._lodTextureMid._texture.isReady=!0),t._lodTextureLow&&t._lodTextureLow._texture&&(t._lodTextureLow._texture.isReady=!0))})},t.UploadEnvSpherical=function(t,e){1!==e.version&&d.a.Warn('Unsupported babylon environment map version "'+e.version+'"');var r=e.irradiance;if(r){var i=new a.b;n.Vector3.FromArrayToRef(r.x,0,i.x),n.Vector3.FromArrayToRef(r.y,0,i.y),n.Vector3.FromArrayToRef(r.z,0,i.z),n.Vector3.FromArrayToRef(r.xx,0,i.xx),n.Vector3.FromArrayToRef(r.yy,0,i.yy),n.Vector3.FromArrayToRef(r.zz,0,i.zz),n.Vector3.FromArrayToRef(r.yz,0,i.yz),n.Vector3.FromArrayToRef(r.zx,0,i.zx),n.Vector3.FromArrayToRef(r.xy,0,i.xy),t._sphericalPolynomial=i}},t._UpdateRGBDAsync=function(e,r,i,n,s){return e._dataSource=o.a.DATASOURCE_CUBERAW_RGBD,e._bufferViewArrayArray=r,e._lodGenerationScale=n,e._lodGenerationOffset=s,e._sphericalPolynomial=i,t.UploadLevelsAsync(e,r).then(function(){e.isReady=!0})},t._MagicBytes=[134,22,135,150,246,214,150,54],t}());o.a._UpdateRGBDAsync=f._UpdateRGBDAsync},113:function(t,e,r){"use strict";r.d(e,"a",function(){return i});var i=function(){function t(){var t=this;this.promise=new Promise(function(e,r){t._resolve=e,t._reject=r})}return Object.defineProperty(t.prototype,"resolve",{get:function(){return this._resolve},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reject",{get:function(){return this._reject},enumerable:!0,configurable:!0}),t}()},117:function(t,e,r){"use strict";r.d(e,"a",function(){return u});var i=r(1),n=r(9),s=r(23),a=r(10),o=r(41);a.a._instancedMeshFactory=function(t,e){return new u(t,e)};var u=function(t){function e(e,r){var i=t.call(this,e,r.getScene())||this;return i._indexInSourceMeshInstanceArray=-1,r.addInstance(i),i._sourceMesh=r,i.position.copyFrom(r.position),i.rotation.copyFrom(r.rotation),i.scaling.copyFrom(r.scaling),r.rotationQuaternion&&(i.rotationQuaternion=r.rotationQuaternion.clone()),i.infiniteDistance=r.infiniteDistance,i.setPivotMatrix(r.getPivotMatrix()),i.refreshBoundingInfo(),i._syncSubMeshes(),i}return i.d(e,t),e.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(e.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(t){this._sourceMesh&&t!==this._sourceMesh.renderingGroupId&&n.a.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!0,configurable:!0}),e.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},e.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(e.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),e.prototype.isReady=function(t){return void 0===t&&(t=!1),this._sourceMesh.isReady(t,!0)},e.prototype.getVerticesData=function(t,e){return this._sourceMesh.getVerticesData(t,e)},e.prototype.setVerticesData=function(t,e,r,i){return this.sourceMesh&&this.sourceMesh.setVerticesData(t,e,r,i),this.sourceMesh},e.prototype.updateVerticesData=function(t,e,r,i){return this.sourceMesh&&this.sourceMesh.updateVerticesData(t,e,r,i),this.sourceMesh},e.prototype.setIndices=function(t,e){return void 0===e&&(e=null),this.sourceMesh&&this.sourceMesh.setIndices(t,e),this.sourceMesh},e.prototype.isVerticesDataPresent=function(t){return this._sourceMesh.isVerticesDataPresent(t)},e.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(e.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),e.prototype.refreshBoundingInfo=function(t){if(void 0===t&&(t=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var e=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(t),e),this},e.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},e.prototype._activate=function(t){return this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,t),this},e.prototype.getLOD=function(t){if(!t)return this;var e=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(t,e.boundingSphere),this._currentLOD===this.sourceMesh?this:this._currentLOD},e.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var t=0;t<this._sourceMesh.subMeshes.length;t++)this._sourceMesh.subMeshes[t].clone(this,this._sourceMesh);return this},e.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},e.prototype.clone=function(t,e,r){var i=this._sourceMesh.createInstance(t);if(o.a.DeepCopy(this,i,["name","subMeshes","uniqueId"],[]),this.refreshBoundingInfo(),e&&(i.parent=e),!r)for(var n=0;n<this.getScene().meshes.length;n++){var s=this.getScene().meshes[n];s.parent===this&&s.clone(s.name,i)}return i.computeWorldMatrix(!0),i},e.prototype.dispose=function(e,r){void 0===r&&(r=!1),this._sourceMesh.removeInstance(this),t.prototype.dispose.call(this,e,r)},e}(s.a)},134:function(t,e,r){"use strict";r.d(e,"a",function(){return c}),r.d(e,"b",function(){return l});var i=r(1),n=r(9),s=r(0),a=r(3),o=r(10),u=function(t){function e(e,r){var i=t.call(this,e.x,e.y)||this;return i.index=r,i}return i.d(e,t),e}(s.Vector2),h=function(){function t(){this.elements=new Array}return t.prototype.add=function(t){var e=this,r=new Array;return t.forEach(function(t){if(0===r.length||!t.equalsWithEpsilon(r[0])){var i=new u(t,e.elements.length);r.push(i),e.elements.push(i)}}),r},t.prototype.computeBounds=function(){var t=new s.Vector2(this.elements[0].x,this.elements[0].y),e=new s.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(r){r.x<t.x?t.x=r.x:r.x>e.x&&(e.x=r.x),r.y<t.y?t.y=r.y:r.y>e.y&&(e.y=r.y)}),{min:t,max:e,width:e.x-t.x,height:e.y-t.y}},t}(),c=function(){function t(){}return t.Rectangle=function(t,e,r,i){return[new s.Vector2(t,e),new s.Vector2(r,e),new s.Vector2(r,i),new s.Vector2(t,i)]},t.Circle=function(t,e,r,i){void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=32);for(var n=new Array,a=0,o=2*Math.PI/i,u=0;u<i;u++)n.push(new s.Vector2(e+Math.cos(a)*t,r+Math.sin(a)*t)),a-=o;return n},t.Parse=function(t){var e,r=t.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(t){return!isNaN(t)}),i=[];for(e=0;e<(2147483646&r.length);e+=2)i.push(new s.Vector2(r[e],r[e+1]));return i},t.StartingAt=function(t,e){return s.Path2.StartingAt(t,e)},t}(),l=function(){function t(t,e,r,i){var a;void 0===i&&(i=earcut),this._points=new h,this._outlinepoints=new h,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=i,this._name=t,this._scene=r,a=e instanceof s.Path2?e.getPoints():e,this._addToepoint(a),this._points.add(a),this._outlinepoints.add(a),void 0===this.bjsEarcut&&n.a.Warn("Earcut was not found, the polygon will not be built.")}return t.prototype._addToepoint=function(t){for(var e=0,r=t;e<r.length;e++){var i=r[e];this._epoints.push(i.x,i.y)}},t.prototype.addHole=function(t){this._points.add(t);var e=new h;return e.add(t),this._holes.push(e),this._eholes.push(this._epoints.length/2),this._addToepoint(t),this},t.prototype.build=function(t,e){var r=this;void 0===t&&(t=!1),void 0===e&&(e=0);var i=new o.a(this._name,this._scene),n=new Array,s=new Array,u=new Array,h=this._points.computeBounds();this._points.elements.forEach(function(t){n.push(0,1,0),s.push(t.x,0,t.y),u.push((t.x-h.min.x)/h.width,(t.y-h.min.y)/h.height)});for(var c=new Array,l=this.bjsEarcut(this._epoints,this._eholes,2),d=0;d<l.length;d++)c.push(l[d]);if(e>0){var f=s.length/3;this._points.elements.forEach(function(t){n.push(0,-1,0),s.push(t.x,-e,t.y),u.push(1-(t.x-h.min.x)/h.width,1-(t.y-h.min.y)/h.height)});var p=c.length;for(d=0;d<p;d+=3){var g=c[d+0],m=c[d+1],v=c[d+2];c.push(v+f),c.push(m+f),c.push(g+f)}this.addSide(s,n,u,c,h,this._outlinepoints,e,!1),this._holes.forEach(function(t){r.addSide(s,n,u,c,h,t,e,!0)})}return i.setVerticesData(a.b.PositionKind,s,t),i.setVerticesData(a.b.NormalKind,n,t),i.setVerticesData(a.b.UVKind,u,t),i.setIndices(c),i},t.prototype.addSide=function(t,e,r,i,n,a,o,u){for(var h=t.length/3,c=0,l=0;l<a.elements.length;l++){var d,f=a.elements[l];d=l+1>a.elements.length-1?a.elements[0]:a.elements[l+1],t.push(f.x,0,f.y),t.push(f.x,-o,f.y),t.push(d.x,0,d.y),t.push(d.x,-o,d.y);var p=new s.Vector3(f.x,0,f.y),g=new s.Vector3(d.x,0,d.y).subtract(p),m=new s.Vector3(0,1,0),v=s.Vector3.Cross(g,m);v=v.normalize(),r.push(c/n.width,0),r.push(c/n.width,1),c+=g.length(),r.push(c/n.width,0),r.push(c/n.width,1),u?(e.push(v.x,v.y,v.z),e.push(v.x,v.y,v.z),e.push(v.x,v.y,v.z),e.push(v.x,v.y,v.z),i.push(h),i.push(h+2),i.push(h+1),i.push(h+1),i.push(h+2),i.push(h+3)):(e.push(-v.x,-v.y,-v.z),e.push(-v.x,-v.y,-v.z),e.push(-v.x,-v.y,-v.z),e.push(-v.x,-v.y,-v.z),i.push(h),i.push(h+1),i.push(h+2),i.push(h+1),i.push(h+3),i.push(h+2)),h+=4}},t}()},148:function(t,e,r){"use strict";r.d(e,"a",function(){return o});var i=r(1),n=r(0),s=r(3),a=r(10);a.a._GroundMeshParser=function(t,e){return o.Parse(t,e)};var o=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.generateOctree=!1,i}return i.d(e,t),e.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(e.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),e.prototype.optimize=function(t,e){void 0===e&&(e=32),this._subdivisionsX=t,this._subdivisionsY=t,this.subdivide(t);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(e)},e.prototype.getHeightAtCoordinates=function(t,e){var r=this.getWorldMatrix(),i=n.Tmp.Matrix[5];r.invertToRef(i);var s=n.Tmp.Vector3[8];if(n.Vector3.TransformCoordinatesFromFloatsToRef(t,0,e,i,s),t=s.x,e=s.z,t<this._minX||t>this._maxX||e<this._minZ||e>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var a=this._getFacetAt(t,e),o=-(a.x*t+a.z*e+a.w)/a.y;return n.Vector3.TransformCoordinatesFromFloatsToRef(0,o,0,r,s),s.y},e.prototype.getNormalAtCoordinates=function(t,e){var r=new n.Vector3(0,1,0);return this.getNormalAtCoordinatesToRef(t,e,r),r},e.prototype.getNormalAtCoordinatesToRef=function(t,e,r){var i=this.getWorldMatrix(),s=n.Tmp.Matrix[5];i.invertToRef(s);var a=n.Tmp.Vector3[8];if(n.Vector3.TransformCoordinatesFromFloatsToRef(t,0,e,s,a),t=a.x,e=a.z,t<this._minX||t>this._maxX||e<this._minZ||e>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var o=this._getFacetAt(t,e);return n.Vector3.TransformNormalFromFloatsToRef(o.x,o.y,o.z,i,r),this},e.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},e.prototype._getFacetAt=function(t,e){var r=Math.floor((t+this._maxX)*this._subdivisionsX/this._width),i=Math.floor(-(e+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),n=this._heightQuads[i*this._subdivisionsX+r];return e<n.slope.x*t+n.slope.y?n.facet1:n.facet2},e.prototype._initHeightQuads=function(){var t=this._subdivisionsX,e=this._subdivisionsY;this._heightQuads=new Array;for(var r=0;r<e;r++)for(var i=0;i<t;i++){var s={slope:n.Vector2.Zero(),facet1:new n.Vector4(0,0,0,0),facet2:new n.Vector4(0,0,0,0)};this._heightQuads[r*t+i]=s}return this},e.prototype._computeHeightQuads=function(){var t=this.getVerticesData(s.b.PositionKind);if(!t)return this;for(var e=n.Tmp.Vector3[3],r=n.Tmp.Vector3[2],i=n.Tmp.Vector3[1],a=n.Tmp.Vector3[0],o=n.Tmp.Vector3[4],u=n.Tmp.Vector3[5],h=n.Tmp.Vector3[6],c=n.Tmp.Vector3[7],l=n.Tmp.Vector3[8],d=0,f=0,p=0,g=0,m=0,v=0,y=0,b=this._subdivisionsX,_=this._subdivisionsY,x=0;x<_;x++)for(var M=0;M<b;M++){d=3*M,f=x*(b+1)*3,p=(x+1)*(b+1)*3,e.x=t[f+d],e.y=t[f+d+1],e.z=t[f+d+2],r.x=t[f+d+3],r.y=t[f+d+4],r.z=t[f+d+5],i.x=t[p+d],i.y=t[p+d+1],i.z=t[p+d+2],a.x=t[p+d+3],a.y=t[p+d+4],a.z=t[p+d+5],g=(a.z-e.z)/(a.x-e.x),m=e.z-g*e.x,r.subtractToRef(e,o),i.subtractToRef(e,u),a.subtractToRef(e,h),n.Vector3.CrossToRef(h,u,c),n.Vector3.CrossToRef(o,h,l),c.normalize(),l.normalize(),v=-(c.x*e.x+c.y*e.y+c.z*e.z),y=-(l.x*r.x+l.y*r.y+l.z*r.z);var T=this._heightQuads[x*b+M];T.slope.copyFromFloats(g,m),T.facet1.copyFromFloats(c.x,c.y,c.z,v),T.facet2.copyFromFloats(l.x,l.y,l.z,y)}return this},e.prototype.serialize=function(e){t.prototype.serialize.call(this,e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height},e.Parse=function(t,r){var i=new e(t.name,r);return i._subdivisionsX=t.subdivisionsX||1,i._subdivisionsY=t.subdivisionsY||1,i._minX=t.minX,i._maxX=t.maxX,i._minZ=t.minZ,i._maxZ=t.maxZ,i._width=t.width,i._height=t.height,i},e}(a.a)},160:function(t,e,r){"use strict";r.d(e,"a",function(){return i});var i=function(){function t(){}return t.Eval=function(e,r){return"true"===(e=e.match(/\([^\(\)]*\)/g)?e.replace(/\([^\(\)]*\)/g,function(e){return e=e.slice(1,e.length-1),t._HandleParenthesisContent(e,r)}):t._HandleParenthesisContent(e,r))||"false"!==e&&t.Eval(e,r)},t._HandleParenthesisContent=function(e,r){var i;r=r||function(t){return"true"===t};var n=e.split("||");for(var s in n)if(n.hasOwnProperty(s)){var a=t._SimplifyNegation(n[s].trim()),o=a.split("&&");if(o.length>1)for(var u=0;u<o.length;++u){var h=t._SimplifyNegation(o[u].trim());if(!(i="true"!==h&&"false"!==h?"!"===h[0]?!r(h.substring(1)):r(h):"true"===h)){a="false";break}}if(i||"true"===a){i=!0;break}i="true"!==a&&"false"!==a?"!"===a[0]?!r(a.substring(1)):r(a):"true"===a}return i?"true":"false"},t._SimplifyNegation=function(t){return"!true"===(t=(t=t.replace(/^[\s!]+/,function(t){return(t=t.replace(/[\s]/g,function(){return""})).length%2?"!":""})).trim())?t="false":"!false"===t&&(t="true"),t},t}()},197:function(t,e,r){"use strict";r.d(e,"a",function(){return n});var i=r(198),n=function(){function t(){}return t.Ldexp=function(t,e){return e>1023?t*Math.pow(2,1023)*Math.pow(2,e-1023):e<-1074?t*Math.pow(2,-1074)*Math.pow(2,e+1074):t*Math.pow(2,e)},t.Rgbe2float=function(t,e,r,i,n,s){n>0?(n=this.Ldexp(1,n-136),t[s+0]=e*n,t[s+1]=r*n,t[s+2]=i*n):(t[s+0]=0,t[s+1]=0,t[s+2]=0)},t.readStringLine=function(t,e){for(var r="",i="",n=e;n<t.length-e&&"\n"!=(i=String.fromCharCode(t[n]));n++)r+=i;return r},t.RGBE_ReadHeader=function(t){var e,r,i=this.readStringLine(t,0);if("#"!=i[0]||"?"!=i[1])throw"Bad HDR Format.";var n=!1,s=!1,a=0;do{a+=i.length+1,"FORMAT=32-bit_rle_rgbe"==(i=this.readStringLine(t,a))?s=!0:0==i.length&&(n=!0)}while(!n);if(!s)throw"HDR Bad header format, unsupported FORMAT";a+=i.length+1,i=this.readStringLine(t,a);var o=/^\-Y (.*) \+X (.*)$/g.exec(i);if(!o||o.length<3)throw"HDR Bad header format, no size";if(r=parseInt(o[2]),e=parseInt(o[1]),r<8||r>32767)throw"HDR Bad header format, unsupported size";return{height:e,width:r,dataPosition:a+=i.length+1}},t.GetCubeMapTextureData=function(t,e){var r=new Uint8Array(t),n=this.RGBE_ReadHeader(r),s=this.RGBE_ReadPixels_RLE(r,n);return i.a.ConvertPanoramaToCubemap(s,n.width,n.height,e)},t.RGBE_ReadPixels=function(t,e){return this.RGBE_ReadPixels_RLE(t,e)},t.RGBE_ReadPixels_RLE=function(t,e){for(var r,i,n,s,a,o=e.height,u=e.width,h=e.dataPosition,c=0,l=0,d=0,f=new ArrayBuffer(4*u),p=new Uint8Array(f),g=new ArrayBuffer(e.width*e.height*4*3),m=new Float32Array(g);o>0;){if(r=t[h++],i=t[h++],n=t[h++],s=t[h++],2!=r||2!=i||128&n)throw"HDR Bad header format, not RLE";if((n<<8|s)!=u)throw"HDR Bad header format, wrong scan line width";for(c=0,d=0;d<4;d++)for(l=(d+1)*u;c<l;)if(r=t[h++],i=t[h++],r>128){if(0==(a=r-128)||a>l-c)throw"HDR Bad Format, bad scanline data (run)";for(;a-- >0;)p[c++]=i}else{if(0==(a=r)||a>l-c)throw"HDR Bad Format, bad scanline data (non-run)";if(p[c++]=i,--a>0)for(var v=0;v<a;v++)p[c++]=t[h++]}for(d=0;d<u;d++)r=p[d],i=p[d+u],n=p[d+2*u],s=p[d+3*u],this.Rgbe2float(m,r,i,n,s,(e.height-o)*u*3+3*d);o--}return m},t}()},198:function(t,e,r){"use strict";r.d(e,"a",function(){return s});var i=r(0),n=r(4),s=function(){function t(){}return t.ConvertPanoramaToCubemap=function(t,e,r,i){if(!t)throw"ConvertPanoramaToCubemap: input cannot be null";if(t.length!=e*r*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(i,this.FACE_FRONT,t,e,r),back:this.CreateCubemapTexture(i,this.FACE_BACK,t,e,r),left:this.CreateCubemapTexture(i,this.FACE_LEFT,t,e,r),right:this.CreateCubemapTexture(i,this.FACE_RIGHT,t,e,r),up:this.CreateCubemapTexture(i,this.FACE_UP,t,e,r),down:this.CreateCubemapTexture(i,this.FACE_DOWN,t,e,r),size:i,type:n.a.TEXTURETYPE_FLOAT,format:n.a.TEXTUREFORMAT_RGB,gammaSpace:!1}},t.CreateCubemapTexture=function(t,e,r,i,n){for(var s=new ArrayBuffer(t*t*4*3),a=new Float32Array(s),o=e[1].subtract(e[0]).scale(1/t),u=e[3].subtract(e[2]).scale(1/t),h=1/t,c=0,l=0;l<t;l++){for(var d=e[0],f=e[2],p=0;p<t;p++){var g=f.subtract(d).scale(c).add(d);g.normalize();var m=this.CalcProjectionSpherical(g,r,i,n);a[l*t*3+3*p+0]=m.r,a[l*t*3+3*p+1]=m.g,a[l*t*3+3*p+2]=m.b,d=d.add(o),f=f.add(u)}c+=h}return a},t.CalcProjectionSpherical=function(t,e,r,i){for(var n=Math.atan2(t.z,t.x),s=Math.acos(t.y);n<-Math.PI;)n+=2*Math.PI;for(;n>Math.PI;)n-=2*Math.PI;var a=n/Math.PI,o=s/Math.PI;a=.5*a+.5;var u=Math.round(a*r);u<0?u=0:u>=r&&(u=r-1);var h=Math.round(o*i);h<0?h=0:h>=i&&(h=i-1);var c=i-h-1;return{r:e[c*r*3+3*u+0],g:e[c*r*3+3*u+1],b:e[c*r*3+3*u+2]}},t.FACE_FRONT=[new i.Vector3(-1,-1,-1),new i.Vector3(1,-1,-1),new i.Vector3(-1,1,-1),new i.Vector3(1,1,-1)],t.FACE_BACK=[new i.Vector3(1,-1,1),new i.Vector3(-1,-1,1),new i.Vector3(1,1,1),new i.Vector3(-1,1,1)],t.FACE_RIGHT=[new i.Vector3(1,-1,-1),new i.Vector3(1,-1,1),new i.Vector3(1,1,-1),new i.Vector3(1,1,1)],t.FACE_LEFT=[new i.Vector3(-1,-1,1),new i.Vector3(-1,-1,-1),new i.Vector3(-1,1,1),new i.Vector3(-1,1,-1)],t.FACE_DOWN=[new i.Vector3(-1,1,-1),new i.Vector3(1,1,-1),new i.Vector3(-1,1,1),new i.Vector3(1,1,1)],t.FACE_UP=[new i.Vector3(-1,-1,1),new i.Vector3(1,-1,1),new i.Vector3(-1,-1,-1),new i.Vector3(1,-1,-1)],t}()},2:function(t,e,r){"use strict";r.d(e,"b",function(){return c}),r.d(e,"c",function(){return l}),r.d(e,"l",function(){return d}),r.d(e,"e",function(){return f}),r.d(e,"h",function(){return p}),r.d(e,"m",function(){return g}),r.d(e,"n",function(){return m}),r.d(e,"j",function(){return v}),r.d(e,"g",function(){return y}),r.d(e,"f",function(){return b}),r.d(e,"i",function(){return _}),r.d(e,"k",function(){return x}),r.d(e,"d",function(){return M}),r.d(e,"a",function(){return T});var i=r(27),n=r(0),s={},a={},o=function(t,e,r){var n=t();i.a&&i.a.AddTagsTo(n,e.tags);var s=u(n);for(var a in s){var o=s[a],h=e[a],c=o.type;if(null!=h)switch(c){case 0:case 6:case 11:n[a]=h;break;case 1:n[a]=r||h.isRenderTarget?h:h.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:n[a]=r?h:h.clone()}}return n};function u(t){var e=t.getClassName();if(a[e])return a[e];a[e]={};for(var r=a[e],i=t,n=e;n;){var o=s[n];for(var u in o)r[u]=o[u];var h=void 0,c=!1;do{if(!(h=Object.getPrototypeOf(i)).getClassName){c=!0;break}if(h.getClassName()!==n)break;i=h}while(h);if(c)break;n=h.getClassName(),i=h}return r}function h(t,e){return function(r,i){var n=function(t){var e=t.getClassName();return s[e]||(s[e]={}),s[e]}(r);n[i]||(n[i]={type:t,sourceName:e})}}function c(t,e){return void 0===e&&(e=null),function(t,e){return void 0===e&&(e=null),function(r,i){var n=e||"_"+i;Object.defineProperty(r,i,{get:function(){return this[n]},set:function(e){this[n]!==e&&(this[n]=e,r[t].apply(this))},enumerable:!0,configurable:!0})}}(t,e)}function l(t){return h(0,t)}function d(t){return h(1,t)}function f(t){return h(2,t)}function p(t){return h(3,t)}function g(t){return h(4,t)}function m(t){return h(5,t)}function v(t){return h(6,t)}function y(t){return h(7,t)}function b(t){return h(8,t)}function _(t){return h(9,t)}function x(t){return h(10,t)}function M(t){return h(11,t)}var T=function(){function t(){}return t.AppendSerializedAnimations=function(t,e){if(t.animations){e.animations=[];for(var r=0;r<t.animations.length;r++){var i=t.animations[r];e.animations.push(i.serialize())}}},t.Serialize=function(t,e){e||(e={}),i.a&&(e.tags=i.a.GetTags(t));var r=u(t);for(var n in r){var s=r[n],a=s.sourceName||n,o=s.type,h=t[n];if(null!=h)switch(o){case 0:e[a]=h;break;case 1:e[a]=h.serialize();break;case 2:e[a]=h.asArray();break;case 3:e[a]=h.serialize();break;case 4:case 5:e[a]=h.asArray();break;case 6:e[a]=h.id;break;case 7:e[a]=h.serialize();break;case 8:e[a]=h.asArray();break;case 9:e[a]=h.serialize();break;case 10:e[a]=h.asArray();break;case 11:e[a]=h.id}}return e},t.Parse=function(e,r,s,a){void 0===a&&(a=null);var o=e();a||(a=""),i.a&&i.a.AddTagsTo(o,r.tags);var h=u(o);for(var c in h){var l=h[c],d=r[l.sourceName||c],f=l.type;if(null!=d){var p=o;switch(f){case 0:p[c]=d;break;case 1:s&&(p[c]=t._TextureParser(d,s,a));break;case 2:p[c]=n.Color3.FromArray(d);break;case 3:p[c]=t._FresnelParametersParser(d);break;case 4:p[c]=n.Vector2.FromArray(d);break;case 5:p[c]=n.Vector3.FromArray(d);break;case 6:s&&(p[c]=s.getLastMeshByID(d));break;case 7:p[c]=t._ColorCurvesParser(d);break;case 8:p[c]=n.Color4.FromArray(d);break;case 9:p[c]=t._ImageProcessingConfigurationParser(d);break;case 10:p[c]=n.Quaternion.FromArray(d);break;case 11:s&&(p[c]=s.getCameraByID(d))}}}return o},t.Clone=function(t,e){return o(t,e,!1)},t.Instanciate=function(t,e){return o(t,e,!0)},t._ImageProcessingConfigurationParser=function(t){throw"ImageProcessingConfiguration needs to be imported before being deserialized."},t._FresnelParametersParser=function(t){throw"FresnelParameters needs to be imported before being deserialized."},t._ColorCurvesParser=function(t){throw"ColorCurves needs to be imported before being deserialized."},t._TextureParser=function(t,e,r){throw"Texture needs to be imported before being deserialized."},t}()},24:function(t,e,r){"use strict";r.d(e,"a",function(){return s});var i=r(0),n=r(3),s=function(){function t(){}return t.prototype.set=function(t,e){switch(e){case n.b.PositionKind:this.positions=t;break;case n.b.NormalKind:this.normals=t;break;case n.b.TangentKind:this.tangents=t;break;case n.b.UVKind:this.uvs=t;break;case n.b.UV2Kind:this.uvs2=t;break;case n.b.UV3Kind:this.uvs3=t;break;case n.b.UV4Kind:this.uvs4=t;break;case n.b.UV5Kind:this.uvs5=t;break;case n.b.UV6Kind:this.uvs6=t;break;case n.b.ColorKind:this.colors=t;break;case n.b.MatricesIndicesKind:this.matricesIndices=t;break;case n.b.MatricesWeightsKind:this.matricesWeights=t;break;case n.b.MatricesIndicesExtraKind:this.matricesIndicesExtra=t;break;case n.b.MatricesWeightsExtraKind:this.matricesWeightsExtra=t}},t.prototype.applyToMesh=function(t,e){return this._applyTo(t,e),this},t.prototype.applyToGeometry=function(t,e){return this._applyTo(t,e),this},t.prototype.updateMesh=function(t){return this._update(t),this},t.prototype.updateGeometry=function(t){return this._update(t),this},t.prototype._applyTo=function(t,e){return void 0===e&&(e=!1),this.positions&&t.setVerticesData(n.b.PositionKind,this.positions,e),this.normals&&t.setVerticesData(n.b.NormalKind,this.normals,e),this.tangents&&t.setVerticesData(n.b.TangentKind,this.tangents,e),this.uvs&&t.setVerticesData(n.b.UVKind,this.uvs,e),this.uvs2&&t.setVerticesData(n.b.UV2Kind,this.uvs2,e),this.uvs3&&t.setVerticesData(n.b.UV3Kind,this.uvs3,e),this.uvs4&&t.setVerticesData(n.b.UV4Kind,this.uvs4,e),this.uvs5&&t.setVerticesData(n.b.UV5Kind,this.uvs5,e),this.uvs6&&t.setVerticesData(n.b.UV6Kind,this.uvs6,e),this.colors&&t.setVerticesData(n.b.ColorKind,this.colors,e),this.matricesIndices&&t.setVerticesData(n.b.MatricesIndicesKind,this.matricesIndices,e),this.matricesWeights&&t.setVerticesData(n.b.MatricesWeightsKind,this.matricesWeights,e),this.matricesIndicesExtra&&t.setVerticesData(n.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,e),this.matricesWeightsExtra&&t.setVerticesData(n.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,e),this.indices?t.setIndices(this.indices,null,e):t.setIndices([],null),this},t.prototype._update=function(t,e,r){return this.positions&&t.updateVerticesData(n.b.PositionKind,this.positions,e,r),this.normals&&t.updateVerticesData(n.b.NormalKind,this.normals,e,r),this.tangents&&t.updateVerticesData(n.b.TangentKind,this.tangents,e,r),this.uvs&&t.updateVerticesData(n.b.UVKind,this.uvs,e,r),this.uvs2&&t.updateVerticesData(n.b.UV2Kind,this.uvs2,e,r),this.uvs3&&t.updateVerticesData(n.b.UV3Kind,this.uvs3,e,r),this.uvs4&&t.updateVerticesData(n.b.UV4Kind,this.uvs4,e,r),this.uvs5&&t.updateVerticesData(n.b.UV5Kind,this.uvs5,e,r),this.uvs6&&t.updateVerticesData(n.b.UV6Kind,this.uvs6,e,r),this.colors&&t.updateVerticesData(n.b.ColorKind,this.colors,e,r),this.matricesIndices&&t.updateVerticesData(n.b.MatricesIndicesKind,this.matricesIndices,e,r),this.matricesWeights&&t.updateVerticesData(n.b.MatricesWeightsKind,this.matricesWeights,e,r),this.matricesIndicesExtra&&t.updateVerticesData(n.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,e,r),this.matricesWeightsExtra&&t.updateVerticesData(n.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,e,r),this.indices&&t.setIndices(this.indices,null),this},t.prototype.transform=function(t){var e,r=t.m[0]*t.m[5]*t.m[10]<0,n=i.Vector3.Zero();if(this.positions){var s=i.Vector3.Zero();for(e=0;e<this.positions.length;e+=3)i.Vector3.FromArrayToRef(this.positions,e,s),i.Vector3.TransformCoordinatesToRef(s,t,n),this.positions[e]=n.x,this.positions[e+1]=n.y,this.positions[e+2]=n.z}if(this.normals){var a=i.Vector3.Zero();for(e=0;e<this.normals.length;e+=3)i.Vector3.FromArrayToRef(this.normals,e,a),i.Vector3.TransformNormalToRef(a,t,n),this.normals[e]=n.x,this.normals[e+1]=n.y,this.normals[e+2]=n.z}if(this.tangents){var o=i.Vector4.Zero(),u=i.Vector4.Zero();for(e=0;e<this.tangents.length;e+=4)i.Vector4.FromArrayToRef(this.tangents,e,o),i.Vector4.TransformNormalToRef(o,t,u),this.tangents[e]=u.x,this.tangents[e+1]=u.y,this.tangents[e+2]=u.z,this.tangents[e+3]=u.w}if(r&&this.indices)for(e=0;e<this.indices.length;e+=3){var h=this.indices[e+1];this.indices[e+1]=this.indices[e+2],this.indices[e+2]=h}return this},t.prototype.merge=function(t,e){if(void 0===e&&(e=!1),this._validate(),t._validate(),!this.normals!=!t.normals||!this.tangents!=!t.tangents||!this.uvs!=!t.uvs||!this.uvs2!=!t.uvs2||!this.uvs3!=!t.uvs3||!this.uvs4!=!t.uvs4||!this.uvs5!=!t.uvs5||!this.uvs6!=!t.uvs6||!this.colors!=!t.colors||!this.matricesIndices!=!t.matricesIndices||!this.matricesWeights!=!t.matricesWeights||!this.matricesIndicesExtra!=!t.matricesIndicesExtra||!this.matricesWeightsExtra!=!t.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(t.indices){this.indices||(this.indices=[]);var r=this.positions?this.positions.length/3:0;if(void 0!==this.indices.BYTES_PER_ELEMENT){var i=this.indices.length+t.indices.length,n=e||this.indices instanceof Uint32Array?new Uint32Array(i):new Uint16Array(i);n.set(this.indices);for(var s=this.indices.length,a=0;a<t.indices.length;a++)n[s+a]=t.indices[a]+r;this.indices=n}else for(a=0;a<t.indices.length;a++)this.indices.push(t.indices[a]+r)}return this.positions=this._mergeElement(this.positions,t.positions),this.normals=this._mergeElement(this.normals,t.normals),this.tangents=this._mergeElement(this.tangents,t.tangents),this.uvs=this._mergeElement(this.uvs,t.uvs),this.uvs2=this._mergeElement(this.uvs2,t.uvs2),this.uvs3=this._mergeElement(this.uvs3,t.uvs3),this.uvs4=this._mergeElement(this.uvs4,t.uvs4),this.uvs5=this._mergeElement(this.uvs5,t.uvs5),this.uvs6=this._mergeElement(this.uvs6,t.uvs6),this.colors=this._mergeElement(this.colors,t.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,t.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,t.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,t.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,t.matricesWeightsExtra),this},t.prototype._mergeElement=function(t,e){if(!t)return e;if(!e)return t;var r=e.length+t.length,i=t instanceof Float32Array,n=e instanceof Float32Array;if(i){var s=new Float32Array(r);return s.set(t),s.set(e,t.length),s}if(n){var a=t.slice(0),o=0;for(r=e.length;o<r;o++)a.push(e[o]);return a}return t.concat(e)},t.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var t=function(t,e){var r=n.b.DeduceStride(t);if(e.length%r!=0)throw new Error("The "+t+"s array count must be a multiple of "+r);return e.length/r},e=t(n.b.PositionKind,this.positions),r=function(r,i){var n=t(r,i);if(n!==e)throw new Error("The "+r+"s element count ("+n+") does not match the positions count ("+e+")")};this.normals&&r(n.b.NormalKind,this.normals),this.tangents&&r(n.b.TangentKind,this.tangents),this.uvs&&r(n.b.UVKind,this.uvs),this.uvs2&&r(n.b.UV2Kind,this.uvs2),this.uvs3&&r(n.b.UV3Kind,this.uvs3),this.uvs4&&r(n.b.UV4Kind,this.uvs4),this.uvs5&&r(n.b.UV5Kind,this.uvs5),this.uvs6&&r(n.b.UV6Kind,this.uvs6),this.colors&&r(n.b.ColorKind,this.colors),this.matricesIndices&&r(n.b.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&r(n.b.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&r(n.b.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&r(n.b.MatricesWeightsExtraKind,this.matricesWeightsExtra)},t.prototype.serialize=function(){var t=this.serialize();return this.positions&&(t.positions=this.positions),this.normals&&(t.normals=this.normals),this.tangents&&(t.tangents=this.tangents),this.uvs&&(t.uvs=this.uvs),this.uvs2&&(t.uvs2=this.uvs2),this.uvs3&&(t.uvs3=this.uvs3),this.uvs4&&(t.uvs4=this.uvs4),this.uvs5&&(t.uvs5=this.uvs5),this.uvs6&&(t.uvs6=this.uvs6),this.colors&&(t.colors=this.colors),this.matricesIndices&&(t.matricesIndices=this.matricesIndices,t.matricesIndices._isExpanded=!0),this.matricesWeights&&(t.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(t.matricesIndicesExtra=this.matricesIndicesExtra,t.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(t.matricesWeightsExtra=this.matricesWeightsExtra),t.indices=this.indices,t},t.ExtractFromMesh=function(e,r,i){return t._ExtractFrom(e,r,i)},t.ExtractFromGeometry=function(e,r,i){return t._ExtractFrom(e,r,i)},t._ExtractFrom=function(e,r,i){var s=new t;return e.isVerticesDataPresent(n.b.PositionKind)&&(s.positions=e.getVerticesData(n.b.PositionKind,r,i)),e.isVerticesDataPresent(n.b.NormalKind)&&(s.normals=e.getVerticesData(n.b.NormalKind,r,i)),e.isVerticesDataPresent(n.b.TangentKind)&&(s.tangents=e.getVerticesData(n.b.TangentKind,r,i)),e.isVerticesDataPresent(n.b.UVKind)&&(s.uvs=e.getVerticesData(n.b.UVKind,r,i)),e.isVerticesDataPresent(n.b.UV2Kind)&&(s.uvs2=e.getVerticesData(n.b.UV2Kind,r,i)),e.isVerticesDataPresent(n.b.UV3Kind)&&(s.uvs3=e.getVerticesData(n.b.UV3Kind,r,i)),e.isVerticesDataPresent(n.b.UV4Kind)&&(s.uvs4=e.getVerticesData(n.b.UV4Kind,r,i)),e.isVerticesDataPresent(n.b.UV5Kind)&&(s.uvs5=e.getVerticesData(n.b.UV5Kind,r,i)),e.isVerticesDataPresent(n.b.UV6Kind)&&(s.uvs6=e.getVerticesData(n.b.UV6Kind,r,i)),e.isVerticesDataPresent(n.b.ColorKind)&&(s.colors=e.getVerticesData(n.b.ColorKind,r,i)),e.isVerticesDataPresent(n.b.MatricesIndicesKind)&&(s.matricesIndices=e.getVerticesData(n.b.MatricesIndicesKind,r,i)),e.isVerticesDataPresent(n.b.MatricesWeightsKind)&&(s.matricesWeights=e.getVerticesData(n.b.MatricesWeightsKind,r,i)),e.isVerticesDataPresent(n.b.MatricesIndicesExtraKind)&&(s.matricesIndicesExtra=e.getVerticesData(n.b.MatricesIndicesExtraKind,r,i)),e.isVerticesDataPresent(n.b.MatricesWeightsExtraKind)&&(s.matricesWeightsExtra=e.getVerticesData(n.b.MatricesWeightsExtraKind,r,i)),s.indices=e.getIndices(r,i),s},t.CreateRibbon=function(e){var r=e.pathArray,i=e.closeArray||!1,s=e.closePath||!1,a=e.invertUV||!1,o=Math.floor(r[0].length/2),u=e.offset||o;u=u>o?o:Math.floor(u);var h,c,l,d,f=0===e.sideOrientation?0:e.sideOrientation||t.DEFAULTSIDE,p=e.uvs,g=e.colors,m=[],v=[],y=[],b=[],_=[],x=[],M=[],T=[],A=[],D=[];if(r.length<2){var I=[],V=[];for(l=0;l<r[0].length-u;l++)I.push(r[0][l]),V.push(r[0][l+u]);r=[I,V]}var w,E,S,C,P,O=0,F=s?1:0;for(h=r[0].length,c=0;c<r.length;c++){for(M[c]=0,_[c]=[0],h=h<(E=(w=r[c]).length)?h:E,d=0;d<E;)m.push(w[d].x,w[d].y,w[d].z),d>0&&(S=w[d].subtract(w[d-1]).length()+M[c],_[c].push(S),M[c]=S),d++;s&&(d--,m.push(w[0].x,w[0].y,w[0].z),S=w[d].subtract(w[0]).length()+M[c],_[c].push(S),M[c]=S),A[c]=E+F,D[c]=O,O+=E+F}var R,B,L=null,U=null;for(l=0;l<h+F;l++){for(T[l]=0,x[l]=[0],c=0;c<r.length-1;c++)C=r[c],P=r[c+1],l===h?(L=C[0],U=P[0]):(L=C[l],U=P[l]),S=U.subtract(L).length()+T[l],x[l].push(S),T[l]=S;i&&U&&L&&(C=r[c],P=r[0],l===h&&(U=P[0]),S=U.subtract(L).length()+T[l],T[l]=S)}if(p)for(c=0;c<p.length;c++)b.push(p[c].x,p[c].y);else for(c=0;c<r.length;c++)for(l=0;l<h+F;l++)R=0!=M[c]?_[c][l]/M[c]:0,B=0!=T[l]?x[l][c]/T[l]:0,a?b.push(B,R):b.push(R,B);for(var z=0,N=A[c=0]-1,k=A[c+1]-1,K=N<k?N:k,W=D[1]-D[0],G=i?A.length:A.length-1;z<=K&&c<G;)v.push(z,z+W,z+1),v.push(z+W+1,z+1,z+W),(z+=1)===K&&(++c===A.length-1?(W=D[0]-D[c],N=A[c]-1,k=A[0]-1):(W=D[c+1]-D[c],N=A[c]-1,k=A[c+1]-1),z=D[c],K=N<k?N+z:k+z);if(t.ComputeNormals(m,v,y),s){var j=0,H=0;for(c=0;c<r.length;c++)j=3*D[c],H=c+1<r.length?3*(D[c+1]-1):y.length-3,y[j]=.5*(y[j]+y[H]),y[j+1]=.5*(y[j+1]+y[H+1]),y[j+2]=.5*(y[j+2]+y[H+2]),y[H]=y[j],y[H+1]=y[j+1],y[H+2]=y[j+2]}t._ComputeSides(f,m,v,y,b,e.frontUVs,e.backUVs);var X=null;if(g){X=new Float32Array(4*g.length);for(var Q=0;Q<g.length;Q++)X[4*Q]=g[Q].r,X[4*Q+1]=g[Q].g,X[4*Q+2]=g[Q].b,X[4*Q+3]=g[Q].a}var Y=new t,Z=new Float32Array(m),q=new Float32Array(y),J=new Float32Array(b);return Y.indices=v,Y.positions=Z,Y.normals=q,Y.uvs=J,X&&Y.set(X,n.b.ColorKind),s&&(Y._idx=D),Y},t.CreateBox=function(e){for(var r=[new i.Vector3(0,0,1),new i.Vector3(0,0,-1),new i.Vector3(1,0,0),new i.Vector3(-1,0,0),new i.Vector3(0,1,0),new i.Vector3(0,-1,0)],n=[],s=[],a=[],o=[],u=e.width||e.size||1,h=e.height||e.size||1,c=e.depth||e.size||1,l=0===e.sideOrientation?0:e.sideOrientation||t.DEFAULTSIDE,d=e.faceUV||new Array(6),f=e.faceColors,p=[],g=0;g<6;g++)void 0===d[g]&&(d[g]=new i.Vector4(0,0,1,1)),f&&void 0===f[g]&&(f[g]=new i.Color4(1,1,1,1));for(var m=new i.Vector3(u/2,h/2,c/2),v=0;v<r.length;v++){var y=r[v],b=new i.Vector3(y.y,y.z,y.x),_=i.Vector3.Cross(y,b),x=s.length/3;n.push(x),n.push(x+1),n.push(x+2),n.push(x),n.push(x+2),n.push(x+3);var M=y.subtract(b).subtract(_).multiply(m);s.push(M.x,M.y,M.z),a.push(y.x,y.y,y.z),o.push(d[v].z,d[v].w),f&&p.push(f[v].r,f[v].g,f[v].b,f[v].a),M=y.subtract(b).add(_).multiply(m),s.push(M.x,M.y,M.z),a.push(y.x,y.y,y.z),o.push(d[v].x,d[v].w),f&&p.push(f[v].r,f[v].g,f[v].b,f[v].a),M=y.add(b).add(_).multiply(m),s.push(M.x,M.y,M.z),a.push(y.x,y.y,y.z),o.push(d[v].x,d[v].y),f&&p.push(f[v].r,f[v].g,f[v].b,f[v].a),M=y.add(b).subtract(_).multiply(m),s.push(M.x,M.y,M.z),a.push(y.x,y.y,y.z),o.push(d[v].z,d[v].y),f&&p.push(f[v].r,f[v].g,f[v].b,f[v].a)}t._ComputeSides(l,s,n,a,o,e.frontUVs,e.backUVs);var T=new t;if(T.indices=n,T.positions=s,T.normals=a,T.uvs=o,f){var A=l===t.DOUBLESIDE?p.concat(p):p;T.colors=A}return T},t.CreateSphere=function(e){for(var r=e.segments||32,n=e.diameterX||e.diameter||1,s=e.diameterY||e.diameter||1,a=e.diameterZ||e.diameter||1,o=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,u=e.slice&&e.slice<=0?1:e.slice||1,h=0===e.sideOrientation?0:e.sideOrientation||t.DEFAULTSIDE,c=new i.Vector3(n/2,s/2,a/2),l=2+r,d=2*l,f=[],p=[],g=[],m=[],v=0;v<=l;v++){for(var y=v/l,b=y*Math.PI*u,_=0;_<=d;_++){var x=_/d,M=x*Math.PI*2*o,T=i.Matrix.RotationZ(-b),A=i.Matrix.RotationY(M),D=i.Vector3.TransformCoordinates(i.Vector3.Up(),T),I=i.Vector3.TransformCoordinates(D,A),V=I.multiply(c),w=I.divide(c).normalize();p.push(V.x,V.y,V.z),g.push(w.x,w.y,w.z),m.push(x,y)}if(v>0)for(var E=p.length/3,S=E-2*(d+1);S+d+2<E;S++)f.push(S),f.push(S+1),f.push(S+d+1),f.push(S+d+1),f.push(S+1),f.push(S+d+2)}t._ComputeSides(h,p,f,g,m,e.frontUVs,e.backUVs);var C=new t;return C.indices=f,C.positions=p,C.normals=g,C.uvs=m,C},t.CreateCylinder=function(e){var r,n=e.height||2,s=0===e.diameterTop?0:e.diameterTop||e.diameter||1,a=0===e.diameterBottom?0:e.diameterBottom||e.diameter||1,o=e.tessellation||24,u=e.subdivisions||1,h=!!e.hasRings,c=!!e.enclose,l=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,d=0===e.sideOrientation?0:e.sideOrientation||t.DEFAULTSIDE,f=e.faceUV||new Array(3),p=e.faceColors,g=2+(1+(1!==l&&c?2:0))*(h?u:1);for(r=0;r<g;r++)p&&void 0===p[r]&&(p[r]=new i.Color4(1,1,1,1));for(r=0;r<g;r++)f&&void 0===f[r]&&(f[r]=new i.Vector4(0,0,1,1));var m,v,y,b,_,x,M=new Array,T=new Array,A=new Array,D=new Array,I=new Array,V=2*Math.PI*l/o,w=(a-s)/2/n,E=i.Vector3.Zero(),S=i.Vector3.Zero(),C=i.Vector3.Zero(),P=i.Vector3.Zero(),O=i.Vector3.Zero(),F=i.Axis.Y,R=1,B=1,L=0,U=0;for(b=0;b<=u;b++)for(y=((v=b/u)*(s-a)+a)/2,R=h&&0!==b&&b!==u?2:1,x=0;x<R;x++){for(h&&(B+=x),c&&(B+=2*x),_=0;_<=o;_++)m=_*V,E.x=Math.cos(-m)*y,E.y=-n/2+v*n,E.z=Math.sin(-m)*y,0===s&&b===u?(S.x=A[A.length-3*(o+1)],S.y=A[A.length-3*(o+1)+1],S.z=A[A.length-3*(o+1)+2]):(S.x=E.x,S.z=E.z,S.y=Math.sqrt(S.x*S.x+S.z*S.z)*w,S.normalize()),0===_&&(C.copyFrom(E),P.copyFrom(S)),T.push(E.x,E.y,E.z),A.push(S.x,S.y,S.z),U=h?L!==B?f[B].y:f[B].w:f[B].y+(f[B].w-f[B].y)*v,D.push(f[B].x+(f[B].z-f[B].x)*_/o,U),p&&I.push(p[B].r,p[B].g,p[B].b,p[B].a);1!==l&&c&&(T.push(E.x,E.y,E.z),T.push(0,E.y,0),T.push(0,E.y,0),T.push(C.x,C.y,C.z),i.Vector3.CrossToRef(F,S,O),O.normalize(),A.push(O.x,O.y,O.z,O.x,O.y,O.z),i.Vector3.CrossToRef(P,F,O),O.normalize(),A.push(O.x,O.y,O.z,O.x,O.y,O.z),U=h?L!==B?f[B+1].y:f[B+1].w:f[B+1].y+(f[B+1].w-f[B+1].y)*v,D.push(f[B+1].x,U),D.push(f[B+1].z,U),U=h?L!==B?f[B+2].y:f[B+2].w:f[B+2].y+(f[B+2].w-f[B+2].y)*v,D.push(f[B+2].x,U),D.push(f[B+2].z,U),p&&(I.push(p[B+1].r,p[B+1].g,p[B+1].b,p[B+1].a),I.push(p[B+1].r,p[B+1].g,p[B+1].b,p[B+1].a),I.push(p[B+2].r,p[B+2].g,p[B+2].b,p[B+2].a),I.push(p[B+2].r,p[B+2].g,p[B+2].b,p[B+2].a))),L!==B&&(L=B)}var z=1!==l&&c?o+4:o;for(b=0,B=0;B<u;B++){var N=0,k=0,K=0,W=0;for(_=0;_<o;_++)N=b*(z+1)+_,k=(b+1)*(z+1)+_,K=b*(z+1)+(_+1),W=(b+1)*(z+1)+(_+1),M.push(N,k,K),M.push(W,K,k);1!==l&&c&&(M.push(N+2,k+2,K+2),M.push(W+2,K+2,k+2),M.push(N+4,k+4,K+4),M.push(W+4,K+4,k+4)),b=h?b+2:b+1}var G=function(t){var e=t?s/2:a/2;if(0!==e){var r,u,h,c=t?f[g-1]:f[0],d=null;p&&(d=t?p[g-1]:p[0]);var m=T.length/3,v=t?n/2:-n/2,y=new i.Vector3(0,v,0);T.push(y.x,y.y,y.z),A.push(0,t?1:-1,0),D.push(c.x+.5*(c.z-c.x),c.y+.5*(c.w-c.y)),d&&I.push(d.r,d.g,d.b,d.a);var b=new i.Vector2(.5,.5);for(h=0;h<=o;h++){r=2*Math.PI*h*l/o;var _=Math.cos(-r),x=Math.sin(-r);u=new i.Vector3(_*e,v,x*e);var V=new i.Vector2(_*b.x+.5,x*b.y+.5);T.push(u.x,u.y,u.z),A.push(0,t?1:-1,0),D.push(c.x+(c.z-c.x)*V.x,c.y+(c.w-c.y)*V.y),d&&I.push(d.r,d.g,d.b,d.a)}for(h=0;h<o;h++)t?(M.push(m),M.push(m+(h+2)),M.push(m+(h+1))):(M.push(m),M.push(m+(h+1)),M.push(m+(h+2)))}};G(!1),G(!0),t._ComputeSides(d,T,M,A,D,e.frontUVs,e.backUVs);var j=new t;return j.indices=M,j.positions=T,j.normals=A,j.uvs=D,p&&(j.colors=I),j},t.CreateTorus=function(e){for(var r=[],n=[],s=[],a=[],o=e.diameter||1,u=e.thickness||.5,h=e.tessellation||16,c=0===e.sideOrientation?0:e.sideOrientation||t.DEFAULTSIDE,l=h+1,d=0;d<=h;d++)for(var f=d/h,p=d*Math.PI*2/h-Math.PI/2,g=i.Matrix.Translation(o/2,0,0).multiply(i.Matrix.RotationY(p)),m=0;m<=h;m++){var v=1-m/h,y=m*Math.PI*2/h+Math.PI,b=Math.cos(y),_=Math.sin(y),x=new i.Vector3(b,_,0),M=x.scale(u/2),T=new i.Vector2(f,v);M=i.Vector3.TransformCoordinates(M,g),x=i.Vector3.TransformNormal(x,g),n.push(M.x,M.y,M.z),s.push(x.x,x.y,x.z),a.push(T.x,T.y);var A=(d+1)%l,D=(m+1)%l;r.push(d*l+m),r.push(d*l+D),r.push(A*l+m),r.push(d*l+D),r.push(A*l+D),r.push(A*l+m)}t._ComputeSides(c,n,r,s,a,e.frontUVs,e.backUVs);var I=new t;return I.indices=r,I.positions=n,I.normals=s,I.uvs=a,I},t.CreateLineSystem=function(e){for(var r=[],i=[],n=e.lines,s=e.colors,a=[],o=0,u=0;u<n.length;u++)for(var h=n[u],c=0;c<h.length;c++){if(i.push(h[c].x,h[c].y,h[c].z),s){var l=s[u];a.push(l[c].r,l[c].g,l[c].b,l[c].a)}c>0&&(r.push(o-1),r.push(o)),o++}var d=new t;return d.indices=r,d.positions=i,s&&(d.colors=a),d},t.CreateDashedLines=function(e){var r,n,s=e.dashSize||3,a=e.gapSize||1,o=e.dashNb||200,u=e.points,h=new Array,c=new Array,l=i.Vector3.Zero(),d=0,f=0,p=0,g=0,m=0;for(m=0;m<u.length-1;m++)u[m+1].subtractToRef(u[m],l),d+=l.length();for(n=s*(r=d/o)/(s+a),m=0;m<u.length-1;m++){u[m+1].subtractToRef(u[m],l),f=Math.floor(l.length()/r),l.normalize();for(var v=0;v<f;v++)p=r*v,h.push(u[m].x+p*l.x,u[m].y+p*l.y,u[m].z+p*l.z),h.push(u[m].x+(p+n)*l.x,u[m].y+(p+n)*l.y,u[m].z+(p+n)*l.z),c.push(g,g+1),g+=2}var y=new t;return y.positions=h,y.indices=c,y},t.CreateGround=function(e){var r,n,s=[],a=[],o=[],u=[],h=e.width||1,c=e.height||1,l=e.subdivisionsX||e.subdivisions||1,d=e.subdivisionsY||e.subdivisions||1;for(r=0;r<=d;r++)for(n=0;n<=l;n++){var f=new i.Vector3(n*h/l-h/2,0,(d-r)*c/d-c/2),p=new i.Vector3(0,1,0);a.push(f.x,f.y,f.z),o.push(p.x,p.y,p.z),u.push(n/l,1-r/d)}for(r=0;r<d;r++)for(n=0;n<l;n++)s.push(n+1+(r+1)*(l+1)),s.push(n+1+r*(l+1)),s.push(n+r*(l+1)),s.push(n+(r+1)*(l+1)),s.push(n+1+(r+1)*(l+1)),s.push(n+r*(l+1));var g=new t;return g.indices=s,g.positions=a,g.normals=o,g.uvs=u,g},t.CreateTiledGround=function(e){var r,n,s,a,o=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,u=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,h=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,c=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,l=e.subdivisions||{w:1,h:1},d=e.precision||{w:1,h:1},f=new Array,p=new Array,g=new Array,m=new Array;l.h=l.h<1?1:l.h,l.w=l.w<1?1:l.w,d.w=d.w<1?1:d.w,d.h=d.h<1?1:d.h;var v=(h-o)/l.w,y=(c-u)/l.h;function b(t,e,s,a){var o=p.length/3,u=d.w+1;for(r=0;r<d.h;r++)for(n=0;n<d.w;n++){var h=[o+n+r*u,o+(n+1)+r*u,o+(n+1)+(r+1)*u,o+n+(r+1)*u];f.push(h[1]),f.push(h[2]),f.push(h[3]),f.push(h[0]),f.push(h[1]),f.push(h[3])}var c=i.Vector3.Zero(),l=new i.Vector3(0,1,0);for(r=0;r<=d.h;r++)for(c.z=r*(a-e)/d.h+e,n=0;n<=d.w;n++)c.x=n*(s-t)/d.w+t,c.y=0,p.push(c.x,c.y,c.z),g.push(l.x,l.y,l.z),m.push(n/d.w,r/d.h)}for(s=0;s<l.h;s++)for(a=0;a<l.w;a++)b(o+a*v,u+s*y,o+(a+1)*v,u+(s+1)*y);var _=new t;return _.indices=f,_.positions=p,_.normals=g,_.uvs=m,_},t.CreateGroundFromHeightMap=function(e){var r,n,s=[],a=[],o=[],u=[],h=e.colorFilter||new i.Color3(.3,.59,.11),c=e.alphaFilter||0;for(r=0;r<=e.subdivisions;r++)for(n=0;n<=e.subdivisions;n++){var l=new i.Vector3(n*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-r)*e.height/e.subdivisions-e.height/2),d=4*(((l.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(l.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth),f=e.buffer[d]/255,p=e.buffer[d+1]/255,g=e.buffer[d+2]/255,m=e.buffer[d+3]/255,v=f*h.r+p*h.g+g*h.b;l.y=m>=c?e.minHeight+(e.maxHeight-e.minHeight)*v:e.minHeight-i.Epsilon,a.push(l.x,l.y,l.z),o.push(0,0,0),u.push(n/e.subdivisions,1-r/e.subdivisions)}for(r=0;r<e.subdivisions;r++)for(n=0;n<e.subdivisions;n++){var y=n+1+(r+1)*(e.subdivisions+1),b=n+1+r*(e.subdivisions+1),_=n+r*(e.subdivisions+1),x=n+(r+1)*(e.subdivisions+1),M=a[3*y+1]>=e.minHeight,T=a[3*b+1]>=e.minHeight,A=a[3*_+1]>=e.minHeight;M&&T&&A&&(s.push(y),s.push(b),s.push(_)),a[3*x+1]>=e.minHeight&&M&&A&&(s.push(x),s.push(y),s.push(_))}t.ComputeNormals(a,s,o);var D=new t;return D.indices=s,D.positions=a,D.normals=o,D.uvs=u,D},t.CreatePlane=function(e){var r=[],i=[],n=[],s=[],a=e.width||e.size||1,o=e.height||e.size||1,u=0===e.sideOrientation?0:e.sideOrientation||t.DEFAULTSIDE,h=a/2,c=o/2;i.push(-h,-c,0),n.push(0,0,-1),s.push(0,0),i.push(h,-c,0),n.push(0,0,-1),s.push(1,0),i.push(h,c,0),n.push(0,0,-1),s.push(1,1),i.push(-h,c,0),n.push(0,0,-1),s.push(0,1),r.push(0),r.push(1),r.push(2),r.push(0),r.push(2),r.push(3),t._ComputeSides(u,i,r,n,s,e.frontUVs,e.backUVs);var l=new t;return l.indices=r,l.positions=i,l.normals=n,l.uvs=s,l},t.CreateDisc=function(e){var r=new Array,i=new Array,n=new Array,s=new Array,a=e.radius||.5,o=e.tessellation||64,u=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,h=0===e.sideOrientation?0:e.sideOrientation||t.DEFAULTSIDE;r.push(0,0,0),s.push(.5,.5);for(var c=2*Math.PI*u,l=c/o,d=0;d<c;d+=l){var f=Math.cos(d),p=Math.sin(d),g=(f+1)/2,m=(1-p)/2;r.push(a*f,a*p,0),s.push(g,m)}1===u&&(r.push(r[3],r[4],r[5]),s.push(s[2],s[3]));for(var v=r.length/3,y=1;y<v-1;y++)i.push(y+1,0,y);t.ComputeNormals(r,i,n),t._ComputeSides(h,r,i,n,s,e.frontUVs,e.backUVs);var b=new t;return b.indices=i,b.positions=r,b.normals=n,b.uvs=s,b},t.CreatePolygon=function(e,r,s,a,o,u){for(var h=s||new Array(3),c=a,l=[],d=0;d<3;d++)void 0===h[d]&&(h[d]=new i.Vector4(0,0,1,1)),c&&void 0===c[d]&&(c[d]=new i.Color4(1,1,1,1));for(var f=e.getVerticesData(n.b.PositionKind),p=e.getVerticesData(n.b.NormalKind),g=e.getVerticesData(n.b.UVKind),m=e.getIndices(),v=0,y=0,b=0;b<p.length;b+=3)Math.abs(p[b+1])<.001&&(y=1),Math.abs(p[b+1]-1)<.001&&(y=0),Math.abs(p[b+1]+1)<.001&&(y=2),g[2*(v=b/3)]=(1-g[2*v])*h[y].x+g[2*v]*h[y].z,g[2*v+1]=(1-g[2*v+1])*h[y].y+g[2*v+1]*h[y].w,c&&l.push(c[y].r,c[y].g,c[y].b,c[y].a);t._ComputeSides(r,f,m,p,g,o,u);var _=new t;if(_.indices=m,_.positions=f,_.normals=p,_.uvs=g,c){var x=r===t.DOUBLESIDE?l.concat(l):l;_.colors=x}return _},t.CreateIcoSphere=function(e){var r,n=e.sideOrientation||t.DEFAULTSIDE,s=e.radius||1,a=void 0===e.flat||e.flat,o=e.subdivisions||4,u=e.radiusX||s,h=e.radiusY||s,c=e.radiusZ||s,l=(1+Math.sqrt(5))/2,d=[-1,l,-0,1,l,0,-1,-l,0,1,-l,0,0,-1,-l,0,1,-l,0,-1,l,0,1,l,l,0,1,l,0,-1,-l,0,1,-l,0,-1],f=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],p=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],g=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],m=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],v=new Array,y=new Array,b=new Array,_=new Array,x=0,M=new Array(3),T=new Array(3);for(r=0;r<3;r++)M[r]=i.Vector3.Zero(),T[r]=i.Vector2.Zero();for(var A=0;A<20;A++){for(r=0;r<3;r++){var D=f[3*A+r];M[r].copyFromFloats(d[3*p[D]],d[3*p[D]+1],d[3*p[D]+2]),M[r].normalize().scaleInPlace(s),T[r].copyFromFloats(g[2*D]*(138/1024)+60/1024+m[A]*(-40/1024),g[2*D+1]*(239/1024)+26/1024+m[A]*(20/1024))}for(var I=function(t,e,r,n){var s,l=i.Vector3.Lerp(M[0],M[2],e/o),d=i.Vector3.Lerp(M[1],M[2],e/o),f=o===e?M[2]:i.Vector3.Lerp(l,d,t/(o-e));if(f.normalize(),a){var p=i.Vector3.Lerp(M[0],M[2],n/o),g=i.Vector3.Lerp(M[1],M[2],n/o);s=i.Vector3.Lerp(p,g,r/(o-n))}else s=new i.Vector3(f.x,f.y,f.z);s.x/=u,s.y/=h,s.z/=c,s.normalize();var m=i.Vector2.Lerp(T[0],T[2],e/o),A=i.Vector2.Lerp(T[1],T[2],e/o),D=o===e?T[2]:i.Vector2.Lerp(m,A,t/(o-e));y.push(f.x*u,f.y*h,f.z*c),b.push(s.x,s.y,s.z),_.push(D.x,D.y),v.push(x),x++},V=0;V<o;V++)for(var w=0;w+V<o;w++)I(w,V,w+1/3,V+1/3),I(w+1,V,w+1/3,V+1/3),I(w,V+1,w+1/3,V+1/3),w+V+1<o&&(I(w+1,V,w+2/3,V+2/3),I(w+1,V+1,w+2/3,V+2/3),I(w,V+1,w+2/3,V+2/3))}t._ComputeSides(n,y,v,b,_,e.frontUVs,e.backUVs);var E=new t;return E.indices=v,E.positions=y,E.normals=b,E.uvs=_,E},t.CreatePolyhedron=function(e){var r=[];r[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},r[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},r[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},r[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},r[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},r[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},r[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},r[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},r[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},r[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},r[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},r[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},r[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},r[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},r[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var n,s,a,o,u,h,c=e.type&&(e.type<0||e.type>=r.length)?0:e.type||0,l=e.size,d=e.sizeX||l||1,f=e.sizeY||l||1,p=e.sizeZ||l||1,g=e.custom||r[c],m=g.face.length,v=e.faceUV||new Array(m),y=e.faceColors,b=void 0===e.flat||e.flat,_=0===e.sideOrientation?0:e.sideOrientation||t.DEFAULTSIDE,x=new Array,M=new Array,T=new Array,A=new Array,D=new Array,I=0,V=0,w=new Array,E=0,S=0;if(b)for(S=0;S<m;S++)y&&void 0===y[S]&&(y[S]=new i.Color4(1,1,1,1)),v&&void 0===v[S]&&(v[S]=new i.Vector4(0,0,1,1));if(b)for(S=0;S<m;S++){var C=g.face[S].length;for(a=2*Math.PI/C,o=.5*Math.tan(a/2),u=.5,E=0;E<C;E++)x.push(g.vertex[g.face[S][E]][0]*d,g.vertex[g.face[S][E]][1]*f,g.vertex[g.face[S][E]][2]*p),w.push(I),I++,n=v[S].x+(v[S].z-v[S].x)*(.5+o),s=v[S].y+(v[S].w-v[S].y)*(u-.5),A.push(n,s),h=o*Math.cos(a)-u*Math.sin(a),u=o*Math.sin(a)+u*Math.cos(a),o=h,y&&D.push(y[S].r,y[S].g,y[S].b,y[S].a);for(E=0;E<C-2;E++)M.push(w[0+V],w[E+2+V],w[E+1+V]);V+=C}else{for(E=0;E<g.vertex.length;E++)x.push(g.vertex[E][0]*d,g.vertex[E][1]*f,g.vertex[E][2]*p),A.push(0,0);for(S=0;S<m;S++)for(E=0;E<g.face[S].length-2;E++)M.push(g.face[S][0],g.face[S][E+2],g.face[S][E+1])}t.ComputeNormals(x,M,T),t._ComputeSides(_,x,M,T,A,e.frontUVs,e.backUVs);var P=new t;return P.positions=x,P.indices=M,P.normals=T,P.uvs=A,y&&b&&(P.colors=D),P},t.CreateTorusKnot=function(e){var r,n,s=new Array,a=new Array,o=new Array,u=new Array,h=e.radius||2,c=e.tube||.5,l=e.radialSegments||32,d=e.tubularSegments||32,f=e.p||2,p=e.q||3,g=0===e.sideOrientation?0:e.sideOrientation||t.DEFAULTSIDE,m=function(t){var e=Math.cos(t),r=Math.sin(t),n=p/f*t,s=Math.cos(n),a=h*(2+s)*.5*e,o=h*(2+s)*r*.5,u=h*Math.sin(n)*.5;return new i.Vector3(a,o,u)};for(r=0;r<=l;r++){var v=r%l/l*2*f*Math.PI,y=m(v),b=m(v+.01),_=b.subtract(y),x=b.add(y),M=i.Vector3.Cross(_,x);for(x=i.Vector3.Cross(M,_),M.normalize(),x.normalize(),n=0;n<d;n++){var T=n%d/d*2*Math.PI,A=-c*Math.cos(T),D=c*Math.sin(T);a.push(y.x+A*x.x+D*M.x),a.push(y.y+A*x.y+D*M.y),a.push(y.z+A*x.z+D*M.z),u.push(r/l),u.push(n/d)}}for(r=0;r<l;r++)for(n=0;n<d;n++){var I=(n+1)%d,V=r*d+n,w=(r+1)*d+n,E=(r+1)*d+I,S=r*d+I;s.push(S),s.push(w),s.push(V),s.push(S),s.push(E),s.push(w)}t.ComputeNormals(a,s,o),t._ComputeSides(g,a,s,o,u,e.frontUVs,e.backUVs);var C=new t;return C.indices=s,C.positions=a,C.normals=o,C.uvs=u,C},t.ComputeNormals=function(t,e,r,n){var s=0,a=0,o=0,u=0,h=0,c=0,l=0,d=0,f=0,p=0,g=0,m=0,v=0,y=0,b=0,_=0,x=0,M=0,T=0,A=0,D=!1,I=!1,V=!1,w=!1,E=1,S=0,C=null;if(n&&(D=!!n.facetNormals,I=!!n.facetPositions,V=!!n.facetPartitioning,E=!0===n.useRightHandedSystem?-1:1,S=n.ratio||0,w=!!n.depthSort,C=n.distanceTo,w)){void 0===C&&(C=i.Vector3.Zero());var P=n.depthSortedFacets}var O=0,F=0,R=0,B=0;if(V&&n&&n.bbSize){var L=0,U=0,z=0,N=0,k=0,K=0,W=0,G=0,j=0,H=0,X=0,Q=0,Y=0,Z=0,q=0,J=0,$=n.bbSize.x>n.bbSize.y?n.bbSize.x:n.bbSize.y;$=$>n.bbSize.z?$:n.bbSize.z,O=n.subDiv.X*S/n.bbSize.x,F=n.subDiv.Y*S/n.bbSize.y,R=n.subDiv.Z*S/n.bbSize.z,B=n.subDiv.max*n.subDiv.max,n.facetPartitioning.length=0}for(s=0;s<t.length;s++)r[s]=0;var tt=e.length/3|0;for(s=0;s<tt;s++){if(v=(m=3*e[3*s])+1,y=m+2,_=(b=3*e[3*s+1])+1,x=b+2,T=(M=3*e[3*s+2])+1,A=M+2,a=t[m]-t[b],o=t[v]-t[_],u=t[y]-t[x],h=t[M]-t[b],c=t[T]-t[_],d=E*(o*(l=t[A]-t[x])-u*c),f=E*(u*h-a*l),p=E*(a*c-o*h),d/=g=0===(g=Math.sqrt(d*d+f*f+p*p))?1:g,f/=g,p/=g,D&&n&&(n.facetNormals[s].x=d,n.facetNormals[s].y=f,n.facetNormals[s].z=p),I&&n&&(n.facetPositions[s].x=(t[m]+t[b]+t[M])/3,n.facetPositions[s].y=(t[v]+t[_]+t[T])/3,n.facetPositions[s].z=(t[y]+t[x]+t[A])/3),V&&n&&(L=Math.floor((n.facetPositions[s].x-n.bInfo.minimum.x*S)*O),U=Math.floor((n.facetPositions[s].y-n.bInfo.minimum.y*S)*F),z=Math.floor((n.facetPositions[s].z-n.bInfo.minimum.z*S)*R),N=Math.floor((t[m]-n.bInfo.minimum.x*S)*O),k=Math.floor((t[v]-n.bInfo.minimum.y*S)*F),K=Math.floor((t[y]-n.bInfo.minimum.z*S)*R),W=Math.floor((t[b]-n.bInfo.minimum.x*S)*O),G=Math.floor((t[_]-n.bInfo.minimum.y*S)*F),j=Math.floor((t[x]-n.bInfo.minimum.z*S)*R),H=Math.floor((t[M]-n.bInfo.minimum.x*S)*O),X=Math.floor((t[T]-n.bInfo.minimum.y*S)*F),Q=Math.floor((t[A]-n.bInfo.minimum.z*S)*R),Z=N+n.subDiv.max*k+B*K,q=W+n.subDiv.max*G+B*j,J=H+n.subDiv.max*X+B*Q,Y=L+n.subDiv.max*U+B*z,n.facetPartitioning[Y]=n.facetPartitioning[Y]?n.facetPartitioning[Y]:new Array,n.facetPartitioning[Z]=n.facetPartitioning[Z]?n.facetPartitioning[Z]:new Array,n.facetPartitioning[q]=n.facetPartitioning[q]?n.facetPartitioning[q]:new Array,n.facetPartitioning[J]=n.facetPartitioning[J]?n.facetPartitioning[J]:new Array,n.facetPartitioning[Z].push(s),q!=Z&&n.facetPartitioning[q].push(s),J!=q&&J!=Z&&n.facetPartitioning[J].push(s),Y!=Z&&Y!=q&&Y!=J&&n.facetPartitioning[Y].push(s)),w&&n&&n.facetPositions){var et=P[s];et.ind=3*s,et.sqDistance=i.Vector3.DistanceSquared(n.facetPositions[s],C)}r[m]+=d,r[v]+=f,r[y]+=p,r[b]+=d,r[_]+=f,r[x]+=p,r[M]+=d,r[T]+=f,r[A]+=p}for(s=0;s<r.length/3;s++)d=r[3*s],f=r[3*s+1],p=r[3*s+2],d/=g=0===(g=Math.sqrt(d*d+f*f+p*p))?1:g,f/=g,p/=g,r[3*s]=d,r[3*s+1]=f,r[3*s+2]=p},t._ComputeSides=function(e,r,n,s,a,o,u){var h,c,l=n.length,d=s.length;switch(e=e||t.DEFAULTSIDE){case t.FRONTSIDE:break;case t.BACKSIDE:var f;for(h=0;h<l;h+=3)f=n[h],n[h]=n[h+2],n[h+2]=f;for(c=0;c<d;c++)s[c]=-s[c];break;case t.DOUBLESIDE:for(var p=r.length,g=p/3,m=0;m<p;m++)r[p+m]=r[m];for(h=0;h<l;h+=3)n[h+l]=n[h+2]+g,n[h+1+l]=n[h+1]+g,n[h+2+l]=n[h]+g;for(c=0;c<d;c++)s[d+c]=-s[c];var v=a.length,y=0;for(y=0;y<v;y++)a[y+v]=a[y];for(o=o||new i.Vector4(0,0,1,1),u=u||new i.Vector4(0,0,1,1),y=0,h=0;h<v/2;h++)a[y]=o.x+(o.z-o.x)*a[y],a[y+1]=o.y+(o.w-o.y)*a[y+1],a[y+v]=u.x+(u.z-u.x)*a[y+v],a[y+v+1]=u.y+(u.w-u.y)*a[y+v+1],y+=2}},t.ImportVertexData=function(e,r){var s=new t,a=e.positions;a&&s.set(a,n.b.PositionKind);var o=e.normals;o&&s.set(o,n.b.NormalKind);var u=e.tangents;u&&s.set(u,n.b.TangentKind);var h=e.uvs;h&&s.set(h,n.b.UVKind);var c=e.uv2s;c&&s.set(c,n.b.UV2Kind);var l=e.uv3s;l&&s.set(l,n.b.UV3Kind);var d=e.uv4s;d&&s.set(d,n.b.UV4Kind);var f=e.uv5s;f&&s.set(f,n.b.UV5Kind);var p=e.uv6s;p&&s.set(p,n.b.UV6Kind);var g=e.colors;g&&s.set(i.Color4.CheckColors4(g,a.length/3),n.b.ColorKind);var m=e.matricesIndices;m&&s.set(m,n.b.MatricesIndicesKind);var v=e.matricesWeights;v&&s.set(v,n.b.MatricesWeightsKind);var y=e.indices;y&&(s.indices=y),r.setAllVerticesData(s,e.updatable)},t.FRONTSIDE=0,t.BACKSIDE=1,t.DOUBLESIDE=2,t.DEFAULTSIDE=0,t}()},256:function(t,e,r){"use strict";var i,n=r(160),s=r(1),a=r(29),o=r(5),u=r(7),h=r(6),c=r(83),l=r(135),d=r(9);!function(t){t[t.INIT=0]="INIT",t[t.RUNNING=1]="RUNNING",t[t.DONE=2]="DONE",t[t.ERROR=3]="ERROR"}(i||(i={}));var f=function(){function t(t){this.name=t,this._isCompleted=!1,this._taskState=i.INIT}return Object.defineProperty(t.prototype,"isCompleted",{get:function(){return this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"taskState",{get:function(){return this._taskState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!0,configurable:!0}),t.prototype._setErrorObject=function(t,e){this._errorObject||(this._errorObject={message:t,exception:e})},t.prototype.run=function(t,e,r){var n=this;this._taskState=i.RUNNING,this.runTask(t,function(){n.onDoneCallback(e,r)},function(t,e){n.onErrorCallback(r,t,e)})},t.prototype.runTask=function(t,e,r){throw new Error("runTask is not implemented")},t.prototype.reset=function(){this._taskState=i.INIT},t.prototype.onErrorCallback=function(t,e,r){this._taskState=i.ERROR,this._errorObject={message:e,exception:r},this.onError&&this.onError(this,e,r),t()},t.prototype.onDoneCallback=function(t,e){try{this._taskState=i.DONE,this._isCompleted=!0,this.onSuccess&&this.onSuccess(this),t()}catch(t){this.onErrorCallback(e,"Task is done, error executing success callback(s)",t)}},t}(),p=function(){return function(t,e,r){this.remainingCount=t,this.totalCount=e,this.task=r}}(),g=function(t){function e(e,r,i,n){var s=t.call(this,e)||this;return s.name=e,s.meshesNames=r,s.rootUrl=i,s.sceneFilename=n,s}return s.d(e,t),e.prototype.runTask=function(t,e,r){var i=this;a.a.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,t,function(t,r,n,s){i.loadedMeshes=t,i.loadedParticleSystems=r,i.loadedSkeletons=n,i.loadedAnimationGroups=s,e()},null,function(t,e,i){r(e,i)})},e}(f),m=function(t){function e(e,r){var i=t.call(this,e)||this;return i.name=e,i.url=r,i}return s.d(e,t),e.prototype.runTask=function(t,e,r){var i=this;t._loadFile(this.url,function(t){i.text=t,e()},void 0,!1,!1,function(t,e){t&&r(t.status+" "+t.statusText,e)})},e}(f),v=function(t){function e(e,r){var i=t.call(this,e)||this;return i.name=e,i.url=r,i}return s.d(e,t),e.prototype.runTask=function(t,e,r){var i=this;t._loadFile(this.url,function(t){i.data=t,e()},void 0,!0,!0,function(t,e){t&&r(t.status+" "+t.statusText,e)})},e}(f),y=function(t){function e(e,r){var i=t.call(this,e)||this;return i.name=e,i.url=r,i}return s.d(e,t),e.prototype.runTask=function(t,e,r){var i=this,n=new Image;o.h.SetCorsBehavior(this.url,n),n.onload=function(){i.image=n,e()},n.onerror=function(t){r("Error loading image",t)},n.src=this.url},e}(f),b=function(t){function e(e,r,i,n,s){void 0===s&&(s=h.a.TRILINEAR_SAMPLINGMODE);var a=t.call(this,e)||this;return a.name=e,a.url=r,a.noMipmap=i,a.invertY=n,a.samplingMode=s,a}return s.d(e,t),e.prototype.runTask=function(t,e,r){this.texture=new h.a(this.url,t,this.noMipmap,this.invertY,this.samplingMode,function(){e()},function(t,e){r(t,e)})},e}(f),_=function(t){function e(e,r,i,n,s){var a=t.call(this,e)||this;return a.name=e,a.url=r,a.extensions=i,a.noMipmap=n,a.files=s,a}return s.d(e,t),e.prototype.runTask=function(t,e,r){this.texture=new c.a(this.url,t,this.extensions,this.noMipmap,this.files,function(){e()},function(t,e){r(t,e)})},e}(f),x=function(t){function e(e,r,i,n,s,a,o){void 0===n&&(n=!1),void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===o&&(o=!1);var u=t.call(this,e)||this;return u.name=e,u.url=r,u.size=i,u.noMipmap=n,u.generateHarmonics=s,u.gammaSpace=a,u.reserved=o,u}return s.d(e,t),e.prototype.run=function(t,e,r){this.texture=new l.a(this.url,t,this.size,this.noMipmap,this.generateHarmonics,this.gammaSpace,this.reserved,function(){e()},function(t,e){r(t,e)})},e}(f),M=function(){function t(t){this._isLoading=!1,this._tasks=new Array,this._waitingTasksCount=0,this._totalTasksCount=0,this.onTaskSuccessObservable=new u.c,this.onTaskErrorObservable=new u.c,this.onTasksDoneObservable=new u.c,this.onProgressObservable=new u.c,this.useDefaultLoadingScreen=!0,this._scene=t}return t.prototype.addMeshTask=function(t,e,r,i){var n=new g(t,e,r,i);return this._tasks.push(n),n},t.prototype.addTextFileTask=function(t,e){var r=new m(t,e);return this._tasks.push(r),r},t.prototype.addBinaryFileTask=function(t,e){var r=new v(t,e);return this._tasks.push(r),r},t.prototype.addImageTask=function(t,e){var r=new y(t,e);return this._tasks.push(r),r},t.prototype.addTextureTask=function(t,e,r,i,n){void 0===n&&(n=h.a.TRILINEAR_SAMPLINGMODE);var s=new b(t,e,r,i,n);return this._tasks.push(s),s},t.prototype.addCubeTextureTask=function(t,e,r,i,n){var s=new _(t,e,r,i,n);return this._tasks.push(s),s},t.prototype.addHDRCubeTextureTask=function(t,e,r,i,n,s,a){void 0===i&&(i=!1),void 0===n&&(n=!0),void 0===s&&(s=!1),void 0===a&&(a=!1);var o=new x(t,e,r,i,n,s,a);return this._tasks.push(o),o},t.prototype.removeTask=function(t){var e=this._tasks.indexOf(t);e>-1&&this._tasks.splice(e,1)},t.prototype._decreaseWaitingTasksCount=function(t){this._waitingTasksCount--;try{this.onProgress&&this.onProgress(this._waitingTasksCount,this._totalTasksCount,t),this.onProgressObservable.notifyObservers(new p(this._waitingTasksCount,this._totalTasksCount,t))}catch(t){d.a.Error("Error running progress callbacks."),console.log(t)}if(0===this._waitingTasksCount){try{this.onFinish&&this.onFinish(this._tasks);for(var e=this._tasks.slice(),r=0,n=e;r<n.length;r++){if((t=n[r]).taskState===i.DONE){var s=this._tasks.indexOf(t);s>-1&&this._tasks.splice(s,1)}}this.onTasksDoneObservable.notifyObservers(this._tasks)}catch(t){d.a.Error("Error running tasks-done callbacks."),console.log(t)}this._isLoading=!1,this._scene.getEngine().hideLoadingUI()}},t.prototype._runTask=function(t){var e=this,r=function(r,i){t._setErrorObject(r,i),e.onTaskError&&e.onTaskError(t),e.onTaskErrorObservable.notifyObservers(t),e._decreaseWaitingTasksCount(t)};t.run(this._scene,function(){try{e.onTaskSuccess&&e.onTaskSuccess(t),e.onTaskSuccessObservable.notifyObservers(t),e._decreaseWaitingTasksCount(t)}catch(t){r("Error executing task success callbacks",t)}},r)},t.prototype.reset=function(){return this._isLoading=!1,this._tasks=new Array,this},t.prototype.load=function(){if(this._isLoading)return this;if(this._isLoading=!0,this._waitingTasksCount=this._tasks.length,this._totalTasksCount=this._tasks.length,0===this._waitingTasksCount)return this._isLoading=!1,this.onFinish&&this.onFinish(this._tasks),this.onTasksDoneObservable.notifyObservers(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var t=0;t<this._tasks.length;t++){var e=this._tasks[t];e.taskState===i.INIT&&this._runTask(e)}return this},t}(),T=r(105),A=r(2),D=r(113),I=r(112),V=r(79),w=function(){function t(t,e,r,i,n,s,a,o,u){this.onProcessFileCallback=function(){return!0},this._engine=t,this._currentScene=e,this._sceneLoadedCallback=r,this._progressCallback=i,this._additionalRenderLoopLogicCallback=n,this._textureLoadingCallback=s,this._startingProcessingFilesCallback=a,this._onReloadCallback=o,this._errorCallback=u}return Object.defineProperty(t,"FilesToLoad",{get:function(){return V.a.FilesToLoad},enumerable:!0,configurable:!0}),t.prototype.monitorElementForDragNDrop=function(t){var e=this;t&&(this._elementToMonitor=t,this._dragEnterHandler=function(t){e.drag(t)},this._dragOverHandler=function(t){e.drag(t)},this._dropHandler=function(t){e.drop(t)},this._elementToMonitor.addEventListener("dragenter",this._dragEnterHandler,!1),this._elementToMonitor.addEventListener("dragover",this._dragOverHandler,!1),this._elementToMonitor.addEventListener("drop",this._dropHandler,!1))},t.prototype.dispose=function(){this._elementToMonitor&&(this._elementToMonitor.removeEventListener("dragenter",this._dragEnterHandler),this._elementToMonitor.removeEventListener("dragover",this._dragOverHandler),this._elementToMonitor.removeEventListener("drop",this._dropHandler))},t.prototype.renderFunction=function(){if(this._additionalRenderLoopLogicCallback&&this._additionalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var t=this._currentScene.getWaitingItemsCount();t>0&&this._textureLoadingCallback(t)}this._currentScene.render()}},t.prototype.drag=function(t){t.stopPropagation(),t.preventDefault()},t.prototype.drop=function(t){t.stopPropagation(),t.preventDefault(),this.loadFiles(t)},t.prototype._traverseFolder=function(t,e,r,i){var n=this,s=t.createReader(),a=t.fullPath.replace(/^\//,"").replace(/(.+?)\/?$/,"$1/");s.readEntries(function(t){r.count+=t.length;for(var s=0,o=t;s<o.length;s++){var u=o[s];u.isFile?u.file(function(t){t.correctName=a+t.name,e.push(t),0==--r.count&&i()}):u.isDirectory&&n._traverseFolder(u,e,r,i)}--r.count&&i()})},t.prototype._processFiles=function(e){for(var r=0;r<e.length;r++){var i=e[r].correctName.toLowerCase(),n=i.split(".").pop();this.onProcessFileCallback(e[r],i,n)&&("babylon"!==n&&"stl"!==n&&"obj"!==n&&"gltf"!==n&&"glb"!==n||-1!==i.indexOf(".binary.babylon")||-1!==i.indexOf(".incremental.babylon")||(this._sceneFileToLoad=e[r]),t.FilesToLoad[i]=e[r])}},t.prototype.loadFiles=function(t){var e=this;if(t&&t.dataTransfer&&t.dataTransfer.files&&(this._filesToLoad=t.dataTransfer.files),t&&t.target&&t.target.files&&(this._filesToLoad=t.target.files),this._filesToLoad&&0!==this._filesToLoad.length&&(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(this._filesToLoad),this._filesToLoad&&this._filesToLoad.length>0)){for(var r=new Array,i=[],n=t.dataTransfer?t.dataTransfer.items:null,s=0;s<this._filesToLoad.length;s++){var a=this._filesToLoad[s],o=a.name.toLowerCase(),u=void 0;if(a.correctName=o,n){var h=n[s];h.getAsEntry?u=h.getAsEntry():h.webkitGetAsEntry&&(u=h.webkitGetAsEntry())}u&&u.isDirectory?i.push(u):r.push(a)}if(0===i.length)this._processFiles(r),this._processReload();else for(var c={count:i.length},l=0,d=i;l<d.length;l++){var f=d[l];this._traverseFolder(f,r,c,function(){e._processFiles(r),0===c.count&&e._processReload()})}}},t.prototype._processReload=function(){this._onReloadCallback?this._onReloadCallback(this._sceneFileToLoad):this.reload()},t.prototype.reload=function(){var t=this;this._sceneFileToLoad?(this._currentScene&&(d.a.errorsCount>0&&d.a.ClearLogCache(),this._engine.stopRenderLoop()),a.a.LoadAsync("file:",this._sceneFileToLoad,this._engine,function(e){t._progressCallback&&t._progressCallback(e)}).then(function(e){t._currentScene&&t._currentScene.dispose(),t._currentScene=e,t._sceneLoadedCallback&&t._sceneLoadedCallback(t._sceneFileToLoad,t._currentScene),t._currentScene.executeWhenReady(function(){t._engine.runRenderLoop(function(){t.renderFunction()})})}).catch(function(e){t._errorCallback&&t._errorCallback(t._sceneFileToLoad,t._currentScene,e.message)})):d.a.Error("Please provide a valid .babylon file.")},t}(),E=r(98),S=r(197),C=r(198),P=r(149),O=r(162),F=r(163),R=r(238),B=r(239),L=r(36),U=r(80),z=r(27),N=r(101),k=r(119),K=r(240),W=r(104),G=r(241),j=r(26),H=r(41),X=r(55),Q=r(59),Y=r(242);r.d(e,"b",function(){return n.a}),r.d(e,"c",function(){return i}),r.d(e,"a",function(){return f}),r.d(e,"e",function(){return p}),r.d(e,"E",function(){return g}),r.d(e,"fb",function(){return m}),r.d(e,"g",function(){return v}),r.d(e,"x",function(){return y}),r.d(e,"gb",function(){return b}),r.d(e,"k",function(){return _}),r.d(e,"u",function(){return x}),r.d(e,"d",function(){return M}),r.d(e,"m",function(){return T.a}),r.d(e,"pb",function(){return A.b}),r.d(e,"qb",function(){return A.c}),r.d(e,"zb",function(){return A.l}),r.d(e,"sb",function(){return A.e}),r.d(e,"vb",function(){return A.h}),r.d(e,"Ab",function(){return A.m}),r.d(e,"Bb",function(){return A.n}),r.d(e,"xb",function(){return A.j}),r.d(e,"ub",function(){return A.g}),r.d(e,"tb",function(){return A.f}),r.d(e,"wb",function(){return A.i}),r.d(e,"yb",function(){return A.k}),r.d(e,"rb",function(){return A.d}),r.d(e,"Y",function(){return A.a}),r.d(e,"o",function(){return D.a}),r.d(e,"p",function(){return I.a}),r.d(e,"s",function(){return w}),r.d(e,"j",function(){return E.a}),r.d(e,"v",function(){return S.a}),r.d(e,"I",function(){return C.a}),r.d(e,"z",function(){return P.a}),r.d(e,"q",function(){return u.a}),r.d(e,"H",function(){return u.d}),r.d(e,"F",function(){return u.b}),r.d(e,"G",function(){return u.c}),r.d(e,"L",function(){return O.a}),r.d(e,"S",function(){return O.b}),r.d(e,"P",function(){return F.a}),r.d(e,"T",function(){return R.h}),r.d(e,"hb",function(){return R.l}),r.d(e,"w",function(){return R.b}),r.d(e,"Z",function(){return R.k}),r.d(e,"N",function(){return R.f}),r.d(e,"A",function(){return R.c}),r.d(e,"l",function(){return R.a}),r.d(e,"J",function(){return R.e}),r.d(e,"Q",function(){return R.g}),r.d(e,"D",function(){return R.d}),r.d(e,"V",function(){return R.j}),r.d(e,"U",function(){return R.i}),r.d(e,"W",function(){return B.a}),r.d(e,"ab",function(){return L.a}),r.d(e,"bb",function(){return L.b}),r.d(e,"cb",function(){return U.a}),r.d(e,"eb",function(){return z.a}),r.d(e,"ib",function(){return N.a}),r.d(e,"db",function(){return k.a}),r.d(e,"i",function(){return o.c}),r.d(e,"h",function(){return o.b}),r.d(e,"r",function(){return o.d}),r.d(e,"B",function(){return o.e}),r.d(e,"R",function(){return o.g}),r.d(e,"jb",function(){return o.h}),r.d(e,"K",function(){return o.f}),r.d(e,"ob",function(){return o.i}),r.d(e,"f",function(){return o.a}),r.d(e,"kb",function(){return K.a}),r.d(e,"y",function(){return W.a}),r.d(e,"lb",function(){return W.b}),r.d(e,"mb",function(){return G.a}),r.d(e,"C",function(){return d.a}),r.d(e,"nb",function(){return j.a}),r.d(e,"t",function(){return V.a}),r.d(e,"n",function(){return H.a}),r.d(e,"M",function(){return X.a}),r.d(e,"O",function(){return Q.a}),r.d(e,"X",function(){return Y.a}),r.d(e,"nb",function(){return j.a})},260:function(t,e,r){"use strict";var i,n=r(23),s=r(3),a=r(232),o=r(0),u=r(56),h=r(10),c=0,l=function(){function t(t,e,r){this.pos=t,this.normal=e,this.uv=r}return t.prototype.clone=function(){return new t(this.pos.clone(),this.normal.clone(),this.uv.clone())},t.prototype.flip=function(){this.normal=this.normal.scale(-1)},t.prototype.interpolate=function(e,r){return new t(o.Vector3.Lerp(this.pos,e.pos,r),o.Vector3.Lerp(this.normal,e.normal,r),o.Vector2.Lerp(this.uv,e.uv,r))},t}(),d=function(){function t(t,e){this.normal=t,this.w=e}return t.FromPoints=function(e,r,i){var n=i.subtract(e),s=r.subtract(e);if(0===n.lengthSquared()||0===s.lengthSquared())return null;var a=o.Vector3.Normalize(o.Vector3.Cross(n,s));return new t(a,o.Vector3.Dot(a,e))},t.prototype.clone=function(){return new t(this.normal.clone(),this.w)},t.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},t.prototype.splitPolygon=function(e,r,i,n,s){var a,u,h=0,c=[];for(a=0;a<e.vertices.length;a++){var l=(u=o.Vector3.Dot(this.normal,e.vertices[a].pos)-this.w)<-t.EPSILON?2:u>t.EPSILON?1:0;h|=l,c.push(l)}switch(h){case 0:(o.Vector3.Dot(this.normal,e.plane.normal)>0?r:i).push(e);break;case 1:n.push(e);break;case 2:s.push(e);break;case 3:var d,p=[],g=[];for(a=0;a<e.vertices.length;a++){var m=(a+1)%e.vertices.length,v=c[a],y=c[m],b=e.vertices[a],_=e.vertices[m];if(2!==v&&p.push(b),1!==v&&g.push(2!==v?b.clone():b),3==(v|y)){u=(this.w-o.Vector3.Dot(this.normal,b.pos))/o.Vector3.Dot(this.normal,_.pos.subtract(b.pos));var x=b.interpolate(_,u);p.push(x),g.push(x.clone())}}p.length>=3&&(d=new f(p,e.shared)).plane&&n.push(d),g.length>=3&&(d=new f(g,e.shared)).plane&&s.push(d)}},t.EPSILON=1e-5,t}(),f=function(){function t(t,e){this.vertices=t,this.shared=e,this.plane=d.FromPoints(t[0].pos,t[1].pos,t[2].pos)}return t.prototype.clone=function(){return new t(this.vertices.map(function(t){return t.clone()}),this.shared)},t.prototype.flip=function(){this.vertices.reverse().map(function(t){t.flip()}),this.plane.flip()},t}(),p=function(){function t(t){this.plane=null,this.front=null,this.back=null,this.polygons=new Array,t&&this.build(t)}return t.prototype.clone=function(){var e=new t;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(function(t){return t.clone()}),e},t.prototype.invert=function(){for(var t=0;t<this.polygons.length;t++)this.polygons[t].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var e=this.front;this.front=this.back,this.back=e},t.prototype.clipPolygons=function(t){if(!this.plane)return t.slice();for(var e=new Array,r=new Array,i=0;i<t.length;i++)this.plane.splitPolygon(t[i],e,r,e,r);return this.front&&(e=this.front.clipPolygons(e)),r=this.back?this.back.clipPolygons(r):[],e.concat(r)},t.prototype.clipTo=function(t){this.polygons=t.clipPolygons(this.polygons),this.front&&this.front.clipTo(t),this.back&&this.back.clipTo(t)},t.prototype.allPolygons=function(){var t=this.polygons.slice();return this.front&&(t=t.concat(this.front.allPolygons())),this.back&&(t=t.concat(this.back.allPolygons())),t},t.prototype.build=function(e){if(e.length){this.plane||(this.plane=e[0].plane.clone());for(var r=new Array,i=new Array,n=0;n<e.length;n++)this.plane.splitPolygon(e[n],this.polygons,this.polygons,r,i);r.length&&(this.front||(this.front=new t),this.front.build(r)),i.length&&(this.back||(this.back=new t),this.back.build(i))}},t}(),g=function(){function t(){this.polygons=new Array}return t.FromMesh=function(e){var r,i,n,a,u,d,p,g,m,v,y=new Array,b=null;if(!(e instanceof h.a))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";e.computeWorldMatrix(!0),p=e.getWorldMatrix(),g=e.position.clone(),m=e.rotation.clone(),e.rotationQuaternion&&(b=e.rotationQuaternion.clone()),v=e.scaling.clone();for(var _=e.getIndices(),x=e.getVerticesData(s.b.PositionKind),M=e.getVerticesData(s.b.NormalKind),T=e.getVerticesData(s.b.UVKind),A=e.subMeshes,D=0,I=A.length;D<I;D++)for(var V=A[D].indexStart,w=A[D].indexCount+A[D].indexStart;V<w;V+=3){d=[];for(var E=0;E<3;E++){var S=new o.Vector3(M[3*_[V+E]],M[3*_[V+E]+1],M[3*_[V+E]+2]);n=new o.Vector2(T[2*_[V+E]],T[2*_[V+E]+1]);var C=new o.Vector3(x[3*_[V+E]],x[3*_[V+E]+1],x[3*_[V+E]+2]);a=o.Vector3.TransformCoordinates(C,p),i=o.Vector3.TransformNormal(S,p),r=new l(a,i,n),d.push(r)}(u=new f(d,{subMeshId:D,meshId:c,materialIndex:A[D].materialIndex})).plane&&y.push(u)}var P=t.FromPolygons(y);return P.matrix=p,P.position=g,P.rotation=m,P.scaling=v,P.rotationQuaternion=b,c++,P},t.FromPolygons=function(e){var r=new t;return r.polygons=e,r},t.prototype.clone=function(){var e=new t;return e.polygons=this.polygons.map(function(t){return t.clone()}),e.copyTransformAttributes(this),e},t.prototype.union=function(e){var r=new p(this.clone().polygons),i=new p(e.clone().polygons);return r.clipTo(i),i.clipTo(r),i.invert(),i.clipTo(r),i.invert(),r.build(i.allPolygons()),t.FromPolygons(r.allPolygons()).copyTransformAttributes(this)},t.prototype.unionInPlace=function(t){var e=new p(this.polygons),r=new p(t.polygons);e.clipTo(r),r.clipTo(e),r.invert(),r.clipTo(e),r.invert(),e.build(r.allPolygons()),this.polygons=e.allPolygons()},t.prototype.subtract=function(e){var r=new p(this.clone().polygons),i=new p(e.clone().polygons);return r.invert(),r.clipTo(i),i.clipTo(r),i.invert(),i.clipTo(r),i.invert(),r.build(i.allPolygons()),r.invert(),t.FromPolygons(r.allPolygons()).copyTransformAttributes(this)},t.prototype.subtractInPlace=function(t){var e=new p(this.polygons),r=new p(t.polygons);e.invert(),e.clipTo(r),r.clipTo(e),r.invert(),r.clipTo(e),r.invert(),e.build(r.allPolygons()),e.invert(),this.polygons=e.allPolygons()},t.prototype.intersect=function(e){var r=new p(this.clone().polygons),i=new p(e.clone().polygons);return r.invert(),i.clipTo(r),i.invert(),r.clipTo(i),i.clipTo(r),r.build(i.allPolygons()),r.invert(),t.FromPolygons(r.allPolygons()).copyTransformAttributes(this)},t.prototype.intersectInPlace=function(t){var e=new p(this.polygons),r=new p(t.polygons);e.invert(),r.clipTo(e),r.invert(),e.clipTo(r),r.clipTo(e),e.build(r.allPolygons()),e.invert(),this.polygons=e.allPolygons()},t.prototype.inverse=function(){var t=this.clone();return t.inverseInPlace(),t},t.prototype.inverseInPlace=function(){this.polygons.map(function(t){t.flip()})},t.prototype.copyTransformAttributes=function(t){return this.matrix=t.matrix,this.position=t.position,this.rotation=t.rotation,this.scaling=t.scaling,this.rotationQuaternion=t.rotationQuaternion,this},t.prototype.buildMeshGeometry=function(t,e,r){var i=this.matrix.clone();i.invert();var n,a,c,l=new h.a(t,e),d=[],f=[],p=[],g=[],m=o.Vector3.Zero(),v=o.Vector3.Zero(),y=o.Vector2.Zero(),b=this.polygons,_=[0,0,0],x={},M=0,T={};r&&b.sort(function(t,e){return t.shared.meshId===e.shared.meshId?t.shared.subMeshId-e.shared.subMeshId:t.shared.meshId-e.shared.meshId});for(var A=0,D=b.length;A<D;A++){T[(n=b[A]).shared.meshId]||(T[n.shared.meshId]={}),T[n.shared.meshId][n.shared.subMeshId]||(T[n.shared.meshId][n.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:n.shared.materialIndex}),c=T[n.shared.meshId][n.shared.subMeshId];for(var I=2,V=n.vertices.length;I<V;I++){_[0]=0,_[1]=I-1,_[2]=I;for(var w=0;w<3;w++){m.copyFrom(n.vertices[_[w]].pos),v.copyFrom(n.vertices[_[w]].normal),y.copyFrom(n.vertices[_[w]].uv);var E=o.Vector3.TransformCoordinates(m,i),S=o.Vector3.TransformNormal(v,i);void 0!==(a=x[E.x+","+E.y+","+E.z])&&p[3*a]===S.x&&p[3*a+1]===S.y&&p[3*a+2]===S.z&&g[2*a]===y.x&&g[2*a+1]===y.y||(d.push(E.x,E.y,E.z),g.push(y.x,y.y),p.push(v.x,v.y,v.z),a=x[E.x+","+E.y+","+E.z]=d.length/3-1),f.push(a),c.indexStart=Math.min(M,c.indexStart),c.indexEnd=Math.max(M,c.indexEnd),M++}}}if(l.setVerticesData(s.b.PositionKind,d),l.setVerticesData(s.b.NormalKind,p),l.setVerticesData(s.b.UVKind,g),l.setIndices(f,null),r){var C,P=0;for(var O in l.subMeshes=new Array,T){for(var F in C=-1,T[O])c=T[O][F],u.b.CreateFromIndices(c.materialIndex+P,c.indexStart,c.indexEnd-c.indexStart+1,l),C=Math.max(c.materialIndex,C);P+=++C}}return l},t.prototype.toMesh=function(t,e,r,i){var n=this.buildMeshGeometry(t,r,i);return n.material=e,n.position.copyFrom(this.position),n.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(n.rotationQuaternion=this.rotationQuaternion.clone()),n.scaling.copyFrom(this.scaling),n.computeWorldMatrix(!0),n},t}(),m=r(32),v=r(148),y=r(117),b=r(82),_=r(24),x=r(28),M=r(5),T=function(){return function(t,e,r){this.quality=t,this.distance=e,this.optimizeMesh=r}}(),A=function(){function t(){this.running=!1,this._simplificationArray=[]}return t.prototype.addTask=function(t){this._simplificationArray.push(t)},t.prototype.executeNext=function(){var t=this._simplificationArray.pop();t?(this.running=!0,this.runSimplification(t)):this.running=!1},t.prototype.runSimplification=function(t){var e=this;if(t.parallelProcessing)t.settings.forEach(function(r){e.getSimplifier(t).simplify(r,function(i){t.mesh.addLODLevel(r.distance,i),i.isVisible=!0,r.quality===t.settings[t.settings.length-1].quality&&t.successCallback&&t.successCallback(),e.executeNext()})});else{var r=this.getSimplifier(t);M.a.Run(t.settings.length,function(e){var i,n;i=t.settings[e.index],n=function(){e.executeNext()},r.simplify(i,function(e){t.mesh.addLODLevel(i.distance,e),e.isVisible=!0,n()})},function(){t.successCallback&&t.successCallback(),e.executeNext()})}},t.prototype.getSimplifier=function(t){switch(t.simplificationType){case i.QUADRATIC:default:return new E(t.mesh)}},t}();!function(t){t[t.QUADRATIC=0]="QUADRATIC"}(i||(i={}));var D=function(){return function(t){this.vertices=t,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}}(),I=function(){function t(t,e){this.position=t,this.id=e,this.isBorder=!0,this.q=new V,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return t.prototype.updatePosition=function(t){this.position.copyFrom(t)},t}(),V=function(){function t(t){this.data=new Array(10);for(var e=0;e<10;++e)t&&t[e]?this.data[e]=t[e]:this.data[e]=0}return t.prototype.det=function(t,e,r,i,n,s,a,o,u){return this.data[t]*this.data[n]*this.data[u]+this.data[r]*this.data[i]*this.data[o]+this.data[e]*this.data[s]*this.data[a]-this.data[r]*this.data[n]*this.data[a]-this.data[t]*this.data[s]*this.data[o]-this.data[e]*this.data[i]*this.data[u]},t.prototype.addInPlace=function(t){for(var e=0;e<10;++e)this.data[e]+=t.data[e]},t.prototype.addArrayInPlace=function(t){for(var e=0;e<10;++e)this.data[e]+=t[e]},t.prototype.add=function(e){for(var r=new t,i=0;i<10;++i)r.data[i]=this.data[i]+e.data[i];return r},t.FromData=function(e,r,i,n){return new t(t.DataFromNumbers(e,r,i,n))},t.DataFromNumbers=function(t,e,r,i){return[t*t,t*e,t*r,t*i,e*e,e*r,e*i,r*r,r*i,i*i]},t}(),w=function(){return function(t,e){this.vertexId=t,this.triangleId=e}}(),E=function(){function t(t){this._mesh=t,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=o.Epsilon}return t.prototype.simplify=function(t,e){var r=this;this.initDecimatedMesh(),M.a.Run(this._mesh.subMeshes.length,function(e){r.initWithMesh(e.index,function(){r.runDecimation(t,e.index,function(){e.executeNext()})},t.optimizeMesh)},function(){setTimeout(function(){e(r._reconstructedMesh)},0)})},t.prototype.runDecimation=function(t,e,r){var i=this,n=~~(this.triangles.length*t.quality),s=0,a=this.triangles.length;M.a.Run(this.decimationIterations,function(t){var e,r;a-s<=n?t.breakLoop():(e=t.index,r=function(){t.executeNext()},setTimeout(function(){e%5==0&&i.updateMesh(0===e);for(var t=0;t<i.triangles.length;++t)i.triangles[t].isDirty=!1;var u=1e-9*Math.pow(e+3,i.aggressiveness);M.a.SyncAsyncForLoop(i.triangles.length,i.syncIterations,function(t){var e=~~((i.triangles.length/2+t)%i.triangles.length),r=i.triangles[e];if(r&&!(r.error[3]>u||r.deleted||r.isDirty))for(var n=0;n<3;++n)if(r.error[n]<u){var a=[],h=[],c=r.vertices[n],l=r.vertices[(n+1)%3];if(c.isBorder||l.isBorder)continue;var d=o.Vector3.Zero();i.calculateError(c,l,d);var f=new Array;if(i.isFlipped(c,l,d,a,f))continue;if(i.isFlipped(l,c,d,h,f))continue;if(a.indexOf(!0)<0||h.indexOf(!0)<0)continue;var p=new Array;if(f.forEach(function(t){-1===p.indexOf(t)&&(t.deletePending=!0,p.push(t))}),p.length%2!=0)continue;c.q=l.q.add(c.q),c.updatePosition(d);var g=i.references.length;s=i.updateTriangles(c,c,a,s),s=i.updateTriangles(c,l,h,s);var m=i.references.length-g;if(m<=c.triangleCount){if(m)for(var v=0;v<m;v++)i.references[c.triangleStart+v]=i.references[g+v]}else c.triangleStart=g;c.triangleCount=m;break}},r,function(){return a-s<=n})},0))},function(){setTimeout(function(){i.reconstructMesh(e),r()},0)})},t.prototype.initWithMesh=function(t,e,r){var i=this;this.vertices=[],this.triangles=[];var n=this._mesh.getVerticesData(s.b.PositionKind),a=this._mesh.getIndices(),u=this._mesh.subMeshes[t],h=[],c=u.verticesCount;M.a.SyncAsyncForLoop(c,this.syncIterations/4>>0,function(t){if(n){var e=t+u.verticesStart,s=o.Vector3.FromArray(n,3*e),a=function(t){if(r)for(var e=0;e<i.vertices.length;++e)if(i.vertices[e].position.equals(t))return i.vertices[e];return null}(s)||new I(s,i.vertices.length);a.originalOffsets.push(e),a.id===i.vertices.length&&i.vertices.push(a),h.push(a.id)}},function(){M.a.SyncAsyncForLoop(u.indexCount/3,i.syncIterations,function(t){if(a){var e=3*(u.indexStart/3+t),r=a[e+0],n=a[e+1],s=a[e+2],o=i.vertices[h[r-u.verticesStart]],c=i.vertices[h[n-u.verticesStart]],l=i.vertices[h[s-u.verticesStart]],d=new D([o,c,l]);d.originalOffset=e,i.triangles.push(d)}},function(){i.init(e)})})},t.prototype.init=function(t){var e=this;M.a.SyncAsyncForLoop(this.triangles.length,this.syncIterations,function(t){var r=e.triangles[t];r.normal=o.Vector3.Cross(r.vertices[1].position.subtract(r.vertices[0].position),r.vertices[2].position.subtract(r.vertices[0].position)).normalize();for(var i=0;i<3;i++)r.vertices[i].q.addArrayInPlace(V.DataFromNumbers(r.normal.x,r.normal.y,r.normal.z,-o.Vector3.Dot(r.normal,r.vertices[0].position)))},function(){M.a.SyncAsyncForLoop(e.triangles.length,e.syncIterations,function(t){for(var r=e.triangles[t],i=0;i<3;++i)r.error[i]=e.calculateError(r.vertices[i],r.vertices[(i+1)%3]);r.error[3]=Math.min(r.error[0],r.error[1],r.error[2])},function(){t()})})},t.prototype.reconstructMesh=function(t){var e,r,i,n=[];for(e=0;e<this.vertices.length;++e)this.vertices[e].triangleCount=0;for(e=0;e<this.triangles.length;++e)if(!this.triangles[e].deleted){for(r=this.triangles[e],i=0;i<3;++i)r.vertices[i].triangleCount=1;n.push(r)}var a=this._reconstructedMesh.getVerticesData(s.b.PositionKind)||[],o=this._reconstructedMesh.getVerticesData(s.b.NormalKind)||[],h=this._reconstructedMesh.getVerticesData(s.b.UVKind)||[],c=this._reconstructedMesh.getVerticesData(s.b.ColorKind)||[],l=this._mesh.getVerticesData(s.b.NormalKind),d=this._mesh.getVerticesData(s.b.UVKind),f=this._mesh.getVerticesData(s.b.ColorKind),p=0;for(e=0;e<this.vertices.length;++e){var g=this.vertices[e];g.id=p,g.triangleCount&&g.originalOffsets.forEach(function(t){l&&(a.push(g.position.x),a.push(g.position.y),a.push(g.position.z),o.push(l[3*t]),o.push(l[3*t+1]),o.push(l[3*t+2]),d&&d.length?(h.push(d[2*t]),h.push(d[2*t+1])):f&&f.length&&(c.push(f[4*t]),c.push(f[4*t+1]),c.push(f[4*t+2]),c.push(f[4*t+3])),++p)})}var m=this._reconstructedMesh.getTotalIndices(),v=this._reconstructedMesh.getTotalVertices(),y=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var b=this._reconstructedMesh.getIndices(),_=this._mesh.getIndices();for(e=0;e<n.length;++e)r=n[e],[0,1,2].forEach(function(t){var e=_[r.originalOffset+t],i=r.vertices[t].originalOffsets.indexOf(e);i<0&&(i=0),b.push(r.vertices[t].id+i+v)});this._reconstructedMesh.setIndices(b),this._reconstructedMesh.setVerticesData(s.b.PositionKind,a),this._reconstructedMesh.setVerticesData(s.b.NormalKind,o),h.length>0&&this._reconstructedMesh.setVerticesData(s.b.UVKind,h),c.length>0&&this._reconstructedMesh.setVerticesData(s.b.ColorKind,c);var x=this._mesh.subMeshes[t];t>0&&(this._reconstructedMesh.subMeshes=[],y.forEach(function(t){u.b.AddToMesh(t.materialIndex,t.verticesStart,t.verticesCount,t.indexStart,t.indexCount,t.getMesh())}),u.b.AddToMesh(x.materialIndex,v,p,m,3*n.length,this._reconstructedMesh))},t.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new h.a(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},t.prototype.isFlipped=function(t,e,r,i,n){for(var s=0;s<t.triangleCount;++s){var a=this.triangles[this.references[t.triangleStart+s].triangleId];if(!a.deleted){var u=this.references[t.triangleStart+s].vertexId,h=a.vertices[(u+1)%3],c=a.vertices[(u+2)%3];if(h!==e&&c!==e){var l=h.position.subtract(r);l=l.normalize();var d=c.position.subtract(r);if(d=d.normalize(),Math.abs(o.Vector3.Dot(l,d))>.999)return!0;var f=o.Vector3.Cross(l,d).normalize();if(i[s]=!1,o.Vector3.Dot(f,a.normal)<.2)return!0}else i[s]=!0,n.push(a)}}return!1},t.prototype.updateTriangles=function(t,e,r,i){for(var n=i,s=0;s<e.triangleCount;++s){var a=this.references[e.triangleStart+s],o=this.triangles[a.triangleId];o.deleted||(r[s]&&o.deletePending?(o.deleted=!0,n++):(o.vertices[a.vertexId]=t,o.isDirty=!0,o.error[0]=this.calculateError(o.vertices[0],o.vertices[1])+o.borderFactor/2,o.error[1]=this.calculateError(o.vertices[1],o.vertices[2])+o.borderFactor/2,o.error[2]=this.calculateError(o.vertices[2],o.vertices[0])+o.borderFactor/2,o.error[3]=Math.min(o.error[0],o.error[1],o.error[2]),this.references.push(a)))}return n},t.prototype.identifyBorder=function(){for(var t=0;t<this.vertices.length;++t){var e,r=[],i=[],n=this.vertices[t];for(e=0;e<n.triangleCount;++e)for(var s=this.triangles[this.references[n.triangleStart+e].triangleId],a=0;a<3;a++){for(var o=0,u=s.vertices[a];o<r.length&&i[o]!==u.id;)++o;o===r.length?(r.push(1),i.push(u.id)):r[o]++}for(e=0;e<r.length;++e)1===r[e]?this.vertices[i[e]].isBorder=!0:this.vertices[i[e]].isBorder=!1}},t.prototype.updateMesh=function(t){var e,r,i,n;if(void 0===t&&(t=!1),!t){var s=[];for(e=0;e<this.triangles.length;++e)this.triangles[e].deleted||s.push(this.triangles[e]);this.triangles=s}for(e=0;e<this.vertices.length;++e)this.vertices[e].triangleCount=0,this.vertices[e].triangleStart=0;for(e=0;e<this.triangles.length;++e)for(r=this.triangles[e],i=0;i<3;++i)(n=r.vertices[i]).triangleCount++;var a=0;for(e=0;e<this.vertices.length;++e)this.vertices[e].triangleStart=a,a+=this.vertices[e].triangleCount,this.vertices[e].triangleCount=0;var o=new Array(3*this.triangles.length);for(e=0;e<this.triangles.length;++e)for(r=this.triangles[e],i=0;i<3;++i)o[(n=r.vertices[i]).triangleStart+n.triangleCount]=new w(i,e),n.triangleCount++;this.references=o,t&&this.identifyBorder()},t.prototype.vertexError=function(t,e){var r=e.x,i=e.y,n=e.z;return t.data[0]*r*r+2*t.data[1]*r*i+2*t.data[2]*r*n+2*t.data[3]*r+t.data[4]*i*i+2*t.data[5]*i*n+2*t.data[6]*i+t.data[7]*n*n+2*t.data[8]*n+t.data[9]},t.prototype.calculateError=function(t,e,r){var i=t.q.add(e.q),n=t.isBorder&&e.isBorder,s=0,a=i.det(0,1,2,1,4,5,2,5,7);if(0===a||n){var u=t.position.add(e.position).divide(new o.Vector3(2,2,2)),h=this.vertexError(i,t.position),c=this.vertexError(i,e.position),l=this.vertexError(i,u);(s=Math.min(h,c,l))===h?r&&r.copyFrom(t.position):s===c?r&&r.copyFrom(e.position):r&&r.copyFrom(u)}else r||(r=o.Vector3.Zero()),r.x=-1/a*i.det(1,2,3,4,5,6,5,7,8),r.y=1/a*i.det(0,2,3,1,5,6,2,7,8),r.z=-1/a*i.det(0,1,3,1,4,6,2,5,8),s=this.vertexError(i,r);return s},t}(),S=r(19),C=r(15);Object.defineProperty(S.Scene.prototype,"simplificationQueue",{get:function(){if(!this._simplificationQueue){this._simplificationQueue=new A;var t=this._getComponent(C.a.NAME_SIMPLIFICATIONQUEUE);t||(t=new P(this),this._addComponent(t))}return this._simplificationQueue},set:function(t){this._simplificationQueue=t},enumerable:!0,configurable:!0}),h.a.prototype.simplify=function(t,e,r,n){return void 0===e&&(e=!0),void 0===r&&(r=i.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:t,parallelProcessing:e,mesh:this,simplificationType:r,successCallback:n}),this};var P=function(){function t(t){this.name=C.a.NAME_SIMPLIFICATIONQUEUE,this.scene=t}return t.prototype.register=function(){this.scene._beforeCameraUpdateStage.registerStep(C.a.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,this,this._beforeCameraUpdate)},t.prototype.rebuild=function(){},t.prototype.dispose=function(){},t.prototype._beforeCameraUpdate=function(){this.scene._simplificationQueue&&!this.scene._simplificationQueue.running&&this.scene._simplificationQueue.executeNext()},t}(),O=r(134),F=r(49);r.d(e,"a",function(){return n.a}),r.d(e,"d",function(){return s.a}),r.d(e,"F",function(){return s.b}),r.d(e,"h",function(){return a.a}),r.d(e,"e",function(){return g}),r.d(e,"i",function(){return m.d}),r.d(e,"J",function(){return m.l}),r.d(e,"u",function(){return m.g}),r.d(e,"c",function(){return m.a}),r.d(e,"z",function(){return m.h}),r.d(e,"g",function(){return m.c}),r.d(e,"f",function(){return m.b}),r.d(e,"C",function(){return m.j}),r.d(e,"j",function(){return m.e}),r.d(e,"B",function(){return m.i}),r.d(e,"r",function(){return m.f}),r.d(e,"D",function(){return m.k}),r.d(e,"k",function(){return v.a}),r.d(e,"m",function(){return y.a}),r.d(e,"n",function(){return b.b}),r.d(e,"l",function(){return b.a}),r.d(e,"q",function(){return h.b}),r.d(e,"H",function(){return h.c}),r.d(e,"I",function(){return h.d}),r.d(e,"o",function(){return h.a}),r.d(e,"G",function(){return _.a}),r.d(e,"p",function(){return x.MeshBuilder}),r.d(e,"x",function(){return T}),r.d(e,"w",function(){return A}),r.d(e,"y",function(){return i}),r.d(e,"v",function(){return P}),r.d(e,"s",function(){return O.a}),r.d(e,"t",function(){return O.b}),r.d(e,"b",function(){return u.a}),r.d(e,"A",function(){return u.b}),r.d(e,"E",function(){return F.a})},28:function(t,e,r){"use strict";r.r(e),r.d(e,"MeshBuilder",function(){return f});var i=r(5),n=r(19),s=r(0),a=r(10),o=r(3),u=r(82),h=r(24),c=r(148),l=r(134),d=r(53);a.a.CreateRibbon=function(t,e,r,i,n,s,a,o,u){return void 0===r&&(r=!1),void 0===a&&(a=!1),f.CreateRibbon(t,{pathArray:e,closeArray:r,closePath:i,offset:n,updatable:a,sideOrientation:o,instance:u},s)},a.a.CreateDisc=function(t,e,r,i,n,s){void 0===i&&(i=null);var a={radius:e,tessellation:r,sideOrientation:s,updatable:n};return f.CreateDisc(t,a,i)},a.a.CreateBox=function(t,e,r,i,n){void 0===r&&(r=null);var s={size:e,sideOrientation:n,updatable:i};return f.CreateBox(t,s,r)},a.a.CreateSphere=function(t,e,r,i,n,s){var a={segments:e,diameterX:r,diameterY:r,diameterZ:r,sideOrientation:s,updatable:n};return f.CreateSphere(t,a,i)},a.a.CreateCylinder=function(t,e,r,i,s,o,u,h,c){void 0!==u&&u instanceof n.Scene||(void 0!==u&&(c=h||a.a.DEFAULTSIDE,h=u),u=o,o=1);var l={height:e,diameterTop:r,diameterBottom:i,tessellation:s,subdivisions:o,sideOrientation:c,updatable:h};return f.CreateCylinder(t,l,u)},a.a.CreateTorus=function(t,e,r,i,n,s,a){var o={diameter:e,thickness:r,tessellation:i,sideOrientation:a,updatable:s};return f.CreateTorus(t,o,n)},a.a.CreateTorusKnot=function(t,e,r,i,n,s,a,o,u,h){var c={radius:e,tube:r,radialSegments:i,tubularSegments:n,p:s,q:a,sideOrientation:h,updatable:u};return f.CreateTorusKnot(t,c,o)},a.a.CreateLines=function(t,e,r,i,n){void 0===r&&(r=null),void 0===i&&(i=!1),void 0===n&&(n=null);var s={points:e,updatable:i,instance:n};return f.CreateLines(t,s,r)},a.a.CreateDashedLines=function(t,e,r,i,n,s,a,o){void 0===s&&(s=null);var u={points:e,dashSize:r,gapSize:i,dashNb:n,updatable:a,instance:o};return f.CreateDashedLines(t,u,s)},a.a.CreatePolygon=function(t,e,r,i,n,s){var a={shape:e,holes:i,updatable:n,sideOrientation:s};return f.CreatePolygon(t,a,r)},a.a.ExtrudePolygon=function(t,e,r,i,n,s,a){var o={shape:e,holes:n,depth:r,updatable:s,sideOrientation:a};return f.ExtrudePolygon(t,o,i)},a.a.ExtrudeShape=function(t,e,r,i,n,s,o,u,h,c){void 0===o&&(o=null);var l={shape:e,path:r,scale:i,rotation:n,cap:0===s?0:s||a.a.NO_CAP,sideOrientation:h,instance:c,updatable:u};return f.ExtrudeShape(t,l,o)},a.a.ExtrudeShapeCustom=function(t,e,r,i,n,s,o,u,h,c,l,d){var p={shape:e,path:r,scaleFunction:i,rotationFunction:n,ribbonCloseArray:s,ribbonClosePath:o,cap:0===u?0:u||a.a.NO_CAP,sideOrientation:l,instance:d,updatable:c};return f.ExtrudeShapeCustom(t,p,h)},a.a.CreateLathe=function(t,e,r,i,n,s,a){var o={shape:e,radius:r,tessellation:i,sideOrientation:a,updatable:s};return f.CreateLathe(t,o,n)},a.a.CreatePlane=function(t,e,r,i,n){var s={size:e,width:e,height:e,sideOrientation:n,updatable:i};return f.CreatePlane(t,s,r)},a.a.CreateGround=function(t,e,r,i,n,s){var a={width:e,height:r,subdivisions:i,updatable:s};return f.CreateGround(t,a,n)},a.a.CreateTiledGround=function(t,e,r,i,n,s,a,o,u){var h={xmin:e,zmin:r,xmax:i,zmax:n,subdivisions:s,precision:a,updatable:u};return f.CreateTiledGround(t,h,o)},a.a.CreateGroundFromHeightMap=function(t,e,r,i,n,s,a,o,u,h,c){var l={width:r,height:i,subdivisions:n,minHeight:s,maxHeight:a,updatable:u,onReady:h,alphaFilter:c};return f.CreateGroundFromHeightMap(t,e,l,o)},a.a.CreateTube=function(t,e,r,i,n,s,a,o,u,h){var c={path:e,radius:r,tessellation:i,radiusFunction:n,arc:1,cap:s,updatable:o,sideOrientation:u,instance:h};return f.CreateTube(t,c,a)},a.a.CreatePolyhedron=function(t,e,r){return f.CreatePolyhedron(t,e,r)},a.a.CreateIcoSphere=function(t,e,r){return f.CreateIcoSphere(t,e,r)},a.a.CreateDecal=function(t,e,r,i,n,s){var a={position:r,normal:i,size:n,angle:s};return f.CreateDecal(t,e,a)};var f=function(){function t(){}return t._UpdateSideOrientation=function(t){return t==a.a.DOUBLESIDE?a.a.DOUBLESIDE:null==t?a.a.FRONTSIDE:t},t.CreateBox=function(e,r,i){void 0===i&&(i=null);var n=new a.a(e,i);return r.sideOrientation=t._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.a.CreateBox(r).applyToMesh(n,r.updatable),n},t.CreateSphere=function(e,r,i){var n=new a.a(e,i);return r.sideOrientation=t._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.a.CreateSphere(r).applyToMesh(n,r.updatable),n},t.CreateDisc=function(e,r,i){void 0===i&&(i=null);var n=new a.a(e,i);return r.sideOrientation=t._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.a.CreateDisc(r).applyToMesh(n,r.updatable),n},t.CreateIcoSphere=function(e,r,i){var n=new a.a(e,i);return r.sideOrientation=t._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.a.CreateIcoSphere(r).applyToMesh(n,r.updatable),n},t.CreateRibbon=function(e,r,i){void 0===i&&(i=null);var n=r.pathArray,u=r.closeArray,c=r.closePath,l=t._UpdateSideOrientation(r.sideOrientation),f=r.instance,p=r.updatable;if(f){var g=s.Tmp.Vector3[0].setAll(Number.MAX_VALUE),m=s.Tmp.Vector3[1].setAll(-Number.MAX_VALUE),v=f.getVerticesData(o.b.PositionKind);if(function(t){for(var e=n[0].length,r=f,i=0,s=r._originalBuilderSideOrientation===a.a.DOUBLESIDE?2:1,o=1;o<=s;++o)for(var u=0;u<n.length;++u){var h=n[u],c=h.length;e=e<c?e:c;for(var l=0;l<e;++l){var d=h[l];t[i]=d.x,t[i+1]=d.y,t[i+2]=d.z,g.minimizeInPlaceFromFloats(d.x,d.y,d.z),m.maximizeInPlaceFromFloats(d.x,d.y,d.z),i+=3}r._creationDataStorage&&r._creationDataStorage.closePath&&(d=h[0],t[i]=d.x,t[i+1]=d.y,t[i+2]=d.z,i+=3)}}(v),f._boundingInfo?f._boundingInfo.reConstruct(g,m,f._worldMatrix):f._boundingInfo=new d.a(g,m,f._worldMatrix),f.updateVerticesData(o.b.PositionKind,v,!1,!1),r.colors){for(var y=f.getVerticesData(o.b.ColorKind),b=0,_=0;b<r.colors.length;b++,_+=4){var x=r.colors[b];y[_]=x.r,y[_+1]=x.g,y[_+2]=x.b,y[_+3]=x.a}f.updateVerticesData(o.b.ColorKind,y,!1,!1)}if(r.uvs){for(var M=f.getVerticesData(o.b.UVKind),T=0;T<r.uvs.length;T++)M[2*T]=r.uvs[T].x,M[2*T+1]=r.uvs[T].y;f.updateVerticesData(o.b.UVKind,M,!1,!1)}if(!f.areNormalsFrozen||f.isFacetDataEnabled){var A=f.getIndices(),D=f.getVerticesData(o.b.NormalKind),I=f.isFacetDataEnabled?f.getFacetDataParameters():null;if(h.a.ComputeNormals(v,A,D,I),f._creationDataStorage&&f._creationDataStorage.closePath)for(var V=0,w=0,E=0;E<n.length;E++)V=3*f._creationDataStorage.idx[E],w=E+1<n.length?3*(f._creationDataStorage.idx[E+1]-1):D.length-3,D[V]=.5*(D[V]+D[w]),D[V+1]=.5*(D[V+1]+D[w+1]),D[V+2]=.5*(D[V+2]+D[w+2]),D[w]=D[V],D[w+1]=D[V+1],D[w+2]=D[V+2];f.areNormalsFrozen||f.updateVerticesData(o.b.NormalKind,D,!1,!1)}return f}var S=new a.a(e,i);S._originalBuilderSideOrientation=l,S._creationDataStorage=new a.c;var C=h.a.CreateRibbon(r);return c&&(S._creationDataStorage.idx=C._idx),S._creationDataStorage.closePath=c,S._creationDataStorage.closeArray=u,C.applyToMesh(S,p),S},t.CreateCylinder=function(e,r,i){var n=new a.a(e,i);return r.sideOrientation=t._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.a.CreateCylinder(r).applyToMesh(n,r.updatable),n},t.CreateTorus=function(e,r,i){var n=new a.a(e,i);return r.sideOrientation=t._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.a.CreateTorus(r).applyToMesh(n,r.updatable),n},t.CreateTorusKnot=function(e,r,i){var n=new a.a(e,i);return r.sideOrientation=t._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.a.CreateTorusKnot(r).applyToMesh(n,r.updatable),n},t.CreateLineSystem=function(t,e,r){var i=e.instance,n=e.lines,s=e.colors;if(i){var a,c,l=i.getVerticesData(o.b.PositionKind);s&&(a=i.getVerticesData(o.b.ColorKind));for(var d=0,f=0,p=0;p<n.length;p++)for(var g=n[p],m=0;m<g.length;m++)l[d]=g[m].x,l[d+1]=g[m].y,l[d+2]=g[m].z,s&&a&&(c=s[p],a[f]=c[m].r,a[f+1]=c[m].g,a[f+2]=c[m].b,a[f+3]=c[m].a,f+=4),d+=3;return i.updateVerticesData(o.b.PositionKind,l,!1,!1),s&&a&&i.updateVerticesData(o.b.ColorKind,a,!1,!1),i}var v=!!s,y=new u.b(t,r,null,void 0,void 0,v,e.useVertexAlpha);return h.a.CreateLineSystem(e).applyToMesh(y,e.updatable),y},t.CreateLines=function(e,r,i){void 0===i&&(i=null);var n=r.colors?[r.colors]:null;return t.CreateLineSystem(e,{lines:[r.points],updatable:r.updatable,instance:r.instance,colors:n,useVertexAlpha:r.useVertexAlpha},i)},t.CreateDashedLines=function(t,e,r){void 0===r&&(r=null);var i=e.points,n=e.instance,o=e.gapSize||1,c=e.dashSize||3;if(n){return n.updateMeshPositions(function(t){var e,r,a=s.Vector3.Zero(),o=t.length/6,u=0,h=0,c=0,l=0,d=0,f=0;for(d=0;d<i.length-1;d++)i[d+1].subtractToRef(i[d],a),u+=a.length();e=u/o;var p=n._creationDataStorage.dashSize;for(r=p*e/(p+n._creationDataStorage.gapSize),d=0;d<i.length-1;d++)for(i[d+1].subtractToRef(i[d],a),h=Math.floor(a.length()/e),a.normalize(),f=0;f<h&&l<t.length;)c=e*f,t[l]=i[d].x+c*a.x,t[l+1]=i[d].y+c*a.y,t[l+2]=i[d].z+c*a.z,t[l+3]=i[d].x+(c+r)*a.x,t[l+4]=i[d].y+(c+r)*a.y,t[l+5]=i[d].z+(c+r)*a.z,l+=6,f++;for(;l<t.length;)t[l]=i[d].x,t[l+1]=i[d].y,t[l+2]=i[d].z,l+=3},!1),n}var l=new u.b(t,r);return h.a.CreateDashedLines(e).applyToMesh(l,e.updatable),l._creationDataStorage=new a.c,l._creationDataStorage.dashSize=c,l._creationDataStorage.gapSize=o,l},t.ExtrudeShape=function(e,r,i){void 0===i&&(i=null);var n=r.path,s=r.shape,o=r.scale||1,u=r.rotation||0,h=0===r.cap?0:r.cap||a.a.NO_CAP,c=r.updatable,l=t._UpdateSideOrientation(r.sideOrientation),d=r.instance||null,f=r.invertUV||!1;return t._ExtrudeShapeGeneric(e,s,n,o,u,null,null,!1,!1,h,!1,i,!!c,l,d,f,r.frontUVs||null,r.backUVs||null)},t.ExtrudeShapeCustom=function(e,r,i){var n=r.path,s=r.shape,o=r.scaleFunction||function(){return 1},u=r.rotationFunction||function(){return 0},h=r.ribbonCloseArray||!1,c=r.ribbonClosePath||!1,l=0===r.cap?0:r.cap||a.a.NO_CAP,d=r.updatable,f=t._UpdateSideOrientation(r.sideOrientation),p=r.instance,g=r.invertUV||!1;return t._ExtrudeShapeGeneric(e,s,n,null,null,o,u,h,c,l,!0,i,!!d,f,p||null,g,r.frontUVs||null,r.backUVs||null)},t.CreateLathe=function(e,r,i){var n,o=r.arc?r.arc<=0||r.arc>1?1:r.arc:1,u=void 0===r.closed||r.closed,h=r.shape,c=r.radius||1,l=r.tessellation||64,d=r.clip||0,f=r.updatable,p=t._UpdateSideOrientation(r.sideOrientation),g=r.cap||a.a.NO_CAP,m=2*Math.PI,v=new Array,y=r.invertUV||!1,b=0,_=0,x=m/l*o,M=new Array;for(b=0;b<=l-d;b++){M=[];for(g!=a.a.CAP_START&&g!=a.a.CAP_ALL||(M.push(new s.Vector3(0,h[0].y,0)),M.push(new s.Vector3(Math.cos(b*x)*h[0].x*c,h[0].y,Math.sin(b*x)*h[0].x*c))),_=0;_<h.length;_++)n=new s.Vector3(Math.cos(b*x)*h[_].x*c,h[_].y,Math.sin(b*x)*h[_].x*c),M.push(n);g!=a.a.CAP_END&&g!=a.a.CAP_ALL||(M.push(new s.Vector3(Math.cos(b*x)*h[h.length-1].x*c,h[h.length-1].y,Math.sin(b*x)*h[h.length-1].x*c)),M.push(new s.Vector3(0,h[h.length-1].y,0))),v.push(M)}return t.CreateRibbon(e,{pathArray:v,closeArray:u,sideOrientation:p,updatable:f,invertUV:y,frontUVs:r.frontUVs,backUVs:r.backUVs},i)},t.CreatePlane=function(e,r,i){var n=new a.a(e,i);return r.sideOrientation=t._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.a.CreatePlane(r).applyToMesh(n,r.updatable),r.sourcePlane&&(n.translate(r.sourcePlane.normal,-r.sourcePlane.d),n.setDirection(r.sourcePlane.normal.scale(-1))),n},t.CreateGround=function(t,e,r){var i=new c.a(t,r);return i._setReady(!1),i._subdivisionsX=e.subdivisionsX||e.subdivisions||1,i._subdivisionsY=e.subdivisionsY||e.subdivisions||1,i._width=e.width||1,i._height=e.height||1,i._maxX=i._width/2,i._maxZ=i._height/2,i._minX=-i._maxX,i._minZ=-i._maxZ,h.a.CreateGround(e).applyToMesh(i,e.updatable),i._setReady(!0),i},t.CreateTiledGround=function(t,e,r){var i=new a.a(t,r);return h.a.CreateTiledGround(e).applyToMesh(i,e.updatable),i},t.CreateGroundFromHeightMap=function(t,e,r,n){var a=r.width||10,o=r.height||10,u=r.subdivisions||1,l=r.minHeight||0,d=r.maxHeight||1,f=r.colorFilter||new s.Color3(.3,.59,.11),p=r.alphaFilter||0,g=r.updatable,m=r.onReady,v=new c.a(t,n);v._subdivisionsX=u,v._subdivisionsY=u,v._width=a,v._height=o,v._maxX=v._width/2,v._maxZ=v._height/2,v._minX=-v._maxX,v._minZ=-v._maxZ,v._setReady(!1);return i.h.LoadImage(e,function(t){var e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!n.isDisposed){var i=t.width,s=t.height;e.width=i,e.height=s,r.drawImage(t,0,0);var c=r.getImageData(0,0,i,s).data;h.a.CreateGroundFromHeightMap({width:a,height:o,subdivisions:u,minHeight:l,maxHeight:d,colorFilter:f,buffer:c,bufferWidth:i,bufferHeight:s,alphaFilter:p}).applyToMesh(v,g),m&&m(v),v._setReady(!0)}},function(){},n.offlineProvider),v},t.CreatePolygon=function(e,r,i){r.sideOrientation=t._UpdateSideOrientation(r.sideOrientation);for(var n=r.shape,a=r.holes||[],o=r.depth||0,u=[],c=[],d=0;d<n.length;d++)u[d]=new s.Vector2(n[d].x,n[d].z);u[0].equalsWithEpsilon(u[u.length-1],1e-8)&&u.pop();for(var f=new l.b(e,u,i),p=0;p<a.length;p++){c=[];for(var g=0;g<a[p].length;g++)c.push(new s.Vector2(a[p][g].x,a[p][g].z));f.addHole(c)}var m=f.build(r.updatable,o);return m._originalBuilderSideOrientation=r.sideOrientation,h.a.CreatePolygon(m,r.sideOrientation,r.faceUV,r.faceColors,r.frontUVs,r.backUVs).applyToMesh(m,r.updatable),m},t.ExtrudePolygon=function(e,r,i){return t.CreatePolygon(e,r,i)},t.CreateTube=function(e,r,i){var n=r.path,o=r.instance,u=1;void 0!==r.radius?u=r.radius:o&&(u=o._creationDataStorage.radius);var h=r.tessellation||64,c=r.radiusFunction||null,l=r.cap||a.a.NO_CAP,d=r.invertUV||!1,f=r.updatable,p=t._UpdateSideOrientation(r.sideOrientation);r.arc=r.arc&&(r.arc<=0||r.arc>1)?1:r.arc||1;var g,m,v=function(t,e,r,i,n,o,u,h){for(var c,l,d,f,p=e.getTangents(),g=e.getNormals(),m=e.getDistances(),v=2*Math.PI/n*h,y=o||function(){return i},b=s.Tmp.Matrix[0],_=u===a.a.NO_CAP||u===a.a.CAP_END?0:2,x=0;x<t.length;x++){l=y(x,m[x]),c=Array(),d=g[x];for(var M=0;M<n;M++)s.Matrix.RotationAxisToRef(p[x],v*M,b),f=c[M]?c[M]:s.Vector3.Zero(),s.Vector3.TransformCoordinatesToRef(d,b,f),f.scaleInPlace(l).addInPlace(t[x]),c[M]=f;r[_]=c,_++}var T=function(e,r){for(var i=Array(),n=0;n<e;n++)i.push(t[r]);return i};switch(u){case a.a.NO_CAP:break;case a.a.CAP_START:r[0]=T(n,0),r[1]=r[2].slice(0);break;case a.a.CAP_END:r[_]=r[_-1].slice(0),r[_+1]=T(n,t.length-1);break;case a.a.CAP_ALL:r[0]=T(n,0),r[1]=r[2].slice(0),r[_]=r[_-1].slice(0),r[_+1]=T(n,t.length-1)}return r};if(o){var y=o._creationDataStorage,b=r.arc||y.arc;return m=v(n,g=y.path3D.update(n),y.pathArray,u,y.tessellation,c,y.cap,b),o=t.CreateRibbon("",{pathArray:m,instance:o}),y.path3D=g,y.pathArray=m,y.arc=b,y.radius=u,o}m=v(n,g=new s.Path3D(n),new Array,u,h,c,l=l<0||l>3?0:l,r.arc);var _=t.CreateRibbon(e,{pathArray:m,closePath:!0,closeArray:!1,updatable:f,sideOrientation:p,invertUV:d,frontUVs:r.frontUVs,backUVs:r.backUVs},i);return _._creationDataStorage.pathArray=m,_._creationDataStorage.path3D=g,_._creationDataStorage.tessellation=h,_._creationDataStorage.cap=l,_._creationDataStorage.arc=r.arc,_._creationDataStorage.radius=u,_},t.CreatePolyhedron=function(e,r,i){var n=new a.a(e,i);return r.sideOrientation=t._UpdateSideOrientation(r.sideOrientation),n._originalBuilderSideOrientation=r.sideOrientation,h.a.CreatePolyhedron(r).applyToMesh(n,r.updatable),n},t.CreateDecal=function(t,e,r){var i=e.getIndices(),n=e.getVerticesData(o.b.PositionKind),u=e.getVerticesData(o.b.NormalKind),c=r.position||s.Vector3.Zero(),l=r.normal||s.Vector3.Up(),d=r.size||s.Vector3.One(),f=r.angle||0;if(!l){var p=new s.Vector3(0,0,1),g=e.getScene().activeCamera,m=s.Vector3.TransformCoordinates(p,g.getWorldMatrix());l=g.globalPosition.subtract(m)}var v=-Math.atan2(l.z,l.x)-Math.PI/2,y=Math.sqrt(l.x*l.x+l.z*l.z),b=Math.atan2(l.y,y),_=s.Matrix.RotationYawPitchRoll(v,b,f).multiply(s.Matrix.Translation(c.x,c.y,c.z)),x=s.Matrix.Invert(_),M=e.getWorldMatrix().multiply(x),T=new h.a;T.indices=[],T.positions=[],T.normals=[],T.uvs=[];for(var A=0,D=function(t){var e=new s.PositionNormalVertex;if(!i||!n||!u)return e;var r=i[t];return e.position=new s.Vector3(n[3*r],n[3*r+1],n[3*r+2]),e.position=s.Vector3.TransformCoordinates(e.position,M),e.normal=new s.Vector3(u[3*r],u[3*r+1],u[3*r+2]),e.normal=s.Vector3.TransformNormal(e.normal,M),e},I=function(t,e){if(0===t.length)return t;for(var r=.5*Math.abs(s.Vector3.Dot(d,e)),i=function(t,i){var n=s.Vector3.GetClipFactor(t.position,i.position,e,r);return new s.PositionNormalVertex(s.Vector3.Lerp(t.position,i.position,n),s.Vector3.Lerp(t.normal,i.normal,n))},n=new Array,a=0;a<t.length;a+=3){var o,u,h,c=null,l=null,f=null,p=null;switch(((o=s.Vector3.Dot(t[a].position,e)-r>0)?1:0)+((u=s.Vector3.Dot(t[a+1].position,e)-r>0)?1:0)+((h=s.Vector3.Dot(t[a+2].position,e)-r>0)?1:0)){case 0:n.push(t[a]),n.push(t[a+1]),n.push(t[a+2]);break;case 1:if(o&&(c=t[a+1],l=t[a+2],f=i(t[a],c),p=i(t[a],l)),u){c=t[a],l=t[a+2],f=i(t[a+1],c),p=i(t[a+1],l),n.push(f),n.push(l.clone()),n.push(c.clone()),n.push(l.clone()),n.push(f.clone()),n.push(p);break}h&&(c=t[a],l=t[a+1],f=i(t[a+2],c),p=i(t[a+2],l)),c&&l&&f&&p&&(n.push(c.clone()),n.push(l.clone()),n.push(f),n.push(p),n.push(f.clone()),n.push(l.clone()));break;case 2:o||(l=i(c=t[a].clone(),t[a+1]),f=i(c,t[a+2]),n.push(c),n.push(l),n.push(f)),u||(l=i(c=t[a+1].clone(),t[a+2]),f=i(c,t[a]),n.push(c),n.push(l),n.push(f)),h||(l=i(c=t[a+2].clone(),t[a]),f=i(c,t[a+1]),n.push(c),n.push(l),n.push(f))}}return n},V=0;V<i.length;V+=3){var w=new Array;if(w.push(D(V)),w.push(D(V+1)),w.push(D(V+2)),w=I(w,new s.Vector3(1,0,0)),w=I(w,new s.Vector3(-1,0,0)),w=I(w,new s.Vector3(0,1,0)),w=I(w,new s.Vector3(0,-1,0)),w=I(w,new s.Vector3(0,0,1)),0!==(w=I(w,new s.Vector3(0,0,-1))).length)for(var E=0;E<w.length;E++){var S=w[E];T.indices.push(A),S.position.toArray(T.positions,3*A),S.normal.toArray(T.normals,3*A),T.uvs.push(.5+S.position.x/d.x),T.uvs.push(.5+S.position.y/d.y),A++}}var C=new a.a(t,e.getScene());return T.applyToMesh(C),C.position=c.clone(),C.rotation=new s.Vector3(b,v,f),C},t._ExtrudeShapeGeneric=function(e,r,i,n,o,u,h,c,l,d,f,p,g,m,v,y,b,_){var x,M,T=function(t,e,r,i,n,o,u,h,c,l){for(var d=r.getTangents(),f=r.getNormals(),p=r.getBinormals(),g=r.getDistances(),m=0,v=l&&h?h:function(){return null!==o?o:0},y=l&&u?u:function(){return null!==n?n:1},b=c===a.a.NO_CAP||c===a.a.CAP_END?0:2,_=s.Tmp.Matrix[0],x=0;x<e.length;x++){for(var M=new Array,T=v(x,g[x]),A=y(x,g[x]),D=0;D<t.length;D++){s.Matrix.RotationAxisToRef(d[x],m,_);var I=d[x].scale(t[D].z).add(f[x].scale(t[D].x)).add(p[x].scale(t[D].y)),V=M[D]?M[D]:s.Vector3.Zero();s.Vector3.TransformCoordinatesToRef(I,_,V),V.scaleInPlace(A).addInPlace(e[x]),M[D]=V}i[b]=M,m+=T,b++}var w=function(t){var e,r=Array(),i=s.Vector3.Zero();for(e=0;e<t.length;e++)i.addInPlace(t[e]);for(i.scaleInPlace(1/t.length),e=0;e<t.length;e++)r.push(i);return r};switch(c){case a.a.NO_CAP:break;case a.a.CAP_START:i[0]=w(i[2]),i[1]=i[2];break;case a.a.CAP_END:i[b]=i[b-1],i[b+1]=w(i[b-1]);break;case a.a.CAP_ALL:i[0]=w(i[2]),i[1]=i[2],i[b]=i[b-1],i[b+1]=w(i[b-1])}return i};if(v){var A=v._creationDataStorage;return x=A.path3D.update(i),M=T(r,i,A.path3D,A.pathArray,n,o,u,h,A.cap,f),v=a.a.CreateRibbon("",M,!1,!1,0,p||void 0,!1,0,v)}M=T(r,i,x=new s.Path3D(i),new Array,n,o,u,h,d=d<0||d>3?0:d,f);var D=t.CreateRibbon(e,{pathArray:M,closeArray:c,closePath:l,updatable:g,sideOrientation:m,invertUV:y,frontUVs:b||void 0,backUVs:_||void 0},p);return D._creationDataStorage.pathArray=M,D._creationDataStorage.path3D=x,D._creationDataStorage.cap=d,D},t}()},3:function(t,e,r){"use strict";r.d(e,"a",function(){return i}),r.d(e,"b",function(){return n});var i=function(){function t(t,e,r,i,n,s,a){void 0===i&&(i=0),void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===a&&(a=!1),t.getScene?this._engine=t.getScene().getEngine():this._engine=t,this._updatable=r,this._instanced=s,this._data=e,this.byteStride=a?i:i*Float32Array.BYTES_PER_ELEMENT,n||this.create()}return t.prototype.createVertexBuffer=function(t,e,r,i,s,a){void 0===a&&(a=!1);var o=a?e:e*Float32Array.BYTES_PER_ELEMENT,u=i?a?i:i*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new n(this._engine,this,t,this._updatable,!0,u,void 0===s?this._instanced:s,o,r,void 0,void 0,!0)},t.prototype.isUpdatable=function(){return this._updatable},t.prototype.getData=function(){return this._data},t.prototype.getBuffer=function(){return this._buffer},t.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},t.prototype.create=function(t){void 0===t&&(t=null),!t&&this._buffer||(t=t||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t),this._data=t):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(t),this._data=t):this._buffer=this._engine.createVertexBuffer(t))},t.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},t.prototype.update=function(t){this.create(t)},t.prototype.updateDirectly=function(t,e,r,i){void 0===i&&(i=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t,i?e:e*Float32Array.BYTES_PER_ELEMENT,r?r*this.byteStride:void 0),this._data=null)},t.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},t}(),n=function(){function t(e,r,n,s,a,o,u,h,c,l,d,f){if(void 0===d&&(d=!1),void 0===f&&(f=!1),r instanceof i?(this._buffer=r,this._ownsBuffer=!1):(this._buffer=new i(e,r,s,o,a,u,f),this._ownsBuffer=!0),this._kind=n,null==l){var p=this.getData();this.type=t.FLOAT,p instanceof Int8Array?this.type=t.BYTE:p instanceof Uint8Array?this.type=t.UNSIGNED_BYTE:p instanceof Int16Array?this.type=t.SHORT:p instanceof Uint16Array?this.type=t.UNSIGNED_SHORT:p instanceof Int32Array?this.type=t.INT:p instanceof Uint32Array&&(this.type=t.UNSIGNED_INT)}else this.type=l;var g=t.GetTypeByteLength(this.type);f?(this._size=c||(o?o/g:t.DeduceStride(n)),this.byteStride=o||this._buffer.byteStride||this._size*g,this.byteOffset=h||0):(this._size=c||o||t.DeduceStride(n),this.byteStride=o?o*g:this._buffer.byteStride||this._size*g,this.byteOffset=(h||0)*g),this.normalized=d,this._instanced=void 0!==u&&u,this._instanceDivisor=u?1:0}return Object.defineProperty(t.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(t){this._instanceDivisor=t,this._instanced=0!=t},enumerable:!0,configurable:!0}),t.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},t.prototype.getKind=function(){return this._kind},t.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},t.prototype.getData=function(){return this._buffer.getData()},t.prototype.getBuffer=function(){return this._buffer.getBuffer()},t.prototype.getStrideSize=function(){return this.byteStride/t.GetTypeByteLength(this.type)},t.prototype.getOffset=function(){return this.byteOffset/t.GetTypeByteLength(this.type)},t.prototype.getSize=function(){return this._size},t.prototype.getIsInstanced=function(){return this._instanced},t.prototype.getInstanceDivisor=function(){return this._instanceDivisor},t.prototype.create=function(t){this._buffer.create(t)},t.prototype.update=function(t){this._buffer.update(t)},t.prototype.updateDirectly=function(t,e,r){void 0===r&&(r=!1),this._buffer.updateDirectly(t,e,void 0,r)},t.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},t.prototype.forEach=function(e,r){t.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,r)},t.DeduceStride=function(e){switch(e){case t.UVKind:case t.UV2Kind:case t.UV3Kind:case t.UV4Kind:case t.UV5Kind:case t.UV6Kind:return 2;case t.NormalKind:case t.PositionKind:return 3;case t.ColorKind:case t.MatricesIndicesKind:case t.MatricesIndicesExtraKind:case t.MatricesWeightsKind:case t.MatricesWeightsExtraKind:case t.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}},t.GetTypeByteLength=function(e){switch(e){case t.BYTE:case t.UNSIGNED_BYTE:return 1;case t.SHORT:case t.UNSIGNED_SHORT:return 2;case t.INT:case t.FLOAT:return 4;default:throw new Error("Invalid type '"+e+"'")}},t.ForEach=function(e,r,i,n,s,a,o,u){if(e instanceof Array)for(var h=r/4,c=i/4,l=0;l<a;l+=n){for(var d=0;d<n;d++)u(e[h+d],l+d);h+=c}else{var f=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),p=t.GetTypeByteLength(s);for(l=0;l<a;l+=n){var g=r;for(d=0;d<n;d++){u(t._GetFloatValue(f,s,g,o),l+d),g+=p}r+=i}}},t._GetFloatValue=function(e,r,i,n){switch(r){case t.BYTE:var s=e.getInt8(i);return n&&(s=Math.max(s/127,-1)),s;case t.UNSIGNED_BYTE:s=e.getUint8(i);return n&&(s/=255),s;case t.SHORT:s=e.getInt16(i,!0);return n&&(s=Math.max(s/16383,-1)),s;case t.UNSIGNED_SHORT:s=e.getUint16(i,!0);return n&&(s/=65535),s;case t.FLOAT:return e.getFloat32(i,!0);default:throw new Error("Invalid component type "+r)}},t.BYTE=5120,t.UNSIGNED_BYTE=5121,t.SHORT=5122,t.UNSIGNED_SHORT=5123,t.INT=5124,t.UNSIGNED_INT=5125,t.FLOAT=5126,t.PositionKind="position",t.NormalKind="normal",t.TangentKind="tangent",t.UVKind="uv",t.UV2Kind="uv2",t.UV3Kind="uv3",t.UV4Kind="uv4",t.UV5Kind="uv5",t.UV6Kind="uv6",t.ColorKind="color",t.MatricesIndicesKind="matricesIndices",t.MatricesWeightsKind="matricesWeights",t.MatricesIndicesExtraKind="matricesIndicesExtra",t.MatricesWeightsExtraKind="matricesWeightsExtra",t}()},32:function(t,e,r){"use strict";r.d(e,"d",function(){return f}),r.d(e,"l",function(){return p}),r.d(e,"g",function(){return g}),r.d(e,"a",function(){return m}),r.d(e,"h",function(){return v}),r.d(e,"c",function(){return y}),r.d(e,"b",function(){return b}),r.d(e,"j",function(){return _}),r.d(e,"e",function(){return x}),r.d(e,"i",function(){return M}),r.d(e,"f",function(){return T}),r.d(e,"k",function(){return A});var i=r(1),n=r(0),s=r(24),a=r(3),o=r(56),u=r(66),h=r(53),c=r(4),l=r(5),d=r(27),f=function(){function t(t,e,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=null),this.delayLoadState=c.a.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this.id=t,this.uniqueId=e.getUniqueId(),this._engine=e.getEngine(),this._meshes=[],this._scene=e,this._vertexBuffers={},this._indices=[],this._updatable=i,r?this.setAllVerticesData(r,i):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),n&&(this.applyToMesh(n),n.computeWorldMatrix(!0))}return Object.defineProperty(t.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(t){this._boundingBias?this._boundingBias.copyFrom(t):this._boundingBias=t.clone(),this._updateBoundingInfo(!0,null)},enumerable:!0,configurable:!0}),t.CreateGeometryForMesh=function(e){var r=new t(t.RandomId(),e.getScene());return r.applyToMesh(e),r},Object.defineProperty(t.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._engine},t.prototype.isReady=function(){return this.delayLoadState===c.a.DELAYLOADSTATE_LOADED||this.delayLoadState===c.a.DELAYLOADSTATE_NONE},Object.defineProperty(t.prototype,"doNotSerialize",{get:function(){for(var t=0;t<this._meshes.length;t++)if(!this._meshes[t].doNotSerialize)return!1;return!0},enumerable:!0,configurable:!0}),t.prototype._rebuild=function(){for(var t in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._vertexBuffers){this._vertexBuffers[t]._rebuild()}},t.prototype.setAllVerticesData=function(t,e){t.applyToGeometry(this,e),this.notifyUpdate()},t.prototype.setVerticesData=function(t,e,r,i){void 0===r&&(r=!1);var n=new a.b(this._engine,e,t,r,0===this._meshes.length,i);this.setVerticesBuffer(n)},t.prototype.removeVerticesData=function(t){this._vertexBuffers[t]&&(this._vertexBuffers[t].dispose(),delete this._vertexBuffers[t])},t.prototype.setVerticesBuffer=function(t,e){void 0===e&&(e=null);var r=t.getKind();if(this._vertexBuffers[r]&&this._vertexBuffers[r].dispose(),this._vertexBuffers[r]=t,r===a.b.PositionKind){var i=t.getData();null!=e?this._totalVertices=e:null!=i&&(this._totalVertices=i.length/(t.byteStride/4)),this._updateExtend(i),this._resetPointsArrayCache();for(var n=this._meshes,s=n.length,o=0;o<s;o++){var u=n[o];u._boundingInfo=new h.a(this._extend.minimum,this._extend.maximum),u._createGlobalSubMesh(!1),u.computeWorldMatrix(!0)}}this.notifyUpdate(r),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},t.prototype.updateVerticesDataDirectly=function(t,e,r,i){void 0===i&&(i=!1);var n=this.getVertexBuffer(t);n&&(n.updateDirectly(e,r,i),this.notifyUpdate(t))},t.prototype.updateVerticesData=function(t,e,r){void 0===r&&(r=!1);var i=this.getVertexBuffer(t);i&&(i.update(e),t===a.b.PositionKind&&this._updateBoundingInfo(r,e),this.notifyUpdate(t))},t.prototype._updateBoundingInfo=function(t,e){if(t&&this._updateExtend(e),this._resetPointsArrayCache(),t)for(var r=0,i=this._meshes;r<i.length;r++){var n=i[r];n._boundingInfo?n._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):n._boundingInfo=new h.a(this._extend.minimum,this._extend.maximum);for(var s=0,a=n.subMeshes;s<a.length;s++){a[s].refreshBoundingInfo()}}},t.prototype._bind=function(t,e){if(t){void 0===e&&(e=this._indexBuffer);var r=this.getVertexBuffers();r&&(e==this._indexBuffer&&this._vertexArrayObjects?(this._vertexArrayObjects[t.key]||(this._vertexArrayObjects[t.key]=this._engine.recordVertexArrayObject(r,e,t)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[t.key],e)):this._engine.bindBuffers(r,e,t))}},t.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},t.prototype.getVerticesData=function(t,e,r){var i=this.getVertexBuffer(t);if(!i)return null;var n=i.getData();if(!n)return null;var s=i.getSize()*a.b.GetTypeByteLength(i.type),o=this._totalVertices*i.getSize();if(i.type!==a.b.FLOAT||i.byteStride!==s){var u=[];return i.forEach(o,function(t){return u.push(t)}),u}if(!(n instanceof Array||n instanceof Float32Array)||0!==i.byteOffset||n.length!==o){if(n instanceof Array){var h=i.byteOffset/4;return l.h.Slice(n,h,h+o)}if(n instanceof ArrayBuffer)return new Float32Array(n,i.byteOffset,o);h=n.byteOffset+i.byteOffset;if(r||e&&1!==this._meshes.length){var c=new Float32Array(o),d=new Float32Array(n.buffer,h,o);return c.set(d),c}return new Float32Array(n.buffer,h,o)}return r||e&&1!==this._meshes.length?l.h.Slice(n):n},t.prototype.isVertexBufferUpdatable=function(t){var e=this._vertexBuffers[t];return!!e&&e.isUpdatable()},t.prototype.getVertexBuffer=function(t){return this.isReady()?this._vertexBuffers[t]:null},t.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},t.prototype.isVerticesDataPresent=function(t){return this._vertexBuffers?void 0!==this._vertexBuffers[t]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(t)},t.prototype.getVerticesDataKinds=function(){var t,e=[];if(!this._vertexBuffers&&this._delayInfo)for(t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e},t.prototype.updateIndices=function(t,e){if(this._indexBuffer)if(this._indexBufferIsUpdatable){var r=t.length!==this._indices.length;if(this._indices=t,this._engine.updateDynamicIndexBuffer(this._indexBuffer,t,e),r)for(var i=0,n=this._meshes;i<n.length;i++){n[i]._createGlobalSubMesh(!0)}}else this.setIndices(t,null,!0)},t.prototype.setIndices=function(t,e,r){void 0===e&&(e=null),void 0===r&&(r=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=t,this._indexBufferIsUpdatable=r,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,r)),null!=e&&(this._totalVertices=e);for(var i=0,n=this._meshes;i<n.length;i++){n[i]._createGlobalSubMesh(!0)}this.notifyUpdate()},t.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},t.prototype.getIndices=function(t,e){if(!this.isReady())return null;var r=this._indices;if(e||t&&1!==this._meshes.length){for(var i=r.length,n=[],s=0;s<i;s++)n.push(r[s]);return n}return r},t.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},t.prototype._releaseVertexArrayObject=function(t){void 0===t&&(t=null),t&&this._vertexArrayObjects&&this._vertexArrayObjects[t.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[t.key]),delete this._vertexArrayObjects[t.key])},t.prototype.releaseForMesh=function(t,e){var r=this._meshes,i=r.indexOf(t);-1!==i&&(r.splice(i,1),t._geometry=null,0===r.length&&e&&this.dispose())},t.prototype.applyToMesh=function(t){if(t._geometry!==this){var e=t._geometry;e&&e.releaseForMesh(t);var r=this._meshes;t._geometry=this,this._scene.pushGeometry(this),r.push(t),this.isReady()?this._applyToMesh(t):t._boundingInfo=this._boundingInfo}},t.prototype._updateExtend=function(t){void 0===t&&(t=null),t||(t=this.getVerticesData(a.b.PositionKind)),this._extend=l.h.ExtractMinAndMax(t,0,this._totalVertices,this.boundingBias,3)},t.prototype._applyToMesh=function(t){var e=this._meshes.length;for(var r in this._vertexBuffers){1===e&&this._vertexBuffers[r].create();var i=this._vertexBuffers[r].getBuffer();i&&(i.references=e),r===a.b.PositionKind&&(this._extend||this._updateExtend(),t._boundingInfo=new h.a(this._extend.minimum,this._extend.maximum),t._createGlobalSubMesh(!1),t._updateBoundingInfo())}1===e&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=e),t._syncGeometryWithMorphTargetManager(),t.synchronizeInstances()},t.prototype.notifyUpdate=function(t){this.onGeometryUpdated&&this.onGeometryUpdated(this,t);for(var e=0,r=this._meshes;e<r.length;e++){r[e]._markSubMeshesAsAttributesDirty()}},t.prototype.load=function(t,e){this.delayLoadState!==c.a.DELAYLOADSTATE_LOADING&&(this.isReady()?e&&e():(this.delayLoadState=c.a.DELAYLOADSTATE_LOADING,this._queueLoad(t,e)))},t.prototype._queueLoad=function(t,e){var r=this;this.delayLoadingFile&&(t._addPendingData(this),t._loadFile(this.delayLoadingFile,function(i){if(r._delayLoadingFunction){r._delayLoadingFunction(JSON.parse(i),r),r.delayLoadState=c.a.DELAYLOADSTATE_LOADED,r._delayInfo=[],t._removePendingData(r);for(var n=r._meshes,s=n.length,a=0;a<s;a++)r._applyToMesh(n[a]);e&&e()}},void 0,!0))},t.prototype.toLeftHanded=function(){var t=this.getIndices(!1);if(null!=t&&t.length>0){for(var e=0;e<t.length;e+=3){var r=t[e+0];t[e+0]=t[e+2],t[e+2]=r}this.setIndices(t)}var i=this.getVerticesData(a.b.PositionKind,!1);if(null!=i&&i.length>0){for(e=0;e<i.length;e+=3)i[e+2]=-i[e+2];this.setVerticesData(a.b.PositionKind,i,!1)}var n=this.getVerticesData(a.b.NormalKind,!1);if(null!=n&&n.length>0){for(e=0;e<n.length;e+=3)n[e+2]=-n[e+2];this.setVerticesData(a.b.NormalKind,n,!1)}},t.prototype._resetPointsArrayCache=function(){this._positions=null},t.prototype._generatePointsArray=function(){if(this._positions)return!0;var t=this.getVerticesData(a.b.PositionKind);if(!t||0===t.length)return!1;this._positions=[];for(var e=0;e<t.length;e+=3)this._positions.push(n.Vector3.FromArray(t,e));return!0},t.prototype.isDisposed=function(){return this._isDisposed},t.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var t in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[t]);this._vertexArrayObjects={}}},t.prototype.dispose=function(){var t,e=this._meshes,r=e.length;for(t=0;t<r;t++)this.releaseForMesh(e[t]);for(var i in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[i].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=c.a.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},t.prototype.copy=function(e){var r=new s.a;r.indices=[];var i=this.getIndices();if(i)for(var n=0;n<i.length;n++)r.indices.push(i[n]);var a,o=!1,u=!1;for(a in this._vertexBuffers){var c=this.getVerticesData(a);if(c&&(c instanceof Float32Array?r.set(new Float32Array(c),a):r.set(c.slice(0),a),!u)){var l=this.getVertexBuffer(a);l&&(u=!(o=l.isUpdatable()))}}var d=new t(e,this._scene,r,o);for(a in d.delayLoadState=this.delayLoadState,d.delayLoadingFile=this.delayLoadingFile,d._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)d._delayInfo=d._delayInfo||[],d._delayInfo.push(a);return d._boundingInfo=new h.a(this._extend.minimum,this._extend.maximum),d},t.prototype.serialize=function(){var t={};return t.id=this.id,t.updatable=this._updatable,d.a&&d.a.HasTags(this)&&(t.tags=d.a.GetTags(this)),t},t.prototype.toNumberArray=function(t){return Array.isArray(t)?t:Array.prototype.slice.call(t)},t.prototype.serializeVerticeData=function(){var t=this.serialize();return this.isVerticesDataPresent(a.b.PositionKind)&&(t.positions=this.toNumberArray(this.getVerticesData(a.b.PositionKind)),this.isVertexBufferUpdatable(a.b.PositionKind)&&(t.positions._updatable=!0)),this.isVerticesDataPresent(a.b.NormalKind)&&(t.normals=this.toNumberArray(this.getVerticesData(a.b.NormalKind)),this.isVertexBufferUpdatable(a.b.NormalKind)&&(t.normals._updatable=!0)),this.isVerticesDataPresent(a.b.TangentKind)&&(t.tangets=this.toNumberArray(this.getVerticesData(a.b.TangentKind)),this.isVertexBufferUpdatable(a.b.TangentKind)&&(t.tangets._updatable=!0)),this.isVerticesDataPresent(a.b.UVKind)&&(t.uvs=this.toNumberArray(this.getVerticesData(a.b.UVKind)),this.isVertexBufferUpdatable(a.b.UVKind)&&(t.uvs._updatable=!0)),this.isVerticesDataPresent(a.b.UV2Kind)&&(t.uv2s=this.toNumberArray(this.getVerticesData(a.b.UV2Kind)),this.isVertexBufferUpdatable(a.b.UV2Kind)&&(t.uv2s._updatable=!0)),this.isVerticesDataPresent(a.b.UV3Kind)&&(t.uv3s=this.toNumberArray(this.getVerticesData(a.b.UV3Kind)),this.isVertexBufferUpdatable(a.b.UV3Kind)&&(t.uv3s._updatable=!0)),this.isVerticesDataPresent(a.b.UV4Kind)&&(t.uv4s=this.toNumberArray(this.getVerticesData(a.b.UV4Kind)),this.isVertexBufferUpdatable(a.b.UV4Kind)&&(t.uv4s._updatable=!0)),this.isVerticesDataPresent(a.b.UV5Kind)&&(t.uv5s=this.toNumberArray(this.getVerticesData(a.b.UV5Kind)),this.isVertexBufferUpdatable(a.b.UV5Kind)&&(t.uv5s._updatable=!0)),this.isVerticesDataPresent(a.b.UV6Kind)&&(t.uv6s=this.toNumberArray(this.getVerticesData(a.b.UV6Kind)),this.isVertexBufferUpdatable(a.b.UV6Kind)&&(t.uv6s._updatable=!0)),this.isVerticesDataPresent(a.b.ColorKind)&&(t.colors=this.toNumberArray(this.getVerticesData(a.b.ColorKind)),this.isVertexBufferUpdatable(a.b.ColorKind)&&(t.colors._updatable=!0)),this.isVerticesDataPresent(a.b.MatricesIndicesKind)&&(t.matricesIndices=this.toNumberArray(this.getVerticesData(a.b.MatricesIndicesKind)),t.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(a.b.MatricesIndicesKind)&&(t.matricesIndices._updatable=!0)),this.isVerticesDataPresent(a.b.MatricesWeightsKind)&&(t.matricesWeights=this.toNumberArray(this.getVerticesData(a.b.MatricesWeightsKind)),this.isVertexBufferUpdatable(a.b.MatricesWeightsKind)&&(t.matricesWeights._updatable=!0)),t.indices=this.toNumberArray(this.getIndices()),t},t.ExtractFromMesh=function(t,e){var r=t._geometry;return r?r.copy(e):null},t.RandomId=function(){return l.h.RandomId()},t._ImportGeometry=function(e,r){var i=r.getScene(),s=e.geometryId;if(s){var u=i.getGeometryByID(s);u&&u.applyToMesh(r)}else if(e instanceof ArrayBuffer){var h=r._binaryInfo;if(h.positionsAttrDesc&&h.positionsAttrDesc.count>0){var c=new Float32Array(e,h.positionsAttrDesc.offset,h.positionsAttrDesc.count);r.setVerticesData(a.b.PositionKind,c,!1)}if(h.normalsAttrDesc&&h.normalsAttrDesc.count>0){var l=new Float32Array(e,h.normalsAttrDesc.offset,h.normalsAttrDesc.count);r.setVerticesData(a.b.NormalKind,l,!1)}if(h.tangetsAttrDesc&&h.tangetsAttrDesc.count>0){var d=new Float32Array(e,h.tangetsAttrDesc.offset,h.tangetsAttrDesc.count);r.setVerticesData(a.b.TangentKind,d,!1)}if(h.uvsAttrDesc&&h.uvsAttrDesc.count>0){var f=new Float32Array(e,h.uvsAttrDesc.offset,h.uvsAttrDesc.count);r.setVerticesData(a.b.UVKind,f,!1)}if(h.uvs2AttrDesc&&h.uvs2AttrDesc.count>0){var p=new Float32Array(e,h.uvs2AttrDesc.offset,h.uvs2AttrDesc.count);r.setVerticesData(a.b.UV2Kind,p,!1)}if(h.uvs3AttrDesc&&h.uvs3AttrDesc.count>0){var g=new Float32Array(e,h.uvs3AttrDesc.offset,h.uvs3AttrDesc.count);r.setVerticesData(a.b.UV3Kind,g,!1)}if(h.uvs4AttrDesc&&h.uvs4AttrDesc.count>0){var m=new Float32Array(e,h.uvs4AttrDesc.offset,h.uvs4AttrDesc.count);r.setVerticesData(a.b.UV4Kind,m,!1)}if(h.uvs5AttrDesc&&h.uvs5AttrDesc.count>0){var v=new Float32Array(e,h.uvs5AttrDesc.offset,h.uvs5AttrDesc.count);r.setVerticesData(a.b.UV5Kind,v,!1)}if(h.uvs6AttrDesc&&h.uvs6AttrDesc.count>0){var y=new Float32Array(e,h.uvs6AttrDesc.offset,h.uvs6AttrDesc.count);r.setVerticesData(a.b.UV6Kind,y,!1)}if(h.colorsAttrDesc&&h.colorsAttrDesc.count>0){var b=new Float32Array(e,h.colorsAttrDesc.offset,h.colorsAttrDesc.count);r.setVerticesData(a.b.ColorKind,b,!1,h.colorsAttrDesc.stride)}if(h.matricesIndicesAttrDesc&&h.matricesIndicesAttrDesc.count>0){for(var _=new Int32Array(e,h.matricesIndicesAttrDesc.offset,h.matricesIndicesAttrDesc.count),x=[],M=0;M<_.length;M++){var T=_[M];x.push(255&T),x.push((65280&T)>>8),x.push((16711680&T)>>16),x.push(T>>24)}r.setVerticesData(a.b.MatricesIndicesKind,x,!1)}if(h.matricesWeightsAttrDesc&&h.matricesWeightsAttrDesc.count>0){var A=new Float32Array(e,h.matricesWeightsAttrDesc.offset,h.matricesWeightsAttrDesc.count);r.setVerticesData(a.b.MatricesWeightsKind,A,!1)}if(h.indicesAttrDesc&&h.indicesAttrDesc.count>0){var D=new Int32Array(e,h.indicesAttrDesc.offset,h.indicesAttrDesc.count);r.setIndices(D,null)}if(h.subMeshesAttrDesc&&h.subMeshesAttrDesc.count>0){var I=new Int32Array(e,h.subMeshesAttrDesc.offset,5*h.subMeshesAttrDesc.count);r.subMeshes=[];for(M=0;M<h.subMeshesAttrDesc.count;M++){var V=I[5*M+0],w=I[5*M+1],E=I[5*M+2],S=I[5*M+3],C=I[5*M+4];o.b.AddToMesh(V,w,E,S,C,r)}}}else if(e.positions&&e.normals&&e.indices){if(r.setVerticesData(a.b.PositionKind,e.positions,e.positions._updatable),r.setVerticesData(a.b.NormalKind,e.normals,e.normals._updatable),e.tangents&&r.setVerticesData(a.b.TangentKind,e.tangents,e.tangents._updatable),e.uvs&&r.setVerticesData(a.b.UVKind,e.uvs,e.uvs._updatable),e.uvs2&&r.setVerticesData(a.b.UV2Kind,e.uvs2,e.uvs2._updatable),e.uvs3&&r.setVerticesData(a.b.UV3Kind,e.uvs3,e.uvs3._updatable),e.uvs4&&r.setVerticesData(a.b.UV4Kind,e.uvs4,e.uvs4._updatable),e.uvs5&&r.setVerticesData(a.b.UV5Kind,e.uvs5,e.uvs5._updatable),e.uvs6&&r.setVerticesData(a.b.UV6Kind,e.uvs6,e.uvs6._updatable),e.colors&&r.setVerticesData(a.b.ColorKind,n.Color4.CheckColors4(e.colors,e.positions.length/3),e.colors._updatable),e.matricesIndices)if(e.matricesIndices._isExpanded)delete e.matricesIndices._isExpanded,r.setVerticesData(a.b.MatricesIndicesKind,e.matricesIndices,e.matricesIndices._updatable);else{for(x=[],M=0;M<e.matricesIndices.length;M++){var P=e.matricesIndices[M];x.push(255&P),x.push((65280&P)>>8),x.push((16711680&P)>>16),x.push(P>>24)}r.setVerticesData(a.b.MatricesIndicesKind,x,e.matricesIndices._updatable)}if(e.matricesIndicesExtra)if(e.matricesIndicesExtra._isExpanded)delete e.matricesIndices._isExpanded,r.setVerticesData(a.b.MatricesIndicesExtraKind,e.matricesIndicesExtra,e.matricesIndicesExtra._updatable);else{for(x=[],M=0;M<e.matricesIndicesExtra.length;M++){P=e.matricesIndicesExtra[M];x.push(255&P),x.push((65280&P)>>8),x.push((16711680&P)>>16),x.push(P>>24)}r.setVerticesData(a.b.MatricesIndicesExtraKind,x,e.matricesIndicesExtra._updatable)}e.matricesWeights&&(t._CleanMatricesWeights(e,r),r.setVerticesData(a.b.MatricesWeightsKind,e.matricesWeights,e.matricesWeights._updatable)),e.matricesWeightsExtra&&r.setVerticesData(a.b.MatricesWeightsExtraKind,e.matricesWeightsExtra,e.matricesWeights._updatable),r.setIndices(e.indices,null)}if(e.subMeshes){r.subMeshes=[];for(var O=0;O<e.subMeshes.length;O++){var F=e.subMeshes[O];o.b.AddToMesh(F.materialIndex,F.verticesStart,F.verticesCount,F.indexStart,F.indexCount,r)}}r._shouldGenerateFlatShading&&(r.convertToFlatShadedMesh(),delete r._shouldGenerateFlatShading),r.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(r)},t._CleanMatricesWeights=function(t,e){if(u.a.CleanBoneMatrixWeights){var r=0;if(t.skeletonId>-1){var i=e.getScene().getLastSkeletonByID(t.skeletonId);if(i){r=i.bones.length;for(var n=e.getVerticesData(a.b.MatricesIndicesKind),s=e.getVerticesData(a.b.MatricesIndicesExtraKind),o=t.matricesWeights,h=t.matricesWeightsExtra,c=t.numBoneInfluencer,l=o.length,d=0;d<l;d+=4){for(var f=0,p=-1,g=0;g<4;g++){f+=m=o[d+g],m<.001&&p<0&&(p=g)}if(h)for(g=0;g<4;g++){var m;f+=m=h[d+g],m<.001&&p<0&&(p=g+4)}if((p<0||p>c-1)&&(p=c-1),f>.001){var v=1/f;for(g=0;g<4;g++)o[d+g]*=v;if(h)for(g=0;g<4;g++)h[d+g]*=v}else p>=4?(h[d+p-4]=1-f,s[d+p-4]=r):(o[d+p]=1-f,n[d+p]=r)}e.setVerticesData(a.b.MatricesIndicesKind,n),t.matricesWeightsExtra&&e.setVerticesData(a.b.MatricesIndicesExtraKind,s)}}}},t.Parse=function(e,r,i){if(r.getGeometryByID(e.id))return null;var o=new t(e.id,r,void 0,e.updatable);return d.a&&d.a.AddTagsTo(o,e.tags),e.delayLoadingFile?(o.delayLoadState=c.a.DELAYLOADSTATE_NOTLOADED,o.delayLoadingFile=i+e.delayLoadingFile,o._boundingInfo=new h.a(n.Vector3.FromArray(e.boundingBoxMinimum),n.Vector3.FromArray(e.boundingBoxMaximum)),o._delayInfo=[],e.hasUVs&&o._delayInfo.push(a.b.UVKind),e.hasUVs2&&o._delayInfo.push(a.b.UV2Kind),e.hasUVs3&&o._delayInfo.push(a.b.UV3Kind),e.hasUVs4&&o._delayInfo.push(a.b.UV4Kind),e.hasUVs5&&o._delayInfo.push(a.b.UV5Kind),e.hasUVs6&&o._delayInfo.push(a.b.UV6Kind),e.hasColors&&o._delayInfo.push(a.b.ColorKind),e.hasMatricesIndices&&o._delayInfo.push(a.b.MatricesIndicesKind),e.hasMatricesWeights&&o._delayInfo.push(a.b.MatricesWeightsKind),o._delayLoadingFunction=s.a.ImportVertexData):s.a.ImportVertexData(e,o),r.pushGeometry(o,!0),o},t}(),p=function(t){function e(e,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=null);var s=t.call(this,e,r,void 0,!1,n)||this;return s._canBeRegenerated=i,s._beingRegenerated=!0,s.regenerate(),s._beingRegenerated=!1,s}return i.d(e,t),e.prototype.canBeRegenerated=function(){return this._canBeRegenerated},e.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},e.prototype.asNewGeometry=function(e){return t.prototype.copy.call(this,e)},e.prototype.setAllVerticesData=function(e,r){this._beingRegenerated&&t.prototype.setAllVerticesData.call(this,e,!1)},e.prototype.setVerticesData=function(e,r,i){this._beingRegenerated&&t.prototype.setVerticesData.call(this,e,r,!1)},e.prototype._regenerateVertexData=function(){throw new Error("Abstract method")},e.prototype.copy=function(t){throw new Error("Must be overriden in sub-classes.")},e.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.canBeRegenerated=this.canBeRegenerated(),e},e}(f),g=function(t){function e(e,r,i,n,a,o,u,h,c){void 0===c&&(c=s.a.DEFAULTSIDE);var l=t.call(this,e,r,u,h)||this;return l.pathArray=i,l.closeArray=n,l.closePath=a,l.offset=o,l.side=c,l}return i.d(e,t),e.prototype._regenerateVertexData=function(){return s.a.CreateRibbon({pathArray:this.pathArray,closeArray:this.closeArray,closePath:this.closePath,offset:this.offset,sideOrientation:this.side})},e.prototype.copy=function(t){return new e(t,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),void 0,this.side)},e}(p),m=function(t){function e(e,r,i,n,a,o){void 0===a&&(a=null),void 0===o&&(o=s.a.DEFAULTSIDE);var u=t.call(this,e,r,n,a)||this;return u.size=i,u.side=o,u}return i.d(e,t),e.prototype._regenerateVertexData=function(){return s.a.CreateBox({size:this.size,sideOrientation:this.side})},e.prototype.copy=function(t){return new e(t,this.getScene(),this.size,this.canBeRegenerated(),void 0,this.side)},e.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.size=this.size,e},e.Parse=function(t,r){if(r.getGeometryByID(t.id))return null;var i=new e(t.id,r,t.size,t.canBeRegenerated,null);return d.a&&d.a.AddTagsTo(i,t.tags),r.pushGeometry(i,!0),i},e}(p),v=function(t){function e(e,r,i,n,a,o,u){void 0===o&&(o=null),void 0===u&&(u=s.a.DEFAULTSIDE);var h=t.call(this,e,r,a,o)||this;return h.segments=i,h.diameter=n,h.side=u,h}return i.d(e,t),e.prototype._regenerateVertexData=function(){return s.a.CreateSphere({segments:this.segments,diameter:this.diameter,sideOrientation:this.side})},e.prototype.copy=function(t){return new e(t,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},e.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.segments=this.segments,e.diameter=this.diameter,e},e.Parse=function(t,r){if(r.getGeometryByID(t.id))return null;var i=new e(t.id,r,t.segments,t.diameter,t.canBeRegenerated,null);return d.a&&d.a.AddTagsTo(i,t.tags),r.pushGeometry(i,!0),i},e}(p),y=function(t){function e(e,r,i,n,a,o,u){void 0===o&&(o=null),void 0===u&&(u=s.a.DEFAULTSIDE);var h=t.call(this,e,r,a,o)||this;return h.radius=i,h.tessellation=n,h.side=u,h}return i.d(e,t),e.prototype._regenerateVertexData=function(){return s.a.CreateDisc({radius:this.radius,tessellation:this.tessellation,sideOrientation:this.side})},e.prototype.copy=function(t){return new e(t,this.getScene(),this.radius,this.tessellation,this.canBeRegenerated(),null,this.side)},e}(p),b=function(t){function e(e,r,i,n,a,o,u,h,c,l){void 0===u&&(u=1),void 0===c&&(c=null),void 0===l&&(l=s.a.DEFAULTSIDE);var d=t.call(this,e,r,h,c)||this;return d.height=i,d.diameterTop=n,d.diameterBottom=a,d.tessellation=o,d.subdivisions=u,d.side=l,d}return i.d(e,t),e.prototype._regenerateVertexData=function(){return s.a.CreateCylinder({height:this.height,diameterTop:this.diameterTop,diameterBottom:this.diameterBottom,tessellation:this.tessellation,subdivisions:this.subdivisions,sideOrientation:this.side})},e.prototype.copy=function(t){return new e(t,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},e.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.height=this.height,e.diameterTop=this.diameterTop,e.diameterBottom=this.diameterBottom,e.tessellation=this.tessellation,e},e.Parse=function(t,r){if(r.getGeometryByID(t.id))return null;var i=new e(t.id,r,t.height,t.diameterTop,t.diameterBottom,t.tessellation,t.subdivisions,t.canBeRegenerated,null);return d.a&&d.a.AddTagsTo(i,t.tags),r.pushGeometry(i,!0),i},e}(p),_=function(t){function e(e,r,i,n,a,o,u,h){void 0===u&&(u=null),void 0===h&&(h=s.a.DEFAULTSIDE);var c=t.call(this,e,r,o,u)||this;return c.diameter=i,c.thickness=n,c.tessellation=a,c.side=h,c}return i.d(e,t),e.prototype._regenerateVertexData=function(){return s.a.CreateTorus({diameter:this.diameter,thickness:this.thickness,tessellation:this.tessellation,sideOrientation:this.side})},e.prototype.copy=function(t){return new e(t,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},e.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.diameter=this.diameter,e.thickness=this.thickness,e.tessellation=this.tessellation,e},e.Parse=function(t,r){if(r.getGeometryByID(t.id))return null;var i=new e(t.id,r,t.diameter,t.thickness,t.tessellation,t.canBeRegenerated,null);return d.a&&d.a.AddTagsTo(i,t.tags),r.pushGeometry(i,!0),i},e}(p),x=function(t){function e(e,r,i,n,s,a,o){void 0===o&&(o=null);var u=t.call(this,e,r,a,o)||this;return u.width=i,u.height=n,u.subdivisions=s,u}return i.d(e,t),e.prototype._regenerateVertexData=function(){return s.a.CreateGround({width:this.width,height:this.height,subdivisions:this.subdivisions})},e.prototype.copy=function(t){return new e(t,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},e.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.width=this.width,e.height=this.height,e.subdivisions=this.subdivisions,e},e.Parse=function(t,r){if(r.getGeometryByID(t.id))return null;var i=new e(t.id,r,t.width,t.height,t.subdivisions,t.canBeRegenerated,null);return d.a&&d.a.AddTagsTo(i,t.tags),r.pushGeometry(i,!0),i},e}(p),M=function(t){function e(e,r,i,n,s,a,o,u,h,c){void 0===c&&(c=null);var l=t.call(this,e,r,h,c)||this;return l.xmin=i,l.zmin=n,l.xmax=s,l.zmax=a,l.subdivisions=o,l.precision=u,l}return i.d(e,t),e.prototype._regenerateVertexData=function(){return s.a.CreateTiledGround({xmin:this.xmin,zmin:this.zmin,xmax:this.xmax,zmax:this.zmax,subdivisions:this.subdivisions,precision:this.precision})},e.prototype.copy=function(t){return new e(t,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},e}(p),T=function(t){function e(e,r,i,n,a,o){void 0===a&&(a=null),void 0===o&&(o=s.a.DEFAULTSIDE);var u=t.call(this,e,r,n,a)||this;return u.size=i,u.side=o,u}return i.d(e,t),e.prototype._regenerateVertexData=function(){return s.a.CreatePlane({size:this.size,sideOrientation:this.side})},e.prototype.copy=function(t){return new e(t,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},e.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.size=this.size,e},e.Parse=function(t,r){if(r.getGeometryByID(t.id))return null;var i=new e(t.id,r,t.size,t.canBeRegenerated,null);return d.a&&d.a.AddTagsTo(i,t.tags),r.pushGeometry(i,!0),i},e}(p),A=function(t){function e(e,r,i,n,a,o,u,h,c,l,d){void 0===l&&(l=null),void 0===d&&(d=s.a.DEFAULTSIDE);var f=t.call(this,e,r,c,l)||this;return f.radius=i,f.tube=n,f.radialSegments=a,f.tubularSegments=o,f.p=u,f.q=h,f.side=d,f}return i.d(e,t),e.prototype._regenerateVertexData=function(){return s.a.CreateTorusKnot({radius:this.radius,tube:this.tube,radialSegments:this.radialSegments,tubularSegments:this.tubularSegments,p:this.p,q:this.q,sideOrientation:this.side})},e.prototype.copy=function(t){return new e(t,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},e.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return e.radius=this.radius,e.tube=this.tube,e.radialSegments=this.radialSegments,e.tubularSegments=this.tubularSegments,e.p=this.p,e.q=this.q,e},e.Parse=function(t,r){if(r.getGeometryByID(t.id))return null;var i=new e(t.id,r,t.radius,t.tube,t.radialSegments,t.tubularSegments,t.p,t.q,t.canBeRegenerated,null);return d.a&&d.a.AddTagsTo(i,t.tags),r.pushGeometry(i,!0),i},e}(p)},41:function(t,e,r){"use strict";r.d(e,"a",function(){return n});var i=function(t,e){return t?t.getClassName&&"Mesh"===t.getClassName()?null:t.getClassName&&"SubMesh"===t.getClassName()?t.clone(e):t.clone?t.clone():null:null},n=function(){function t(){}return t.DeepCopy=function(t,e,r,n){for(var s in t)if(("_"!==s[0]||n&&-1!==n.indexOf(s))&&(!r||-1===r.indexOf(s))){var a=t[s],o=typeof a;if("function"!==o)try{if("object"===o)if(a instanceof Array){if(e[s]=[],a.length>0)if("object"==typeof a[0])for(var u=0;u<a.length;u++){var h=i(a[u],e);-1===e[s].indexOf(h)&&e[s].push(h)}else e[s]=a.slice(0)}else e[s]=i(a,e);else e[s]=a}catch(t){}}},t}()},43:function(t,e,r){"use strict";r.d(e,"a",function(){return i});var i=function(){function t(){}return t.BuildArray=function(t,e){for(var r=[],i=0;i<t;++i)r.push(e());return r},t}()},49:function(t,e,r){"use strict";r.d(e,"a",function(){return u});var i=r(1),n=r(2),s=r(27),a=r(7),o=r(0),u=function(t){function e(r,i,n){void 0===i&&(i=null),void 0===n&&(n=!0);var s=t.call(this,r,i)||this;return s._forward=new o.Vector3(0,0,1),s._forwardInverted=new o.Vector3(0,0,-1),s._up=new o.Vector3(0,1,0),s._right=new o.Vector3(1,0,0),s._rightInverted=new o.Vector3(-1,0,0),s._position=o.Vector3.Zero(),s._rotation=o.Vector3.Zero(),s._scaling=o.Vector3.One(),s._isDirty=!1,s.billboardMode=e.BILLBOARDMODE_NONE,s.scalingDeterminant=1,s.infiniteDistance=!1,s.ignoreNonUniformScaling=!1,s._localMatrix=o.Matrix.Zero(),s._absolutePosition=o.Vector3.Zero(),s._pivotMatrix=o.Matrix.Identity(),s._postMultiplyPivotMatrix=!1,s._isWorldMatrixFrozen=!1,s._indexInSceneTransformNodesArray=-1,s.onAfterWorldMatrixUpdateObservable=new a.c,s._nonUniformScaling=!1,n&&s.getScene().addTransformNode(s),s}return i.d(e,t),e.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaling",{get:function(){return this._scaling},set:function(t){this._scaling=t,this._isDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(t){this._rotationQuaternion=t,t&&this.rotation.setAll(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"forward",{get:function(){return o.Vector3.Normalize(o.Vector3.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return o.Vector3.Normalize(o.Vector3.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return o.Vector3.Normalize(o.Vector3.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!0,configurable:!0}),e.prototype.updatePoseMatrix=function(t){return this._poseMatrix.copyFrom(t),this},e.prototype.getPoseMatrix=function(){return this._poseMatrix},e.prototype._isSynchronized=function(){return!this._isDirty&&(this.billboardMode===this._cache.billboardMode&&this.billboardMode===e.BILLBOARDMODE_NONE&&(!this._cache.pivotMatrixUpdated&&(!this.infiniteDistance&&(!!this._cache.position.equals(this._position)&&(!(this._rotationQuaternion&&!this._cache.rotationQuaternion.equals(this._rotationQuaternion))&&(!!this._cache.rotation.equals(this._rotation)&&!!this._cache.scaling.equals(this._scaling)))))))},e.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=o.Vector3.Zero(),this._cache.scaling=o.Vector3.Zero(),this._cache.rotation=o.Vector3.Zero(),this._cache.rotationQuaternion=new o.Quaternion(0,0,0,0),this._cache.billboardMode=-1,this._cache.infiniteDistance=!1},e.prototype.markAsDirty=function(t){return"rotation"===t&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(e.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),e.prototype.setPreTransformMatrix=function(t){return this.setPivotMatrix(t,!1)},e.prototype.setPivotMatrix=function(t,e){return void 0===e&&(e=!0),this._pivotMatrix.copyFrom(t),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=e,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=o.Matrix.Invert(this._pivotMatrix)),this},e.prototype.getPivotMatrix=function(){return this._pivotMatrix},e.prototype.freezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0,this},e.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(e.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),e.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},e.prototype.setAbsolutePosition=function(t){if(!t)return this;var e,r,i;if(void 0===t.x){if(arguments.length<3)return this;e=arguments[0],r=arguments[1],i=arguments[2]}else e=t.x,r=t.y,i=t.z;if(this.parent){var n=o.Tmp.Matrix[0];this.parent.getWorldMatrix().invertToRef(n),o.Vector3.TransformCoordinatesFromFloatsToRef(e,r,i,n,this.position)}else this.position.x=e,this.position.y=r,this.position.z=i;return this},e.prototype.setPositionWithLocalVector=function(t){return this.computeWorldMatrix(),this.position=o.Vector3.TransformNormal(t,this._localMatrix),this},e.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=o.Tmp.Matrix[0];return this._localMatrix.invertToRef(t),o.Vector3.TransformNormal(this.position,t)},e.prototype.locallyTranslate=function(t){return this.computeWorldMatrix(!0),this.position=o.Vector3.TransformCoordinates(t,this._localMatrix),this},e.prototype.lookAt=function(t,r,i,n,s){void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=o.Space.LOCAL);var a=e._lookAtVectorCache,u=s===o.Space.LOCAL?this.position:this.getAbsolutePosition();if(t.subtractToRef(u,a),this.setDirection(a,r,i,n),s===o.Space.WORLD&&this.parent)if(this.rotationQuaternion){var h=o.Tmp.Matrix[0];this.rotationQuaternion.toRotationMatrix(h);var c=o.Tmp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(c),c.invert(),h.multiplyToRef(c,h),this.rotationQuaternion.fromRotationMatrix(h)}else{var l=o.Tmp.Quaternion[0];o.Quaternion.FromEulerVectorToRef(this.rotation,l);h=o.Tmp.Matrix[0];l.toRotationMatrix(h);c=o.Tmp.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(c),c.invert(),h.multiplyToRef(c,h),l.fromRotationMatrix(h),l.toEulerAnglesToRef(this.rotation)}return this},e.prototype.getDirection=function(t){var e=o.Vector3.Zero();return this.getDirectionToRef(t,e),e},e.prototype.getDirectionToRef=function(t,e){return o.Vector3.TransformNormalToRef(t,this.getWorldMatrix(),e),this},e.prototype.setDirection=function(t,e,r,i){void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0);var n=-Math.atan2(t.z,t.x)+Math.PI/2,s=Math.sqrt(t.x*t.x+t.z*t.z),a=-Math.atan2(t.y,s);return this.rotationQuaternion?o.Quaternion.RotationYawPitchRollToRef(n+e,a+r,i,this.rotationQuaternion):(this.rotation.x=a+r,this.rotation.y=n+e,this.rotation.z=i),this},e.prototype.setPivotPoint=function(t,e){void 0===e&&(e=o.Space.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var r=this.getWorldMatrix();if(e==o.Space.WORLD){var i=o.Tmp.Matrix[0];r.invertToRef(i),t=o.Vector3.TransformCoordinates(t,i)}return this.setPivotMatrix(o.Matrix.Translation(-t.x,-t.y,-t.z),!0)},e.prototype.getPivotPoint=function(){var t=o.Vector3.Zero();return this.getPivotPointToRef(t),t},e.prototype.getPivotPointToRef=function(t){return t.x=-this._pivotMatrix.m[12],t.y=-this._pivotMatrix.m[13],t.z=-this._pivotMatrix.m[14],this},e.prototype.getAbsolutePivotPoint=function(){var t=o.Vector3.Zero();return this.getAbsolutePivotPointToRef(t),t},e.prototype.getAbsolutePivotPointToRef=function(t){return t.x=this._pivotMatrix.m[12],t.y=this._pivotMatrix.m[13],t.z=this._pivotMatrix.m[14],this.getPivotPointToRef(t),o.Vector3.TransformCoordinatesToRef(t,this.getWorldMatrix(),t),this},e.prototype.setParent=function(t){if(!t&&!this.parent)return this;var e=o.Tmp.Quaternion[0],r=o.Tmp.Vector3[0],i=o.Tmp.Vector3[1];if(t){var n=o.Tmp.Matrix[0],s=o.Tmp.Matrix[1];this.computeWorldMatrix(!0),t.computeWorldMatrix(!0),t.getWorldMatrix().invertToRef(s),this.getWorldMatrix().multiplyToRef(s,n),n.decompose(i,e,r)}else this.parent&&this.parent.computeWorldMatrix&&this.parent.computeWorldMatrix(!0),this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(i,e,r);return this.rotationQuaternion?this.rotationQuaternion.copyFrom(e):e.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(i),this.position.copyFrom(r),this.parent=t,this},Object.defineProperty(e.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!0,configurable:!0}),e.prototype._updateNonUniformScalingState=function(t){return this._nonUniformScaling!==t&&(this._nonUniformScaling=t,!0)},e.prototype.attachToBone=function(t,e){return this._transformToBoneReferal=e,this.parent=t,t.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},e.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},e.prototype.rotate=function(t,r,i){var n;if(t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),i&&i!==o.Space.LOCAL){if(this.parent){var s=o.Tmp.Matrix[0];this.parent.getWorldMatrix().invertToRef(s),t=o.Vector3.TransformNormal(t,s)}(n=o.Quaternion.RotationAxisToRef(t,r,e._rotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else n=o.Quaternion.RotationAxisToRef(t,r,e._rotationAxisCache),this.rotationQuaternion.multiplyToRef(n,this.rotationQuaternion);return this},e.prototype.rotateAround=function(t,e,r){e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=o.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var i=o.Tmp.Vector3[0],n=o.Tmp.Vector3[1],s=o.Tmp.Vector3[2],a=o.Tmp.Quaternion[0],u=o.Tmp.Matrix[0],h=o.Tmp.Matrix[1],c=o.Tmp.Matrix[2],l=o.Tmp.Matrix[3];return t.subtractToRef(this.position,i),o.Matrix.TranslationToRef(i.x,i.y,i.z,u),o.Matrix.TranslationToRef(-i.x,-i.y,-i.z,h),o.Matrix.RotationAxisToRef(e,r,c),h.multiplyToRef(c,l),l.multiplyToRef(u,l),l.decompose(n,a,s),this.position.addInPlace(s),a.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},e.prototype.translate=function(t,e,r){var i=t.scale(e);if(r&&r!==o.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(i));else{var n=this.getPositionExpressedInLocalSpace().add(i);this.setPositionWithLocalVector(n)}return this},e.prototype.addRotation=function(t,e,r){var i;this.rotationQuaternion?i=this.rotationQuaternion:(i=o.Tmp.Quaternion[1],o.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,i));var n=o.Tmp.Quaternion[0];return o.Quaternion.RotationYawPitchRollToRef(e,t,r,n),i.multiplyInPlace(n),this.rotationQuaternion||i.toEulerAnglesToRef(this.rotation),this},e.prototype.computeWorldMatrix=function(t){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!t&&this.isSynchronized())return this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix;(this._updateCache(),this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._cache.billboardMode=this.billboardMode,this._cache.infiniteDistance=this.infiniteDistance,this._currentRenderId=this.getScene().getRenderId(),this._childRenderId=this.getScene().getRenderId(),this._isDirty=!1,o.Matrix.ScalingToRef(this.scaling.x*this.scalingDeterminant,this.scaling.y*this.scalingDeterminant,this.scaling.z*this.scalingDeterminant,o.Tmp.Matrix[1]),this.rotationQuaternion)&&(this.rotation.length()&&(this.rotationQuaternion.multiplyInPlace(o.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)),this.rotation.copyFromFloats(0,0,0)));this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(o.Tmp.Matrix[0]),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(o.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,o.Tmp.Matrix[0]),this._cache.rotation.copyFrom(this.rotation));var r=this.getScene().activeCamera;if(this.infiniteDistance&&!this.parent&&r){var i=r.getWorldMatrix(),n=new o.Vector3(i.m[12],i.m[13],i.m[14]);o.Matrix.TranslationToRef(this.position.x+n.x,this.position.y+n.y,this.position.z+n.z,o.Tmp.Matrix[2])}else o.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,o.Tmp.Matrix[2]);if(this._pivotMatrix.multiplyToRef(o.Tmp.Matrix[1],o.Tmp.Matrix[4]),o.Tmp.Matrix[4].multiplyToRef(o.Tmp.Matrix[0],o.Tmp.Matrix[5]),this.billboardMode!==e.BILLBOARDMODE_NONE&&r){if((this.billboardMode&e.BILLBOARDMODE_ALL)!==e.BILLBOARDMODE_ALL){var s=o.Tmp.Vector3[3];this.parent&&this.parent.getWorldMatrix?this._transformToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),o.Tmp.Matrix[6]),o.Vector3.TransformCoordinatesToRef(this.position,o.Tmp.Matrix[6],s)):o.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),s):s.copyFrom(this.position),s.subtractInPlace(r.globalPosition);var a=o.Tmp.Vector3[4].copyFromFloats(0,0,0);(this.billboardMode&e.BILLBOARDMODE_X)===e.BILLBOARDMODE_X&&(a.x=Math.atan2(-s.y,s.z)),(this.billboardMode&e.BILLBOARDMODE_Y)===e.BILLBOARDMODE_Y&&(a.y=Math.atan2(s.x,s.z)),(this.billboardMode&e.BILLBOARDMODE_Z)===e.BILLBOARDMODE_Z&&(a.z=Math.atan2(s.y,s.x)),o.Matrix.RotationYawPitchRollToRef(a.y,a.x,a.z,o.Tmp.Matrix[0])}else o.Tmp.Matrix[1].copyFrom(r.getViewMatrix()),o.Tmp.Matrix[1].setTranslationFromFloats(0,0,0),o.Tmp.Matrix[1].invertToRef(o.Tmp.Matrix[0]);o.Tmp.Matrix[1].copyFrom(o.Tmp.Matrix[5]),o.Tmp.Matrix[1].multiplyToRef(o.Tmp.Matrix[0],o.Tmp.Matrix[5])}return this._postMultiplyPivotMatrix&&o.Tmp.Matrix[5].multiplyToRef(this._pivotMatrixInverse,o.Tmp.Matrix[5]),o.Tmp.Matrix[5].multiplyToRef(o.Tmp.Matrix[2],this._localMatrix),this.parent&&this.parent.getWorldMatrix?(this.billboardMode!==e.BILLBOARDMODE_NONE?(this._transformToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),o.Tmp.Matrix[6]),o.Tmp.Matrix[5].copyFrom(o.Tmp.Matrix[6])):o.Tmp.Matrix[5].copyFrom(this.parent.getWorldMatrix()),this._localMatrix.getTranslationToRef(o.Tmp.Vector3[5]),o.Vector3.TransformCoordinatesToRef(o.Tmp.Vector3[5],o.Tmp.Matrix[5],o.Tmp.Vector3[5]),this._worldMatrix.copyFrom(this._localMatrix),this._worldMatrix.setTranslation(o.Tmp.Vector3[5])):this._transformToBoneReferal?(this._localMatrix.multiplyToRef(this.parent.getWorldMatrix(),o.Tmp.Matrix[6]),o.Tmp.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()):this._worldMatrix.copyFrom(this._localMatrix),this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this.scaling.isNonUniform?this._updateNonUniformScalingState(!0):this.parent&&this.parent._nonUniformScaling?this._updateNonUniformScalingState(this.parent._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=o.Matrix.Invert(this._worldMatrix)),this._worldMatrixDeterminant=this._worldMatrix.determinant(),this._worldMatrix},e.prototype._afterComputeWorldMatrix=function(){},e.prototype.registerAfterWorldMatrixUpdate=function(t){return this.onAfterWorldMatrixUpdateObservable.add(t),this},e.prototype.unregisterAfterWorldMatrixUpdate=function(t){return this.onAfterWorldMatrixUpdateObservable.removeCallback(t),this},e.prototype.getPositionInCameraSpace=function(t){return void 0===t&&(t=null),t||(t=this.getScene().activeCamera),o.Vector3.TransformCoordinates(this.absolutePosition,t.getViewMatrix())},e.prototype.getDistanceToCamera=function(t){return void 0===t&&(t=null),t||(t=this.getScene().activeCamera),this.absolutePosition.subtract(t.position).length()},e.prototype.clone=function(t,r,i){var s=this,a=n.a.Clone(function(){return new e(t,s.getScene())},this);if(a.name=t,a.id=t,r&&(a.parent=r),!i)for(var o=this.getDescendants(!0),u=0;u<o.length;u++){var h=o[u];h.clone&&h.clone(t+"."+h.name,a)}return a},e.prototype.serialize=function(t){var e=n.a.Serialize(this,t);return e.type=this.getClassName(),this.parent&&(e.parentId=this.parent.id),s.a&&s.a.HasTags(this)&&(e.tags=s.a.GetTags(this)),e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(),this.parent&&(e.parentId=this.parent.id),e},e.Parse=function(t,r,i){var a=n.a.Parse(function(){return new e(t.name,r)},t,r,i);return s.a&&s.a.AddTagsTo(a,t.tags),t.localMatrix?a.setPreTransformMatrix(o.Matrix.FromArray(t.localMatrix)):t.pivotMatrix&&a.setPivotMatrix(o.Matrix.FromArray(t.pivotMatrix)),a.setEnabled(t.isEnabled),t.parentId&&(a._waitingParentId=t.parentId),a},e.prototype.getChildTransformNodes=function(t,r){var i=[];return this._getDescendants(i,t,function(t){return(!r||r(t))&&t instanceof e}),i},e.prototype.dispose=function(e,r){if(void 0===r&&(r=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),e)for(var i=0,n=this.getChildTransformNodes(!0);i<n.length;i++){var s=n[i];s.parent=null,s.computeWorldMatrix(!0)}t.prototype.dispose.call(this,e,r)},e.BILLBOARDMODE_NONE=0,e.BILLBOARDMODE_X=1,e.BILLBOARDMODE_Y=2,e.BILLBOARDMODE_Z=4,e.BILLBOARDMODE_ALL=7,e._lookAtVectorCache=new o.Vector3(0,0,0),e._rotationAxisCache=new o.Quaternion,i.c([Object(n.n)("position")],e.prototype,"_position",void 0),i.c([Object(n.n)("rotation")],e.prototype,"_rotation",void 0),i.c([Object(n.k)("rotationQuaternion")],e.prototype,"_rotationQuaternion",void 0),i.c([Object(n.n)("scaling")],e.prototype,"_scaling",void 0),i.c([Object(n.c)()],e.prototype,"billboardMode",void 0),i.c([Object(n.c)()],e.prototype,"scalingDeterminant",void 0),i.c([Object(n.c)()],e.prototype,"infiniteDistance",void 0),i.c([Object(n.c)()],e.prototype,"ignoreNonUniformScaling",void 0),e}(r(25).a)},51:function(t,e,r){"use strict";r.d(e,"a",function(){return i});var i=function(){function t(){}return t.IsWindowObjectExist=function(){return"undefined"!=typeof window},t.GetDOMTextContent=function(t){for(var e="",r=t.firstChild;r;)3===r.nodeType&&(e+=r.textContent),r=r.nextSibling;return e},t}()},56:function(t,e,r){"use strict";r.d(e,"a",function(){return h}),r.d(e,"b",function(){return c});var i=r(1),n=r(5),s=r(3),a=r(127),o=r(53),u=r(4),h=function(){function t(){}return Object.defineProperty(t.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),t.prototype.setEffect=function(t,e){void 0===e&&(e=null),this._materialEffect!==t?(this._materialDefines=e,this._materialEffect=t):t||(this._materialDefines=null)},t}(),c=function(t){function e(e,r,i,n,s,a,o,u){void 0===u&&(u=!0);var h=t.call(this)||this;return h.materialIndex=e,h.verticesStart=r,h.verticesCount=i,h.indexStart=n,h.indexCount=s,h._renderId=0,h._mesh=a,h._renderingMesh=o||a,a.subMeshes.push(h),h._trianglePlanes=[],h._id=a.subMeshes.length-1,u&&(h.refreshBoundingInfo(),a.computeWorldMatrix(!0)),h}return i.d(e,t),e.AddToMesh=function(t,r,i,n,s,a,o,u){return void 0===u&&(u=!0),new e(t,r,i,n,s,a,o,u)},Object.defineProperty(e.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),e.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},e.prototype.setBoundingInfo=function(t){return this._boundingInfo=t,this},e.prototype.getMesh=function(){return this._mesh},e.prototype.getRenderingMesh=function(){return this._renderingMesh},e.prototype.getMaterial=function(){var t=this._renderingMesh.material;if(null==t)return this._mesh.getScene().defaultMaterial;if(t.getSubMaterial){var e=t.getSubMaterial(this.materialIndex);return this._currentMaterial!==e&&(this._currentMaterial=e,this._materialDefines=null),e}return t},e.prototype.refreshBoundingInfo=function(){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;var t=this._renderingMesh.getVerticesData(s.b.PositionKind);if(!t)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var e,r=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===r.length){var i=this._renderingMesh.getBoundingInfo();e={minimum:i.minimum.clone(),maximum:i.maximum.clone()}}else e=n.h.ExtractMinAndMaxIndexed(t,r,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(e.minimum,e.maximum):this._boundingInfo=new o.a(e.minimum,e.maximum),this},e.prototype._checkCollision=function(t){return this.getBoundingInfo()._checkCollision(t)},e.prototype.updateBoundingInfo=function(t){var e=this.getBoundingInfo();return e||(this.refreshBoundingInfo(),e=this.getBoundingInfo()),e.update(t),this},e.prototype.isInFrustum=function(t){var e=this.getBoundingInfo();return!!e&&e.isInFrustum(t,this._mesh.cullingStrategy)},e.prototype.isCompletelyInFrustum=function(t){var e=this.getBoundingInfo();return!!e&&e.isCompletelyInFrustum(t)},e.prototype.render=function(t){return this._renderingMesh.render(this,t),this},e.prototype._getLinesIndexBuffer=function(t,e){if(!this._linesIndexBuffer){for(var r=[],i=this.indexStart;i<this.indexStart+this.indexCount;i+=3)r.push(t[i],t[i+1],t[i+1],t[i+2],t[i+2],t[i]);this._linesIndexBuffer=e.createIndexBuffer(r),this._linesIndexCount=r.length}return this._linesIndexBuffer},e.prototype.canIntersects=function(t){var e=this.getBoundingInfo();return!!e&&t.intersectsBox(e.boundingBox)},e.prototype.intersects=function(t,e,r,i){var n=this.getMaterial();if(!n)return null;switch(n.fillMode){case u.a.MATERIAL_PointListDrawMode:case u.a.MATERIAL_LineListDrawMode:case u.a.MATERIAL_LineLoopDrawMode:case u.a.MATERIAL_LineStripDrawMode:case u.a.MATERIAL_TriangleFanDrawMode:case u.a.MATERIAL_TriangleStripDrawMode:return null}return"InstancedLinesMesh"===this._mesh.getClassName()||"LinesMesh"===this._mesh.getClassName()?this._intersectLines(t,e,r,this._mesh.intersectionThreshold,i):this._intersectTriangles(t,e,r,i)},e.prototype._intersectLines=function(t,e,r,i,n){for(var s=null,o=this.indexStart;o<this.indexStart+this.indexCount;o+=2){var u=e[r[o]],h=e[r[o+1]],c=t.intersectionSegment(u,h,i);if(!(c<0)&&((n||!s||c<s.distance)&&((s=new a.a(null,null,c)).faceId=o/2,n)))break}return s},e.prototype._intersectTriangles=function(t,e,r,i){for(var n=null,s=this.indexStart;s<this.indexStart+this.indexCount;s+=3){var a=e[r[s]],o=e[r[s+1]],u=e[r[s+2]],h=t.intersectsTriangle(a,o,u);if(h){if(h.distance<0)continue;if((i||!n||h.distance<n.distance)&&((n=h).faceId=s/3,i))break}}return n},e.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},e.prototype.clone=function(t,r){var i=new e(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,r,!1);if(!this.IsGlobal){var n=this.getBoundingInfo();if(!n)return i;i._boundingInfo=new o.a(n.minimum,n.maximum)}return i},e.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var t=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(t,1)},e.prototype.getClassName=function(){return"SubMesh"},e.CreateFromIndices=function(t,r,i,n,s){for(var a=Number.MAX_VALUE,o=-Number.MAX_VALUE,u=(s||n).getIndices(),h=r;h<r+i;h++){var c=u[h];c<a&&(a=c),c>o&&(o=c)}return new e(t,a,o-a+1,r,i,n,s)},e}(h)},79:function(t,e,r){"use strict";r.d(e,"a",function(){return i});var i=function(){function t(){}return t.FilesToLoad={},t}()},82:function(t,e,r){"use strict";r.d(e,"b",function(){return c}),r.d(e,"a",function(){return l});var i=r(1),n=r(0),s=r(3),a=r(10),o=r(117),u=r(14),h=r(78),c=(r(222),r(223),function(t){function e(e,r,i,a,o,u,c){void 0===r&&(r=null),void 0===i&&(i=null);var l=t.call(this,e,r,i,a,o)||this;l.useVertexColor=u,l.useVertexAlpha=c,l.color=new n.Color3(1,1,1),l.alpha=1,a&&(l.color=a.color.clone(),l.alpha=a.alpha,l.useVertexColor=a.useVertexColor,l.useVertexAlpha=a.useVertexAlpha),l.intersectionThreshold=.1;var d={attributes:[s.b.PositionKind,"world0","world1","world2","world3"],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[]};return!1===c&&(d.needAlphaBlending=!1),u?(d.defines.push("#define VERTEXCOLOR"),d.attributes.push(s.b.ColorKind)):d.uniforms.push("color"),l._colorShader=new h.a("colorShader",l.getScene(),"color",d),l}return i.d(e,t),e.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(e.prototype,"material",{get:function(){return this._colorShader},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype._bind=function(t,e,r){return this._geometry?(this._geometry._bind(this._colorShader.getEffect()),this.useVertexColor||this._colorShader.setColor4("color",this.color.toColor4(this.alpha)),this):this},e.prototype._draw=function(t,e,r){return this._geometry&&this._geometry.getVertexBuffers()&&(this._unIndexed||this._geometry.getIndexBuffer())?(this.getScene().getEngine().drawElementsType(u.a.LineListDrawMode,t.indexStart,t.indexCount,r),this):this},e.prototype.dispose=function(e){this._colorShader.dispose(!1,!1,!0),t.prototype.dispose.call(this,e)},e.prototype.clone=function(t,r,i){return new e(t,this.getScene(),r,this,i)},e.prototype.createInstance=function(t){return new l(t,this)},e}(a.a)),l=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.intersectionThreshold=r.intersectionThreshold,i}return i.d(e,t),e.prototype.getClassName=function(){return"InstancedLinesMesh"},e}(o.a)},98:function(t,e,r){"use strict";r.d(e,"a",function(){return u});var i=r(0),n=r(12),s=r(68),a=r(4),o=function(){return function(t,e,r,i){this.name=t,this.worldAxisForNormal=e,this.worldAxisForFileX=r,this.worldAxisForFileY=i}}(),u=function(){function t(){}return t.ConvertCubeMapTextureToSphericalPolynomial=function(t){if(!t.isCube)return null;var e,r,i=t.getSize().width,n=t.readPixels(0),s=t.readPixels(1);t.isRenderTarget?(e=t.readPixels(3),r=t.readPixels(2)):(e=t.readPixels(2),r=t.readPixels(3));var o=t.readPixels(4),u=t.readPixels(5),h=t.gammaSpace,c=a.a.TEXTUREFORMAT_RGBA,l=a.a.TEXTURETYPE_UNSIGNED_INT;t.textureType&&t.textureType!==a.a.TEXTURETYPE_UNSIGNED_INT&&(l=a.a.TEXTURETYPE_FLOAT);var d={size:i,right:n,left:s,up:e,down:r,front:o,back:u,format:c,type:l,gammaSpace:h};return this.ConvertCubeMapToSphericalPolynomial(d)},t.ConvertCubeMapToSphericalPolynomial=function(t){for(var e=new s.a,r=0,o=2/t.size,u=o,h=.5*o-1,c=0;c<6;c++)for(var l=this.FileFaces[c],d=t[l.name],f=h,p=t.format===a.a.TEXTUREFORMAT_RGBA?4:3,g=0;g<t.size;g++){for(var m=h,v=0;v<t.size;v++){var y=l.worldAxisForFileX.scale(m).add(l.worldAxisForFileY.scale(f)).add(l.worldAxisForNormal);y.normalize();var b=Math.pow(1+m*m+f*f,-1.5),_=d[g*t.size*p+v*p+0],x=d[g*t.size*p+v*p+1],M=d[g*t.size*p+v*p+2];t.type===a.a.TEXTURETYPE_UNSIGNED_INT&&(_/=255,x/=255,M/=255),t.gammaSpace&&(_=Math.pow(n.a.Clamp(_),i.ToLinearSpace),x=Math.pow(n.a.Clamp(x),i.ToLinearSpace),M=Math.pow(n.a.Clamp(M),i.ToLinearSpace));var T=new i.Color3(_,x,M);e.addLight(y,T,b),r+=b,m+=o}f+=u}var A=6*(4*Math.PI)/6/r;return e.scale(A),e.convertIncidentRadianceToIrradiance(),e.convertIrradianceToLambertianRadiance(),s.b.FromHarmonics(e)},t.FileFaces=[new o("right",new i.Vector3(1,0,0),new i.Vector3(0,0,-1),new i.Vector3(0,-1,0)),new o("left",new i.Vector3(-1,0,0),new i.Vector3(0,0,1),new i.Vector3(0,-1,0)),new o("up",new i.Vector3(0,1,0),new i.Vector3(1,0,0),new i.Vector3(0,0,1)),new o("down",new i.Vector3(0,-1,0),new i.Vector3(1,0,0),new i.Vector3(0,0,-1)),new o("front",new i.Vector3(0,0,1),new i.Vector3(1,0,0),new i.Vector3(0,-1,0)),new o("back",new i.Vector3(0,0,-1),new i.Vector3(-1,0,0),new i.Vector3(0,-1,0))],t}()}}]);